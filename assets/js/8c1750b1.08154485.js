"use strict";(self.webpackChunkkurokuro=self.webpackChunkkurokuro||[]).push([[86983],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=p(n),d=i,h=c["".concat(l,".").concat(d)]||c[d]||m[d]||r;return n?a.createElement(h,o(o({ref:t},u),{},{components:n})):a.createElement(h,o({ref:t},u))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[c]="string"==typeof e?e:i,o[1]=s;for(var p=2;p<r;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},13433:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(67294);function i(e){let{faqs:t=[]}=e;if(0===(Array.isArray(t)?t.filter((e=>e.question&&e.answer)):[]).length)return null;const n={"@context":"https://schema.org","@type":"FAQPage",mainEntity:t.map((e=>({"@type":"Question",name:e.question,acceptedAnswer:{"@type":"Answer",text:e.answer}})))},i=JSON.stringify(n,null,2);return a.createElement("script",{type:"application/ld+json"},i)}},11377:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>u});var a=n(87462),i=(n(67294),n(3905)),r=n(13433);const o={title:"Can I call Kuroco's API using custom function?",description:'There are two ways to call Kuroco\'s API using custom function, via the "api_internal" plugin and "api_method" plugin. We will explain each method.',category:"howto"},s=void 0,l={unversionedId:"faq/how-to-request-kuroco-api-from-smarty-function",id:"faq/how-to-request-kuroco-api-from-smarty-function",title:"Can I call Kuroco's API using custom function?",description:'There are two ways to call Kuroco\'s API using custom function, via the "api_internal" plugin and "api_method" plugin. We will explain each method.',source:"@site/docs/faq/how-to-request-kuroco-api-from-smarty-function.mdx",sourceDirName:"faq",slug:"/faq/how-to-request-kuroco-api-from-smarty-function",permalink:"/docs/faq/how-to-request-kuroco-api-from-smarty-function",draft:!1,editUrl:"https://github.com/diverta/kuroco-documents/tree/main/packages/create-docusaurus/templates/shared/docs/faq/how-to-request-kuroco-api-from-smarty-function.mdx",tags:[],version:"current",frontMatter:{title:"Can I call Kuroco's API using custom function?",description:'There are two ways to call Kuroco\'s API using custom function, via the "api_internal" plugin and "api_method" plugin. We will explain each method.',category:"howto"},sidebar:"faqSidebar",previous:{title:"It takes too long to build and deploy my GitHub Actions. How can I speed it up?",permalink:"/docs/faq/how-to-reduce-artifact-file-sizes"},next:{title:"I changed CORS but it is not reflected",permalink:"/docs/faq/i-changed-cors-but-it-is-not-reflected"}},p={},u=[{value:"Use the api_internal plugin",id:"use-the-api_internal-plugin",level:2},{value:"Example 1. GET method (no authentication)",id:"example-1-get-method-no-authentication",level:3},{value:"Example 2. POST method (with authentication)",id:"example-2-post-method-with-authentication",level:3},{value:"Example 3. GET method (direct execution on server)",id:"example-3-get-method-direct-execution-on-server",level:3},{value:"Example 4. GET method (request inheriting session state)",id:"example-4-get-method-request-inheriting-session-state",level:3},{value:"Use the api_method plugin",id:"use-the-api_method-plugin",level:2},{value:"api_method plugin usage example",id:"api_method-plugin-usage-example",level:3},{value:"Use of api_internal plugin and api_method plugin",id:"use-of-api_internal-plugin-and-api_method-plugin",level:2},{value:"Related Documents",id:"related-documents",level:2}],c={toc:u},m="wrapper";function d(e){let{components:t,...n}=e;return(0,i.kt)(m,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)(r.Z,{faqs:[{question:"Can I call Kuroco's API using custom function?",answer:"There are two ways to call Kuroco's API using custom function, via the api_internal plugin and api_method plugin. We will explain each method."}],mdxType:"StructuredDataFaqs"}),(0,i.kt)("p",null,"There are two ways to call Kuroco's API using custom function."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Use the ",(0,i.kt)("inlineCode",{parentName:"li"},"api_internal")," plugin"),(0,i.kt)("li",{parentName:"ul"},"Use the ",(0,i.kt)("inlineCode",{parentName:"li"},"api_method")," plugin")),(0,i.kt)("p",null,"Each of these ways is explained below."),(0,i.kt)("h2",{id:"use-the-api_internal-plugin"},"Use the api_internal plugin"),(0,i.kt)("p",null,"By using the ",(0,i.kt)("inlineCode",{parentName:"p"},"api_internal")," plugin, you can call any endpoint configured on the ",(0,i.kt)("a",{parentName:"p",href:"/docs/management/api-list/"},"API")," screen and get the execution results.",(0,i.kt)("br",{parentName:"p"}),"\n","Examples of the usage is shown below."),(0,i.kt)("h3",{id:"example-1-get-method-no-authentication"},"Example 1. GET method (no authentication)"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-smarty"},"{* query parameter *}\n{assign_array var='queries' \xa0 \xa0 \xa0 \xa0values=''}\n{assign \xa0 \xa0 \xa0 var='queries.filter' value='ext_col_01 = \"1\"'}\n{api_internal\n\xa0 \xa0 var='response'\n\xa0 \xa0 status_var='status'\n\xa0 \xa0 endpoint='/rcms-api/1/topics'\n\xa0 \xa0 method='GET'\n\xa0 \xa0 queries=$queries}\n")),(0,i.kt)("p",null,"Calls the target API via HTTP request and assigns the response to the variable specified as ",(0,i.kt)("inlineCode",{parentName:"p"},"var"),"."),(0,i.kt)("p",null,"The variable specified as ",(0,i.kt)("inlineCode",{parentName:"p"},"status_var")," is assigned the success or failure of the request.\nReturns ",(0,i.kt)("inlineCode",{parentName:"p"},"1")," in case of success, or ",(0,i.kt)("inlineCode",{parentName:"p"},"0")," in case of failure due to network errors or other factors."),(0,i.kt)("p",null,"The execution of the above sample code corresponds to the following JavaScript code. The request is sent with the filter condition of ",(0,i.kt)("inlineCode",{parentName:"p"},'ext_col_01 = "1"')," specified in the query parameter of the endpoint ",(0,i.kt)("inlineCode",{parentName:"p"},"/rcms-api/1/topics"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"let queries = {};\nqueries.filter = 'ext_col_01 = \"1\"';\n\nfetch(\n\xa0 'https://your-site-key.g.kuroco.app/rcms-api/1/topics?' + (new URLSearchParams(queries)).toString(),\n\xa0 // => https://your-site-key.g.kuroco.app/rcms-api/1/topics?filter=ext_col_01+%3D+%221%22\n\xa0 {\n\xa0 \xa0 method: 'GET',\n\xa0 }\n);\n")),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"Refer to the following document for details on how to use filters.  "),(0,i.kt)("ul",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ul"},"Tutorial -> ",(0,i.kt)("a",{parentName:"li",href:"/docs/tutorials/implement-a-search-function/"},"Implementing a search function"),"\xa0 "),(0,i.kt)("li",{parentName:"ul"},"References -> ",(0,i.kt)("a",{parentName:"li",href:"/docs/reference/filter-query/"},"Using the filter query function")," \xa0"))),(0,i.kt)("h3",{id:"example-2-post-method-with-authentication"},"Example 2. POST method (with authentication)"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-smarty"},"{* Request Body *}\n{assign_array var='body' \xa0 \xa0 \xa0 \xa0 \xa0 \xa0values=''}\n{assign \xa0 \xa0 \xa0 var='body.subject' \xa0 \xa0value='Title'}\n{assign \xa0 \xa0 \xa0 var='body.ext_col_01' value='2'}\n\n{api_internal\n\xa0 \xa0 var='response'\n\xa0 \xa0 status_var='status'\n\xa0 \xa0 endpoint='/rcms-api/2/topics/insert'\n\xa0 \xa0 method='POST'\n\xa0 \xa0 queries=$body\n\xa0 \xa0 member_id=$smarty.session.member_id}\n")),(0,i.kt)("p",null,"Passing the ",(0,i.kt)("inlineCode",{parentName:"p"},"member_id")," parameter allows the request to be executed with the specified member ID authenticated."),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"The ",(0,i.kt)("inlineCode",{parentName:"p"},"member_id"),' parameter can be specified only when the authentication method of the target API is set to "dynamic access token". If you wish to use it, it is recommended to create a separate API for internal processing.',(0,i.kt)("br",{parentName:"p"}),"\n","For information on dynamic access tokens, see ",(0,i.kt)("a",{parentName:"p",href:"/docs/management/api-security/#Dynamic-Access-Tokens"},"API Security -> Dynamic Access Tokens"),".")),(0,i.kt)("p",null,"The execution of the above sample code corresponds to the following JavaScript code."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"let body = {};\nbody.subject = 'Title';\nbody.ext_col_01 = '2';\n\nfetch(\n\xa0 'https://your-site-key.g.kuroco.app/rcms-api/2/topics/insert',\n\xa0 {\n\xa0 \xa0 method: 'POST',\n\xa0 \xa0 headers: {\n\xa0 \xa0 \xa0 'Content-Type': 'application/json',\n\xa0 \xa0 \xa0 // Generate an access token based on the member_id specified and grant it automatically.\n\xa0 \xa0 \xa0 'X-RCMS-API-ACCESS-TOKEN': '********',\n\xa0 \xa0 },\n\xa0 \xa0 body: JSON.stringify(body),\n\xa0 }\n);\n")),(0,i.kt)("h3",{id:"example-3-get-method-direct-execution-on-server"},"Example 3. GET method (direct execution on server)"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-smarty"},"{assign_array var='queries' \xa0 \xa0 \xa0 \xa0values=''}\n{assign \xa0 \xa0 \xa0 var='queries.filter' value='ext_col_01 = \"1\"'}\n{api_internal\n\xa0 \xa0 var='response'\n\xa0 \xa0 status_var='status'\n\xa0 \xa0 endpoint='/rcms-api/1/topics'\n\xa0 \xa0 method='GET'\n\xa0 \xa0 queries=$queries\n\xa0 \xa0 direct=1}\n")),(0,i.kt)("p",null,"The process in 'Example 1' and 'Example 2' calls the target endpoint via HTTP request. However, depending on network conditions, the following problems may occur."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Takes time to get results"),(0,i.kt)("li",{parentName:"ul"},"Failure to retrieve results")),(0,i.kt)("p",null,"As a countermeasure, you can specify ",(0,i.kt)("inlineCode",{parentName:"p"},"direct=1")," as a parameter to execute the endpoint processing directly on the server without going through the HTTP request.",(0,i.kt)("br",{parentName:"p"}),"\n","This has the advantage of stable results, but response caching does not work, so you would have to consider the cost of using this approach."),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"You can specify ",(0,i.kt)("inlineCode",{parentName:"p"},"direct=1")," as a parameter only when the HTTP method of the target endpoint is GET. Furthermore, member_id cannot be specified.")),(0,i.kt)("h3",{id:"example-4-get-method-request-inheriting-session-state"},"Example 4. GET method (request inheriting session state)"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-smarty"},"{* query parameter *}\n{assign_session key='my_session_name' value=true}\n\n{assign_array var='queries' \xa0 \xa0 \xa0 \xa0values=''}\n{assign \xa0 \xa0 \xa0 var='queries.filter' value='ext_col_01 = \"1\"'}\n{api_internal\n\xa0 \xa0 var='response'\n\xa0 \xa0 status_var='status'\n\xa0 \xa0 endpoint='/rcms-api/1/topics'\n\xa0 \xa0 method='GET'\n\xa0 \xa0 queries=$queries\n\xa0 \xa0 direct=1\n\xa0 \xa0 use_current_session=1}\n")),(0,i.kt)("p",null,"Under normal circumstances, separate sessions are created for the caller and the destination of the ",(0,i.kt)("inlineCode",{parentName:"p"},"api_internal")," plugin.\nHowever, if ",(0,i.kt)("inlineCode",{parentName:"p"},"direct=1")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"use_current_session=1")," are specified at the same time, the target endpoint can be processed while inheriting the caller's session.\nTherefore, it is useful when you want to execute directly with the login state inherited, or when you use the ",(0,i.kt)("inlineCode",{parentName:"p"},"assign_session")," plugin to manage your own session variables."),(0,i.kt)("p",null,"We can confirm that the session state is the same as that of the caller by defining the following in Smarty code in the pre-processing or post-processing of an endpoint."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-smarty"},"{* $my_session_value is assigned the session set by the caller *}\n{assign_session var='my_session_value' key='my_session_name'}\n\n{* The caller's login status is inherited *}\n{assign var='member_id' value=$smarty.session.member_id}\n")),(0,i.kt)("h2",{id:"use-the-api_method-plugin"},"Use the api_method plugin"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"api_method")," plugin allows you to call API functions directly without creating endpoints."),(0,i.kt)("p",null,"As with calling the ",(0,i.kt)("inlineCode",{parentName:"p"},"api_internal")," plugin with the ",(0,i.kt)("inlineCode",{parentName:"p"},"direct=1")," parameter, processing is performed on the server without going through an HTTP request. The API call function automatically inherits the same session state as the caller."),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"The ",(0,i.kt)("inlineCode",{parentName:"p"},"api_method")," can only be called if the HTTP method of the target function is GET. If you need to execute a POST method, create the endpoint in advance and call it via the ",(0,i.kt)("inlineCode",{parentName:"p"},"api_internal")," plugin.")),(0,i.kt)("h3",{id:"api_method-plugin-usage-example"},"api_method plugin usage example"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-smarty"},"{* \xa0Endpoint Configuration Parameters *}\n{assign_array var='method_params' \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 values=''}\n{assign_array var='method_params.topics_group_id' values='1'}\n{assign \xa0 \xa0 \xa0 var='method_params.cnt' \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 value=10}\n{* query parameter *}\n{assign_array var='request_params' \xa0 \xa0 \xa0 \xa0values=''}\n{assign \xa0 \xa0 \xa0 var='request_params.filter' value='ext_col_01 = \"1\"'}\n{api_method\n\xa0 \xa0 var='topics'\n\xa0 \xa0 model='Topics'\n\xa0 \xa0 method='list'\n\xa0 \xa0 version='1'\n\xa0 \xa0 method_params=$method_params\n\xa0 \xa0 request_params=$request_params}\n")),(0,i.kt)("p",null,"The execution result is assigned to the variable specified as ",(0,i.kt)("inlineCode",{parentName:"p"},"var"),"."),(0,i.kt)("p",null,"The data assigned to the ",(0,i.kt)("inlineCode",{parentName:"p"},"$topics")," variable in the above example will be the same as the result of executing a request on the ",(0,i.kt)("a",{parentName:"p",href:"/docs/management/api-list/"},"API")," screen with the following endpoint"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Endpoint Configuration")),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/d4ade2b3929288656e96c68761546332.jpg?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/d4ade2b3929288656e96c68761546332.jpg",alt:"Image from Gyazo"})),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Request")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'fetch(\n\xa0 "https://your-site-key.g.kuroco.app/rcms-api/{api_id}/topics?filter=" + encodeURIComponent(\'ext_col_01 = "1"\'),\n\xa0 {\n\xa0 \xa0 "method": "GET",\n\xa0 }\n);\n')),(0,i.kt)("h2",{id:"use-of-api_internal-plugin-and-api_method-plugin"},"Use of api_internal plugin and api_method plugin"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"api_internal")," plugin must call an existing endpoint, while the ",(0,i.kt)("inlineCode",{parentName:"p"},"api_method")," plugin does not."),(0,i.kt)("p",null,"Therefore, we recommend using ",(0,i.kt)("inlineCode",{parentName:"p"},"api_internal")," if you wish to reuse existing endpoints and ",(0,i.kt)("inlineCode",{parentName:"p"},"api_method")," if you do not need to use endpoints."),(0,i.kt)("h2",{id:"related-documents"},"Related Documents"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/reference/smarty-plugin/"},"Smarty Plugin"))))}d.isMDXComponent=!0}}]);