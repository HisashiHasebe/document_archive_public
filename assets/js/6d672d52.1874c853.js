"use strict";(self.webpackChunkkurokuro=self.webpackChunkkurokuro||[]).push([[10519],{3905:(t,e,a)=>{a.d(e,{Zo:()=>p,kt:()=>f});var n=a(67294);function o(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function r(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function i(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?r(Object(a),!0).forEach((function(e){o(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function l(t,e){if(null==t)return{};var a,n,o=function(t,e){if(null==t)return{};var a,n,o={},r=Object.keys(t);for(n=0;n<r.length;n++)a=r[n],e.indexOf(a)>=0||(o[a]=t[a]);return o}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(n=0;n<r.length;n++)a=r[n],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(o[a]=t[a])}return o}var s=n.createContext({}),c=function(t){var e=n.useContext(s),a=e;return t&&(a="function"==typeof t?t(e):i(i({},e),t)),a},p=function(t){var e=c(t.components);return n.createElement(s.Provider,{value:e},t.children)},d="mdxType",m={inlineCode:"code",wrapper:function(t){var e=t.children;return n.createElement(n.Fragment,{},e)}},u=n.forwardRef((function(t,e){var a=t.components,o=t.mdxType,r=t.originalType,s=t.parentName,p=l(t,["components","mdxType","originalType","parentName"]),d=c(a),u=o,f=d["".concat(s,".").concat(u)]||d[u]||m[u]||r;return a?n.createElement(f,i(i({ref:e},p),{},{components:a})):n.createElement(f,i({ref:e},p))}));function f(t,e){var a=arguments,o=e&&e.mdxType;if("string"==typeof t||o){var r=a.length,i=new Array(r);i[0]=u;var l={};for(var s in e)hasOwnProperty.call(e,s)&&(l[s]=e[s]);l.originalType=t,l[d]="string"==typeof t?t:o,i[1]=l;for(var c=2;c<r;c++)i[c]=a[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},49816:(t,e,a)=>{a.r(e),a.d(e,{assets:()=>s,contentTitle:()=>i,default:()=>m,frontMatter:()=>r,metadata:()=>l,toc:()=>c});var n=a(87462),o=(a(67294),a(3905));const r={title:"Overwriting request values passed to API main processes using custom functions",category:"Operation",weight:1},i=void 0,l={unversionedId:"tutorials/how-to-overwrite-request-for-api-main-process-by-using-function",id:"tutorials/how-to-overwrite-request-for-api-main-process-by-using-function",title:"Overwriting request values passed to API main processes using custom functions",description:"Overview",source:"@site/docs/tutorials/how-to-overwrite-request-for-api-main-process-by-using-function.md",sourceDirName:"tutorials",slug:"/tutorials/how-to-overwrite-request-for-api-main-process-by-using-function",permalink:"/docs/tutorials/how-to-overwrite-request-for-api-main-process-by-using-function",draft:!1,editUrl:"https://github.com/diverta/kuroco-documents/tree/main/packages/create-docusaurus/templates/shared/docs/tutorials/how-to-overwrite-request-for-api-main-process-by-using-function.md",tags:[],version:"current",frontMatter:{title:"Overwriting request values passed to API main processes using custom functions",category:"Operation",weight:1},sidebar:"documentationSidebar",previous:{title:"Implementing custom validation in Content Structure with Custom function",permalink:"/docs/tutorials/how-to-implement-original-validation-in-contents-edit-by-using-function"},next:{title:"Send automated notifications for new content using a custom function",permalink:"/docs/tutorials/how-to-implement-original-function-into-the-middle-of-processing-by-using-function"}},s={},c=[{value:"Overview",id:"overview",level:2},{value:"What you&#39;ll learn",id:"what-youll-learn",level:3},{value:"Creating your custom function",id:"creating-your-custom-function",level:2},{value:"Linking your function to an endpoint",id:"linking-your-function-to-an-endpoint",level:2},{value:"Creating a new endpoint",id:"creating-a-new-endpoint",level:3},{value:"Linking the endpoint with your function",id:"linking-the-endpoint-with-your-function",level:3},{value:"Verifying the implementation",id:"verifying-the-implementation",level:2},{value:"API request",id:"api-request",level:3},{value:"Checking the saved value",id:"checking-the-saved-value",level:3}],p={toc:c},d="wrapper";function m(t){let{components:e,...a}=t;return(0,o.kt)(d,(0,n.Z)({},p,a,{components:e,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"overview"},"Overview"),(0,o.kt)("p",null,"This tutorial explains how to overwrite a request to an API main process via a user-defined custom function. "),(0,o.kt)("p",null,"Custom functions enable you to:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Convert user-input values to specified formats and pass them to target APIs"),(0,o.kt)("li",{parentName:"ul"},"Pass additional constants to target APIs")),(0,o.kt)("h3",{id:"what-youll-learn"},"What you'll learn"),(0,o.kt)("p",null,"For this tutorial, we will implement a process to convert upper-case input in an inquiry reply message into lower-case.",(0,o.kt)("br",{parentName:"p"}),"\n","This comprises the following steps:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#creating-your-custom-function"},"Create a custom case-conversion function")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#creating-a-new-endpoint"},"Create an endpoint for your function")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#linking-the-endpoint-with-your-function"},"Link your function to your endpoint")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#verifying-the-implementation"},"Verify the endpoint operations and stored value"))),(0,o.kt)("h2",{id:"creating-your-custom-function"},"Creating your custom function"),(0,o.kt)("p",null,"In the left sidebar menu, select ","[Operation]"," -> ","[Custom function]","."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/5990a416bbeb67c3250d45c36b73db93.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/5990a416bbeb67c3250d45c36b73db93.png",alt:"Image from Gyazo"})),(0,o.kt)("p",null,"On the Custom function list screen, click ","[Add]"," in the upper right corner."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/198b352de7db4a01b7f287450eebe245.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/198b352de7db4a01b7f287450eebe245.png",alt:"Image from Gyazo"})),(0,o.kt)("p",null,"Enter the title, category, and identifier of the custom function.    "),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"To organize your custom functions for easy access, group them into categories by the module or feature they are used by. You can add and modify categories in the ",(0,o.kt)("a",{parentName:"p",href:"/docs/management/function-category/"},"Custom function category list"),".")),(0,o.kt)("p",null,"For this tutorial, we will use the following values:"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:"left"},"Field"),(0,o.kt)("th",{parentName:"tr",align:"left"},"Value"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},"Title"),(0,o.kt)("td",{parentName:"tr",align:"left"},(0,o.kt)("inlineCode",{parentName:"td"},"/rcms-api/1/inquiry/4/message/send"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},"Category"),(0,o.kt)("td",{parentName:"tr",align:"left"},"API")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},"Identifier"),(0,o.kt)("td",{parentName:"tr",align:"left"},(0,o.kt)("inlineCode",{parentName:"td"},"caseconvert_fxn"))))),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"Titles of custom functions within the same category must be unique. We recommend using the URI path of the associated endpoint as your function title. In this example, we are using the endpoint for sending reply messages to a specified form (inquiry ID = 4).")),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/90c59d819f00f3265e6d184c429f6ad2.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/90c59d819f00f3265e6d184c429f6ad2.png",alt:"Image from Gyazo"})),(0,o.kt)("p",null,'In "Process", select ',"[Kuroco Smarty]"," as the language and paste the code below into the editor:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-smarty"},'{* Initialize $request variable to save output as string array *}\n{assign_array var="request" values=""}\n\n{* e.g. Convert upper-case user input value to lower-case *}\n{if isset($smarty.post.body)}\n  {assign\n    var="request.body"\n    value=$smarty.post.body|lower}\n{/if}\n')),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/5808369476a1de6102c3e4d1dfd2e7af.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/5808369476a1de6102c3e4d1dfd2e7af.png",alt:"Image from Gyazo"})),(0,o.kt)("p",null,"When you are done, click ","[Add]"," at the bottom of the screen to save your function."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/f01cdcb956f3ac7c6d154b1729cc6fbe.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/f01cdcb956f3ac7c6d154b1729cc6fbe.png",alt:"Image from Gyazo"})),(0,o.kt)("h2",{id:"linking-your-function-to-an-endpoint"},"Linking your function to an endpoint"),(0,o.kt)("p",null,"Next, create an endpoint for this conversion feature and connect the function to it.   "),(0,o.kt)("h3",{id:"creating-a-new-endpoint"},"Creating a new endpoint"),(0,o.kt)("p",null,"In the left sidebar menu, click ","[API]"," and select the API where you want to add the target endpoint."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/3d84dc121d611cf447c29e30670f3efb.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/3d84dc121d611cf447c29e30670f3efb.png",alt:"Image from Gyazo"}),"  "),(0,o.kt)("p",null,"On the endpoint list screen, click ","[Add new endpoint]"," to open the configuration dialog."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/eb03dd71cb7922ba9fae536fb7502771.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/eb03dd71cb7922ba9fae536fb7502771.png",alt:"Image from Gyazo"})),(0,o.kt)("p",null,"For this tutorial, we will enter the values below:"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:"left"},"Field"),(0,o.kt)("th",{parentName:"tr",align:"left"},"Sub-field"),(0,o.kt)("th",{parentName:"tr",align:"left"},"Value"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},"Path"),(0,o.kt)("td",{parentName:"tr",align:"left"},"-"),(0,o.kt)("td",{parentName:"tr",align:"left"},"(rcms-api/1/)",(0,o.kt)("inlineCode",{parentName:"td"},"inquiry/4/message/send"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},"Model"),(0,o.kt)("td",{parentName:"tr",align:"left"},"Category"),(0,o.kt)("td",{parentName:"tr",align:"left"},"Form")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"}),(0,o.kt)("td",{parentName:"tr",align:"left"},"Model"),(0,o.kt)("td",{parentName:"tr",align:"left"},"InquiryMessage, v1")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"}),(0,o.kt)("td",{parentName:"tr",align:"left"},"Operation"),(0,o.kt)("td",{parentName:"tr",align:"left"},"send")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},"Basic settings"),(0,o.kt)("td",{parentName:"tr",align:"left"},"id"),(0,o.kt)("td",{parentName:"tr",align:"left"},(0,o.kt)("inlineCode",{parentName:"td"},"4"))))),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Substitute the form id ",(0,o.kt)("inlineCode",{parentName:"p"},"4")," with your form ID, which can be obtained from the ",(0,o.kt)("a",{parentName:"p",href:"/docs/management/inquiry-forms/"},"Form list")," screen.")),(0,o.kt)("p",null,"When you are done, click ","[Add]"," at the bottom of the dialog box to save the endpoint."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/499b43f766ca7964bf69b9503d76fa7e.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/499b43f766ca7964bf69b9503d76fa7e.png",alt:"Image from Gyazo"}),"\n",(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/420f41b7e3fa1c878dc29db709e42a84.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/420f41b7e3fa1c878dc29db709e42a84.png",alt:"Image from Gyazo"})),(0,o.kt)("h3",{id:"linking-the-endpoint-with-your-function"},"Linking the endpoint with your function"),(0,o.kt)("p",null,"On the endpoint list screen, click ","[Pre-processing]"," for the endpoint you created above.  "),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/b8a10ec82489e150e1e917fb7882495f.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/b8a10ec82489e150e1e917fb7882495f.png",alt:"Image from Gyazo"})),(0,o.kt)("p",null,"In the fields that appear below the endpoint, input the following:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Category: API"),(0,o.kt)("li",{parentName:"ul"},"List: /rcms-api/1/inquiry/4/message/send")),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/7ffc40597d9caad72958cd873744885c.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/7ffc40597d9caad72958cd873744885c.png",alt:"Image from Gyazo"})),(0,o.kt)("h2",{id:"verifying-the-implementation"},"Verifying the implementation"),(0,o.kt)("p",null,"As a final step, send a request from the Swagger UI and check the stored value to verify if the conversion function is working as expected.  "),(0,o.kt)("h3",{id:"api-request"},"API request"),(0,o.kt)("p",null,"On the endpoint list screen, click ","[Swagger UI]","."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/366b995ebcf6ea138e74cb32d3a55123.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/366b995ebcf6ea138e74cb32d3a55123.png",alt:"Image from Gyazo"})),(0,o.kt)("p",null,"Select the endpoint you created and click ","[Try it out]","."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/59b3d1a3c7e0c8b43c14138ef3ba203d.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/59b3d1a3c7e0c8b43c14138ef3ba203d.png",alt:"Image from Gyazo"})),(0,o.kt)("p",null,"To test this function, we would send a string containing upper-case letters as the API request.",(0,o.kt)("br",{parentName:"p"}),"\n",'For this tutorial, paste the code below into the "Request body" and click ',"[Execute]",":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="Request body"',title:'"Request','body"':!0},'{\n  "name": "Taro Diverta",\n  "email": "taro@diverta.co.jp",\n  "body": "IMPORTANT MESSAGE. REPLY ASAP.",\n  "from_id": 0,\n  "from_module": "string",\n  "validate_only": false\n}\n')),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"To avoid getting an error response, make sure to fill out all the required fields in your request body. You can view and modify the required fields for a form on the corresponding ",(0,o.kt)("a",{parentName:"p",href:"/docs/management/form-field-settings/"},"Field settings")," screen.")),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/44e78982faffec07cfd75cd61be26a6e.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/44e78982faffec07cfd75cd61be26a6e.png",alt:"Image from Gyazo"})),(0,o.kt)("p",null,"You should see the following response. Note down the ID for later use.  "),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/171c0dfa712bb389be9b0b1ad970bc8f.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/171c0dfa712bb389be9b0b1ad970bc8f.png",alt:"Image from Gyazo"})),(0,o.kt)("h3",{id:"checking-the-saved-value"},"Checking the saved value"),(0,o.kt)("p",null,"In the sidebar menu, select ","[Campaign]"," -> ","[Form]","."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/3965c60c6f5f5657b8331f3849c05fd3.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/3965c60c6f5f5657b8331f3849c05fd3.png",alt:"Image from Gyazo"})),(0,o.kt)("p",null,"On the Form list screen, click the title of the form that is using this custom function.  "),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/7aaf6ff50c614fb656ce2fa2300c9853.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/7aaf6ff50c614fb656ce2fa2300c9853.png",alt:"Image from Gyazo"})),(0,o.kt)("p",null,"In the form editor, click the ","[Answers]"," tab.  "),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/11430d079666800e30cff01d48afee21.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/11430d079666800e30cff01d48afee21.png",alt:"Image from Gyazo"})),(0,o.kt)("p",null,'In the Answers list, find the entry in the "No." column that corresponds to the ID you noted from the API response. Click this number to view the answer details.  '),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/a156061888dab17e587b2cc898241941.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/a156061888dab17e587b2cc898241941.png",alt:"Image from Gyazo"})),(0,o.kt)("p",null,"Verify that the input value has been converted to lower-case.  "),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/e4c46d169aa5232c5c7d165f31a22785.jpg?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/e4c46d169aa5232c5c7d165f31a22785.jpg",alt:"Image from Gyazo"})),(0,o.kt)("p",null,"If the conversion failed, check for the following issues:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"The function has not been properly linked to the endpoint."),(0,o.kt)("li",{parentName:"ul"},"You have linked the wrong custom function."),(0,o.kt)("li",{parentName:"ul"},"The variable name (",(0,o.kt)("inlineCode",{parentName:"li"},"request"),") is incorrect."),(0,o.kt)("li",{parentName:"ul"},"The item to be validated has been specified incorrectly."),(0,o.kt)("li",{parentName:"ul"},"There are errors in the validation logic.")))}m.isMDXComponent=!0}}]);