"use strict";(self.webpackChunkkurokuro=self.webpackChunkkurokuro||[]).push([[95041],{3905:(t,e,a)=>{a.d(e,{Zo:()=>d,kt:()=>g});var n=a(67294);function o(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function r(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function i(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?r(Object(a),!0).forEach((function(e){o(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function l(t,e){if(null==t)return{};var a,n,o=function(t,e){if(null==t)return{};var a,n,o={},r=Object.keys(t);for(n=0;n<r.length;n++)a=r[n],e.indexOf(a)>=0||(o[a]=t[a]);return o}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(n=0;n<r.length;n++)a=r[n],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(o[a]=t[a])}return o}var c=n.createContext({}),s=function(t){var e=n.useContext(c),a=e;return t&&(a="function"==typeof t?t(e):i(i({},e),t)),a},d=function(t){var e=s(t.components);return n.createElement(c.Provider,{value:e},t.children)},p="mdxType",u={inlineCode:"code",wrapper:function(t){var e=t.children;return n.createElement(n.Fragment,{},e)}},m=n.forwardRef((function(t,e){var a=t.components,o=t.mdxType,r=t.originalType,c=t.parentName,d=l(t,["components","mdxType","originalType","parentName"]),p=s(a),m=o,g=p["".concat(c,".").concat(m)]||p[m]||u[m]||r;return a?n.createElement(g,i(i({ref:e},d),{},{components:a})):n.createElement(g,i({ref:e},d))}));function g(t,e){var a=arguments,o=e&&e.mdxType;if("string"==typeof t||o){var r=a.length,i=new Array(r);i[0]=m;var l={};for(var c in e)hasOwnProperty.call(e,c)&&(l[c]=e[c]);l.originalType=t,l[p]="string"==typeof t?t:o,i[1]=l;for(var s=2;s<r;s++)i[s]=a[s];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},842:(t,e,a)=>{a.r(e),a.d(e,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>s});var n=a(87462),o=(a(67294),a(3905));const r={title:'Handling a "generate" error in GitHub Actions',category:"KurocoFront",weight:1},i=void 0,l={unversionedId:"tutorials/handling-a-generate-error-in-github-actions",id:"tutorials/handling-a-generate-error-in-github-actions",title:'Handling a "generate" error in GitHub Actions',description:"For websites managed by KurocoFront, a generate error can in turn trigger a 404 error. This tutorial explains how to abort the build when an error occurs during the generate process. You will also learn how to set up Slack notifications for this system abort event.",source:"@site/docs/tutorials/handling-a-generate-error-in-github-actions.md",sourceDirName:"tutorials",slug:"/tutorials/handling-a-generate-error-in-github-actions",permalink:"/docs/tutorials/handling-a-generate-error-in-github-actions",draft:!1,editUrl:"https://github.com/diverta/kuroco-documents/tree/main/packages/create-docusaurus/templates/shared/docs/tutorials/handling-a-generate-error-in-github-actions.md",tags:[],version:"current",frontMatter:{title:'Handling a "generate" error in GitHub Actions',category:"KurocoFront",weight:1},sidebar:"documentationSidebar",previous:{title:"Using the KurocoFront app domain for your front-end staging site",permalink:"/docs/tutorials/kurocofront-app-domain-for-front-end-staging-site"},next:{title:"Notify GitHub Actions build results to Slack using slack-send",permalink:"/docs/tutorials/handling-a-slack-send-in-github-actions"}},c={},s=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Aborting the build if an error occurs during <code>nuxt generate</code>",id:"aborting-the-build-if-an-error-occurs-during-nuxt-generate",level:2},{value:"Modify package.json",id:"modify-packagejson",level:3},{value:"Setting up Slack notifications for build failures",id:"setting-up-slack-notifications-for-build-failures",level:2},{value:"Add Incoming Webhooks to your Slack channel",id:"add-incoming-webhooks-to-your-slack-channel",level:3},{value:"Add the Webhook URL to the GitHub Actions secrets",id:"add-the-webhook-url-to-the-github-actions-secrets",level:3},{value:"Modify the YAML file in .github/workflows",id:"modify-the-yaml-file-in-githubworkflows",level:3},{value:"Add to &#39;pullreq_build&#39;",id:"add-to-pullreq_build",level:4},{value:"Add to &#39;pushed_build&#39;",id:"add-to-pushed_build",level:4}],d={toc:s},p="wrapper";function u(t){let{components:e,...a}=t;return(0,o.kt)(p,(0,n.Z)({},d,a,{components:e,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"For websites managed by KurocoFront, a ",(0,o.kt)("inlineCode",{parentName:"p"},"generate")," error can in turn trigger a 404 error. This tutorial explains how to abort the build when an error occurs during the ",(0,o.kt)("inlineCode",{parentName:"p"},"generate")," process. You will also learn how to set up Slack notifications for this system abort event."),(0,o.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,o.kt)("p",null,"This tutorial assumes that you are managing your site using the following frameworks:  "),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Nuxt.js"),(0,o.kt)("li",{parentName:"ul"},"KurocoFront")),(0,o.kt)("h2",{id:"aborting-the-build-if-an-error-occurs-during-nuxt-generate"},"Aborting the build if an error occurs during ",(0,o.kt)("inlineCode",{parentName:"h2"},"nuxt generate")),(0,o.kt)("h3",{id:"modify-packagejson"},"Modify package.json"),(0,o.kt)("p",null,"Add the ",(0,o.kt)("inlineCode",{parentName:"p"},"--fail-on-error")," option to the ",(0,o.kt)("inlineCode",{parentName:"p"},"nuxt generate")," command in package.json as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json",metastring:"[package.json]","[package.json]":!0},'{\n  ...,\n  "scripts": {\n    ...\n    "build": "cross-env NODE_ENV=development nuxt build",\n    "generate": "cross-env NODE_ENV=development nuxt generate \u2013fail-on-error",\n    "build-prod": "cross-env NODE_ENV=production nuxt build",\n    "generate-prod": "cross-env NODE_ENV=production nuxt generate \u2013fail-on-error",\n    ...\n  },\n  ...\n}\n')),(0,o.kt)("p",null,"This allows the system to abort the build method if an error occurs during ",(0,o.kt)("inlineCode",{parentName:"p"},"nuxt generate"),".  "),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},(0,o.kt)("inlineCode",{parentName:"p"},"\u2013fail-on-error")," is only available in Nuxt v2.14.4 and later. Refer to the ",(0,o.kt)("a",{parentName:"p",href:"https://nuxtjs.org/docs/get-started/commands/#fail-on-error"},"official NuxtJS documentation")," for more details.")),(0,o.kt)("h2",{id:"setting-up-slack-notifications-for-build-failures"},"Setting up Slack notifications for build failures"),(0,o.kt)("p",null,"At this point, you would have to access GitHub Actions manually to verify the build status and look for any errors. To save yourself some time and trouble, you can set up automated Slack notifications for build failures."),(0,o.kt)("h3",{id:"add-incoming-webhooks-to-your-slack-channel"},"Add Incoming Webhooks to your Slack channel"),(0,o.kt)("p",null,"Go to ",(0,o.kt)("inlineCode",{parentName:"p"},"https://[WORK-SPACE-ID].slack.com/apps"),"."),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Substitute ","[WORK-SPACE-ID]"," in the above URL with your own Slack workspace ID.  ")),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/debd1e9daeb48ae976dc6051fe59e015.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/debd1e9daeb48ae976dc6051fe59e015.png",alt:"fetched from Gyazo"}),'\nSearch for "Incoming Webhooks".  '),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/440204c0b723d09e09ebcca0c1024726.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/440204c0b723d09e09ebcca0c1024726.png",alt:"fetched from Gyazo"}),"\nClick ","[Add to Slack]","."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/2bf2eb2721d932e1ddf4dad42dc6acec.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/2bf2eb2721d932e1ddf4dad42dc6acec.png",alt:"fetched from Gyazo"}),"\nSelect the channel you want to add them to."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/19240a62dd33500c4c24c7d5ce4ab03b.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/19240a62dd33500c4c24c7d5ce4ab03b.png",alt:"fetched from Gyazo"}),"\nClick the ","[Add Incoming Webhooks integration]"," button."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/a117f7e61a675488e2155790904c6528.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/a117f7e61a675488e2155790904c6528.png",alt:"fetched from Gyazo"}),"\nYou have successfully added Incoming Webhooks to your Slack channel.  "),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/693e1119dac1d9e7a6b4c41e3094ce31.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/693e1119dac1d9e7a6b4c41e3094ce31.png",alt:"fetched from Gyazo"}),"  "),(0,o.kt)("p",null,"Copy the Webhook URL for later use.  "),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/668e0b87dbab91ebdfd203fca3e31ce4.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/668e0b87dbab91ebdfd203fca3e31ce4.png",alt:"fetched from Gyazo"})),(0,o.kt)("h3",{id:"add-the-webhook-url-to-the-github-actions-secrets"},"Add the Webhook URL to the GitHub Actions secrets"),(0,o.kt)("p",null,"Next, configure your GitHub settings. In the corresponding GitHub repository, click ","[Settings]"," -> ","[Secrets]"," to access the Actions secrets screen.  "),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/8fdbef7e1553cb0c6d58518990e26cb5.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/8fdbef7e1553cb0c6d58518990e26cb5.png",alt:"Image from Gyazo"}),"\nClick ","[New repository secret]",".  "),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/83548bfa32e7013fee8cb4749095f748.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/83548bfa32e7013fee8cb4749095f748.png",alt:"Image from Gyazo"}),"\nEnter the following details and click ","[Add secret]",".  "),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,o.kt)("th",{parentName:"tr",align:"left"},"Value"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},"Name"),(0,o.kt)("td",{parentName:"tr",align:"left"},"SLACK_WEBHOOK_URL")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},"Value"),(0,o.kt)("td",{parentName:"tr",align:"left"},"The Webhook URL you copied")))),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/22b7973a2c06a4b1b94b8110ca4f34a3.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/22b7973a2c06a4b1b94b8110ca4f34a3.png",alt:"Image from Gyazo"}),'\nThe new entry will appear under "Repository secrets".  '),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/fd59cc6b346fe879b47d1f2035671b9d.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/fd59cc6b346fe879b47d1f2035671b9d.png",alt:"Image from Gyazo"})),(0,o.kt)("h3",{id:"modify-the-yaml-file-in-githubworkflows"},"Modify the YAML file in .github/workflows"),(0,o.kt)("p",null,"Lastly, add the Slack notification settings to the YAML file in the ",(0,o.kt)("inlineCode",{parentName:"p"},".github/workflows")," directory. Enter the settings below in the ",(0,o.kt)("inlineCode",{parentName:"p"},"pullreq_build")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"pushed_build")," steps of the YAML file.  "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yml"},"      - name: Slack Notification on Failure\n        uses: rtCamp/action-slack-notify@master\n        if: failure()\n        env:\n          SLACK_CHANNEL: kuroco_channel\n          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK_URL }}\n          SLACK_TITLE: build error\n          SLACK_MESSAGE: 'https://example.g.kuroco.app/'\n          SLACK_COLOR: danger\n")),(0,o.kt)("p",null,"Modify the items below according to your environment:  "),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,o.kt)("th",{parentName:"tr",align:"left"},"Value"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},"SLACK_CHANNEL"),(0,o.kt)("td",{parentName:"tr",align:"left"},"Name of the channel that will be notified.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},"SLACK_MESSAGE"),(0,o.kt)("td",{parentName:"tr",align:"left"},"Content of notification message.")))),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"This tutorial uses ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/rtCamp/action-slack-notify"},"rtCamp/action-slack-notify")," for the Slack notification.")),(0,o.kt)("h4",{id:"add-to-pullreq_build"},"Add to 'pullreq_build'"),(0,o.kt)("p",null,"Paste the above code into the ",(0,o.kt)("inlineCode",{parentName:"p"},"pullreq_build")," step.  "),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/901a095c3a4a8a06e783526ca3f27e30.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/901a095c3a4a8a06e783526ca3f27e30.png",alt:"Image from Gyazo"})),(0,o.kt)("h4",{id:"add-to-pushed_build"},"Add to 'pushed_build'"),(0,o.kt)("p",null,"Similarly, paste the same code into the ",(0,o.kt)("inlineCode",{parentName:"p"},"pushed_build")," step."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/120be53bdf79c62c79981e6612ab6653.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/120be53bdf79c62c79981e6612ab6653.png",alt:"Image from Gyazo"}),"\nThe settings are now complete. You will receive a Slack notification every time an error occurs during the ",(0,o.kt)("inlineCode",{parentName:"p"},"generate")," process.  "),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/381ab88698119c2583c27c40c4e175c7.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/381ab88698119c2583c27c40c4e175c7.png",alt:"Image from Gyazo"})))}u.isMDXComponent=!0}}]);