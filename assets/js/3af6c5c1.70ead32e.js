"use strict";(self.webpackChunkkurokuro=self.webpackChunkkurokuro||[]).push([[61819],{3905:(e,t,a)=>{a.d(t,{Zo:()=>l,kt:()=>h});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function c(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},l=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),d=p(a),u=r,h=d["".concat(s,".").concat(u)]||d[u]||m[u]||o;return a?n.createElement(h,i(i({ref:t},l),{},{components:a})):n.createElement(h,i({ref:t},l))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=u;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c[d]="string"==typeof e?e:r,i[1]=c;for(var p=2;p<o;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},6200:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>m,frontMatter:()=>o,metadata:()=>c,toc:()=>p});var n=a(87462),r=(a(67294),a(3905));const o={title:"Using reCAPTCHA for forms",category:"External system integration",weight:1},i=void 0,c={unversionedId:"tutorials/using-recaptcha",id:"tutorials/using-recaptcha",title:"Using reCAPTCHA for forms",description:"reCAPTCHA is a free function provided by Google to protect your website from malicious spam sent through inquiry forms or other contact forms.",source:"@site/docs/tutorials/using-recaptcha.md",sourceDirName:"tutorials",slug:"/tutorials/using-recaptcha",permalink:"/docs/tutorials/using-recaptcha",draft:!1,editUrl:"https://github.com/diverta/kuroco-documents/tree/main/packages/create-docusaurus/templates/shared/docs/tutorials/using-recaptcha.md",tags:[],version:"current",frontMatter:{title:"Using reCAPTCHA for forms",category:"External system integration",weight:1},sidebar:"documentationSidebar",previous:{title:"Send notification of receiving inquiries to Slack.",permalink:"/docs/tutorials/send-slack-notification-after-a-form-has-been-submitted"},next:{title:"Using reCAPTCHA for password reminders",permalink:"/docs/tutorials/using-recaptcha-for-password-reminders"}},s={},p=[{value:"Prerequisite",id:"prerequisite",level:2},{value:"Obtaining the API key",id:"obtaining-the-api-key",level:2},{value:"Access the Google reCAPTCHA page",id:"access-the-google-recaptcha-page",level:3},{value:"Register your website",id:"register-your-website",level:3},{value:"Verify the site key and secret key",id:"verify-the-site-key-and-secret-key",level:3},{value:"Configuring the Kuroco management screen",id:"configuring-the-kuroco-management-screen",level:2},{value:"Access the reCAPTCHA setup screen",id:"access-the-recaptcha-setup-screen",level:3},{value:"Enter the reCAPTCHA site key and secret key",id:"enter-the-recaptcha-site-key-and-secret-key",level:3},{value:"Setting up the Kuroco endpoint",id:"setting-up-the-kuroco-endpoint",level:2},{value:"Enable the use of reCAPTCHA",id:"enable-the-use-of-recaptcha",level:3},{value:"Verify the configuration Swagger",id:"verify-the-configuration-swagger",level:3},{value:"Implementing the reCAPTCHA authentication",id:"implementing-the-recaptcha-authentication",level:2},{value:"Install the reCAPTCHA module",id:"install-the-recaptcha-module",level:3},{value:"Modify nuxt.config.js",id:"modify-nuxtconfigjs",level:3},{value:"Setting up reCAPTCHA in the front-end",id:"setting-up-recaptcha-in-the-front-end",level:2},{value:"Implement the authentication component",id:"implement-the-authentication-component",level:3},{value:"Add the authentication component to the form page",id:"add-the-authentication-component-to-the-form-page",level:3},{value:"Verify the response",id:"verify-the-response",level:3}],l={toc:p},d="wrapper";function m(e){let{components:t,...a}=e;return(0,r.kt)(d,(0,n.Z)({},l,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"reCAPTCHA is a free function provided by Google to protect your website from malicious spam sent through inquiry forms or other contact forms.  "),(0,r.kt)("p",null,"This tutorial explains how to integrate ",(0,r.kt)("a",{parentName:"p",href:"https://developers.google.com/recaptcha/docs/display"},"reCAPTCHA v2")," into your site contact form."),(0,r.kt)("h2",{id:"prerequisite"},"Prerequisite"),(0,r.kt)("p",null,"Assuming that you have completed the tutorial on ",(0,r.kt)("a",{parentName:"p",href:"/docs/tutorials/setting-up-inquiry-forms/"},"Setting up inquiry forms with Kuroco and Nuxt.js")," and have a basic understanding of form implementation."),(0,r.kt)("h2",{id:"obtaining-the-api-key"},"Obtaining the API key"),(0,r.kt)("p",null,"To use reCAPTCHA in Kuroco, you need the reCAPTCHA API key. This section explains how to obtain the API key and set it up on the Kuroco management screen.  "),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Note: To use reCAPTCHA, you need a Google Account. You can sign up for it ",(0,r.kt)("a",{parentName:"p",href:"https://www.google.com/account/about/"},"here"),".  ")),(0,r.kt)("h3",{id:"access-the-google-recaptcha-page"},"Access the Google reCAPTCHA page"),(0,r.kt)("p",null,"Go to ",(0,r.kt)("a",{parentName:"p",href:"https://www.google.com/recaptcha/about/"},"Google reCAPTCHA")," and click ","[v3 Admin Console]"," at the top of the screen.  "),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/236162013b3d159f9160743fb3a37147.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/236162013b3d159f9160743fb3a37147.png",alt:"Image (fetched from Gyazo)"})),(0,r.kt)("h3",{id:"register-your-website"},"Register your website"),(0,r.kt)("p",null,"Enter the required information on the registration page.",(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/5c76014a8dcc95c39da8bbb3e430d92a.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/5c76014a8dcc95c39da8bbb3e430d92a.png",alt:"fetched from Gyazo"})),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"th"},"Item")),(0,r.kt)("th",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"th"},"Description")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Label"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Enter a name that is easy to understand (e.g., the name of your site).")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"reCAPTCHA type"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Select ","[reCAPTCHA v2]"," and ",'["I\'m not a robot" tickbox]',".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Domain"),(0,r.kt)("td",{parentName:"tr",align:"left"},'Enter the Front-end domain without "',(0,r.kt)("inlineCode",{parentName:"td"},"https://"),'".',(0,r.kt)("br",null),"example: ",(0,r.kt)("inlineCode",{parentName:"td"},"sitekey.g.kuroco-front.app"))))),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"When testing in a local environment, add ",(0,r.kt)("inlineCode",{parentName:"p"},"localhost")," to the domain.")),(0,r.kt)("p",null,'Read the terms of use and select "Accept the reCAPTCHA terms of service". Verify that all the information is correct and click ',"[Send]",".  "),(0,r.kt)("h3",{id:"verify-the-site-key-and-secret-key"},"Verify the site key and secret key"),(0,r.kt)("p",null,"If the request is successful, the site key and secret key will be displayed.  "),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/6e3eea5c7f3a9d73b549af5feb3fb5cf.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/6e3eea5c7f3a9d73b549af5feb3fb5cf.png",alt:"fetched from Gyazo"})),(0,r.kt)("p",null,"Copy these keys to be used later.  "),(0,r.kt)("h2",{id:"configuring-the-kuroco-management-screen"},"Configuring the Kuroco management screen"),(0,r.kt)("h3",{id:"access-the-recaptcha-setup-screen"},"Access the reCAPTCHA setup screen"),(0,r.kt)("p",null,"Log in to the Kuroco management screen. In the sidebar menu, click ","[External system integration]"," -> ","[reCAPTCHA]",".  "),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/7187bf05ad7597d06879094c025b8179.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/7187bf05ad7597d06879094c025b8179.png",alt:"fetched from Gyazo"})),(0,r.kt)("h3",{id:"enter-the-recaptcha-site-key-and-secret-key"},"Enter the reCAPTCHA site key and secret key"),(0,r.kt)("p",null,"Enter the site key and secret key you copied earlier in the corresponding fields."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/c02f6155a9131a7c88466f88ad7debb4.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/c02f6155a9131a7c88466f88ad7debb4.png",alt:"fetched from Gyazo"})),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"reCaptcha Site Key"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Enter the site key you copied earlier.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"reCaptcha Secret Key"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Enter the secret key you copied earlier.")))),(0,r.kt)("p",null,"When you have entered both keys, click ","[Update]","."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/b4e1200f7b9637ec2f3aaaaa964a583b.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/b4e1200f7b9637ec2f3aaaaa964a583b.png",alt:"fetched from Gyazo"})),(0,r.kt)("h2",{id:"setting-up-the-kuroco-endpoint"},"Setting up the Kuroco endpoint"),(0,r.kt)("h3",{id:"enable-the-use-of-recaptcha"},"Enable the use of reCAPTCHA"),(0,r.kt)("p",null,"Next, go to the endpoint list screen. Click the ","[Update]"," button next to the ",(0,r.kt)("inlineCode",{parentName:"p"},"InquiryMessage::send")," endpoint."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/8e2ce65cf590b7b71baae221a78b5574.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/8e2ce65cf590b7b71baae221a78b5574.png",alt:"fetched from Gyazo"})),(0,r.kt)("p",null,'On the configuration dialog, check the "use_recaptcha" box and click ',"[Update]","."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/3d1deee80a58414d5c9e14274187455b.jpg?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/3d1deee80a58414d5c9e14274187455b.jpg",alt:"Image from Gyazo"})),(0,r.kt)("h3",{id:"verify-the-configuration-swagger"},"Verify the configuration Swagger"),(0,r.kt)("p",null,"After configuring your endpoint, verify if it is working. To do so, click the ","[Swagger UI]"," button on the endpoint list screen."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/24e40b674f68e4627f9806cbf632eb28.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/24e40b674f68e4627f9806cbf632eb28.png",alt:"fetched from Gyazo"})),(0,r.kt)("p",null,"On the Swagger UI screen, click the endpoint you configured earlier.  "),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/7b81352b5ebed36acede640de087d154.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/7b81352b5ebed36acede640de087d154.png",alt:"fetched from Gyazo"}),"  "),(0,r.kt)("p",null,'Click "Schema" in the request body.'),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/69c972d553228f5088351a76f0dcfaa8.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/69c972d553228f5088351a76f0dcfaa8.png",alt:"fetched from Gyazo"})),(0,r.kt)("p",null,'Look for the property named "recaptcha_response".  '),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/237c775c6bbb3b198f91ac3e6ccc6d10.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/237c775c6bbb3b198f91ac3e6ccc6d10.png",alt:"fetched from Gyazo"}),"  "),(0,r.kt)("h2",{id:"implementing-the-recaptcha-authentication"},"Implementing the reCAPTCHA authentication"),(0,r.kt)("h3",{id:"install-the-recaptcha-module"},"Install the reCAPTCHA module"),(0,r.kt)("p",null,"First, install the Nuxt.js reCAPTCHA module.  "),(0,r.kt)("p",null,"Execute the following code in the terminal:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"npm i @nuxtjs/recaptcha\n")),(0,r.kt)("h3",{id:"modify-nuxtconfigjs"},"Modify nuxt.config.js"),(0,r.kt)("p",null,"Next, add the reCAPTCHA to your Nuxt configuration file. Paste the module below into nuxt.config.js:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"  modules: [\n    '@nuxtjs/recaptcha',\n  ],\n")),(0,r.kt)("p",null,"In addition, add the following code to the module:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"}," recaptcha: {\n    hideBadge: true,\n    language: 'en',\n    siteKey: 'reCAPTCHA_SITE_KEY',\n    version: 2,\n    size: 'normal'\n  },\n")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/3de78ebc970bebadfc755c4723eb5718.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/3de78ebc970bebadfc755c4723eb5718.png",alt:"Image from Gyazo"})),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Substitute the expression ",(0,r.kt)("inlineCode",{parentName:"p"},"reCAPTCHA_SITE_KEY")," in the above code with the site key you have copied earlier. ")),(0,r.kt)("h2",{id:"setting-up-recaptcha-in-the-front-end"},"Setting up reCAPTCHA in the front-end"),(0,r.kt)("p",null,"The next section explains how to set up reCAPTCHA in the front-end. For this tutorial, we will implement it on the contact form.  "),(0,r.kt)("h3",{id:"implement-the-authentication-component"},"Implement the authentication component"),(0,r.kt)("p",null,"First, create an authentication component. For this tutorial, we will make a file named ",(0,r.kt)("inlineCode",{parentName:"p"},"inquiry-recaptcha.vue")," under ",(0,r.kt)("inlineCode",{parentName:"p"},"components/inquiry"),".  "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-markup",metastring:'title="/components/inquiry/inquiry-recaptcha.vue"',title:'"/components/inquiry/inquiry-recaptcha.vue"'},"<template>\n  <recaptcha @error=\"onError\" @success=\"onSuccess\" @expired=\"isExpired\" />\n</template>\n<script>\nexport default {\n  methods: {\n    onError() {\n      this.$emit('update:is-succeeded', false);\n    },\n    onSuccess() {\n      this.$emit('update:is-succeeded', true);\n    },\n    isExpired() {\n      this.$emit('update:is-succeeded', false);\n    },\n    async fetchResponse() {\n      let response;\n      try {\n        response = await this.$recaptcha.getResponse();\n      } catch (error) {\n        response = '';\n      }\n      this.$emit('update:is-succeeded', !!response);\n      return response;\n    }\n  }\n}\n<\/script>\n")),(0,r.kt)("h3",{id:"add-the-authentication-component-to-the-form-page"},"Add the authentication component to the form page"),(0,r.kt)("p",null,"Next, in the form screen where you want to integrate reCAPTCHA, use the authentication component mentioned above. For this example, we have created ",(0,r.kt)("inlineCode",{parentName:"p"},"/pages/form/index.vue")," as follows:"),(0,r.kt)("p",null,"We obtain the ",(0,r.kt)("inlineCode",{parentName:"p"},"recaptcha_response")," using ",(0,r.kt)("inlineCode",{parentName:"p"},"await this.$refs.recaptcha.fetchResponse()")," and send it to Kuroco via a POST request along with the form data.",(0,r.kt)("br",{parentName:"p"}),"\n","data to Kuroco using POST. After submission, you need to call ",(0,r.kt)("inlineCode",{parentName:"p"},"await this.$recaptcha.reset()"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-markup",metastring:'reference title="/pages/form/index.vue"',reference:!0,title:'"/pages/form/index.vue"'},"https://github.com/diverta/kuroco-documents/blob/main/sample_code/front-end/nuxtjs/recaptcha_for_form.vue\n")),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"We have added a form for testing the functionality of reCAPTCHA, which includes only the default field settings ",(0,r.kt)("inlineCode",{parentName:"p"},"name"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"email"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"message"),". Please adjust the form ID and endpoint URL to your own.")),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"The above code is a minimal and simplified version.")),(0,r.kt)("p",null,"You will then find the following reCAPTCHA displayed on the contact form page.  "),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/08648e615c42dc7e8cb6ba5cf8628703.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/08648e615c42dc7e8cb6ba5cf8628703.png",alt:"Image from Gyazo"})),(0,r.kt)("h3",{id:"verify-the-response"},"Verify the response"),(0,r.kt)("p",null,'When you check the "I\'m not a robot" checkbox, the Submit button becomes clickable. Upon clicking the Submit button, the recaptcha_response is posted to Kuroco along with the form data, and the provided token is automatically validated. If a valid value is passed, the form submission is completed.'),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/1e09361ccbed15f2c5f53c321f17c95c.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/1e09361ccbed15f2c5f53c321f17c95c.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Otherwise, you will get the following error:  "),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/4e37dcb7eefbfaa5a238a80e7f7356d3.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/4e37dcb7eefbfaa5a238a80e7f7356d3.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"You have now set up a basic reCAPTCHA function on your site. Refer to ",(0,r.kt)("a",{parentName:"p",href:"https://developers.google.com/recaptcha/docs/display"},"Google Developers reCAPTCHA v2")," for more detailed configurations. "),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Authentication tokens are only required for non-logged-in users (i.e., guests). Logged-in users can skip the verification process.")))}m.isMDXComponent=!0}}]);