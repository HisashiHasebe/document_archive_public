"use strict";(self.webpackChunkkurokuro=self.webpackChunkkurokuro||[]).push([[41385],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>g});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=r.createContext({}),c=function(e){var t=r.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=c(e.components);return r.createElement(p.Provider,{value:t},e.children)},d="mdxType",l={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,p=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=c(n),m=a,g=d["".concat(p,".").concat(m)]||d[m]||l[m]||o;return n?r.createElement(g,i(i({ref:t},u),{},{components:n})):r.createElement(g,i({ref:t},u))}));function g(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=m;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s[d]="string"==typeof e?e:a,i[1]=s;for(var c=2;c<o;c++)i[c]=n[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},13433:(e,t,n)=>{n.d(t,{Z:()=>a});var r=n(67294);function a(e){let{faqs:t=[]}=e;if(0===(Array.isArray(t)?t.filter((e=>e.question&&e.answer)):[]).length)return null;const n={"@context":"https://schema.org","@type":"FAQPage",mainEntity:t.map((e=>({"@type":"Question",name:e.question,acceptedAnswer:{"@type":"Answer",text:e.answer}})))},a=JSON.stringify(n,null,2);return r.createElement("script",{type:"application/ld+json"},a)}},34046:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>m,frontMatter:()=>i,metadata:()=>p,toc:()=>u});var r=n(87462),a=(n(67294),n(3905)),o=n(13433);const i={title:"API returns 403 Forbidden even though no restrictions are applied",description:"Some endpoints require login for security reasons and cannot be accessed publicly. Please design them to be used after the login process or use custom processing to retrieve the response.",category:"trouble"},s=void 0,p={unversionedId:"faq/the-api-returns-403-forbidden-even-though-no-restrictions-are-applied",id:"faq/the-api-returns-403-forbidden-even-though-no-restrictions-are-applied",title:"API returns 403 Forbidden even though no restrictions are applied",description:"Some endpoints require login for security reasons and cannot be accessed publicly. Please design them to be used after the login process or use custom processing to retrieve the response.",source:"@site/docs/faq/the-api-returns-403-forbidden-even-though-no-restrictions-are-applied.mdx",sourceDirName:"faq",slug:"/faq/the-api-returns-403-forbidden-even-though-no-restrictions-are-applied",permalink:"/docs/faq/the-api-returns-403-forbidden-even-though-no-restrictions-are-applied",draft:!1,editUrl:"https://github.com/diverta/kuroco-documents/tree/main/packages/create-docusaurus/templates/shared/docs/faq/the-api-returns-403-forbidden-even-though-no-restrictions-are-applied.mdx",tags:[],version:"current",frontMatter:{title:"API returns 403 Forbidden even though no restrictions are applied",description:"Some endpoints require login for security reasons and cannot be accessed publicly. Please design them to be used after the login process or use custom processing to retrieve the response.",category:"trouble"},sidebar:"faqSidebar",previous:{title:"The custom domain I set up is not displaying my site. What checks should I perform?",permalink:"/docs/faq/setting-up-a-custom-domain"},next:{title:"The ordering of the form fields is not reflected in the API. What should I do?",permalink:"/docs/faq/the-ordering-of-form-fields-is-not-reflected-in-the-api"}},c={},u=[{value:"Using api_internal",id:"using-api_internal",level:2},{value:"Setting up custom processing",id:"setting-up-custom-processing",level:3},{value:"Setting up the endpoint",id:"setting-up-the-endpoint",level:3},{value:"Using pre-processing",id:"using-pre-processing",level:2},{value:"Setting up custom processing",id:"setting-up-custom-processing-1",level:3},{value:"Setting up the endpoint",id:"setting-up-the-endpoint-1",level:3},{value:"Related Documents",id:"related-documents",level:2}],d={toc:u},l="wrapper";function m(e){let{components:t,...n}=e;return(0,a.kt)(l,(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)(o.Z,{faqs:[{question:"API returns 403 Forbidden even though no restrictions are applied",answer:"Some endpoints require login for security reasons and cannot be accessed publicly. Please design them to be used after the login process or use custom processing to retrieve the response."}],mdxType:"StructuredDataFaqs"}),(0,a.kt)("p",null,"Some endpoints, such as the API for creating content (Topics::insert), require login for security reasons and cannot be accessed publicly. Please design them to be used after the login process or use custom processing to send requests to the endpoints."),(0,a.kt)("p",null,"There are several ways to use the endpoints with authentication using custom processing:"),(0,a.kt)("h2",{id:"using-api_internal"},"Using api_internal"),(0,a.kt)("p",null,"You can use the ",(0,a.kt)("inlineCode",{parentName:"p"},"api_internal")," plugin in the ",(0,a.kt)("inlineCode",{parentName:"p"},"Api::request_api")," endpoint to call custom processing and use the ",(0,a.kt)("inlineCode",{parentName:"p"},"api_internal")," plugin to send a request to the Topics::insert endpoint with the desired authentication information. In ",(0,a.kt)("inlineCode",{parentName:"p"},"api_internal"),", you can execute the request with the specified member ID in an authenticated state by passing the ",(0,a.kt)("inlineCode",{parentName:"p"},"member_id")," parameter."),(0,a.kt)("h3",{id:"setting-up-custom-processing"},"Setting up custom processing"),(0,a.kt)("p",null,"First, set the following code in the ",(0,a.kt)("a",{parentName:"p",href:"/docs/management/function/"},"custom function"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-smarty"},"{* Request body *}\n{assign_array var='body'            values=''}\n{assign       var='body.subject'    value=$smarty.request.subject}\n\n{api_internal\n    var='response'\n    status_var='status'\n    endpoint='/rcms-api/39/topics/insert'\n    method='POST'\n    queries=$body\n    member_id='1'}\n\n{assign var=data value=$response}\n")),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/dd9be7cb1833bfded9c87f9fa5666144.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/dd9be7cb1833bfded9c87f9fa5666144.png",alt:"Image from Gyazo"})),(0,a.kt)("admonition",{type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"For the ",(0,a.kt)("inlineCode",{parentName:"p"},"/rcms-api/39/topics/insert"),' endpoint, use the Topics::insert endpoint and set the authentication method of the API to "Dynamic Access Token".')),(0,a.kt)("h3",{id:"setting-up-the-endpoint"},"Setting up the endpoint"),(0,a.kt)("p",null,"Next, create the Api::request_api_post endpoint. Enter the identifier set in the custom processing in the name field. Also, make sure to set the API security to use a public authentication separate from ",(0,a.kt)("inlineCode",{parentName:"p"},"/rcms-api/39/topics/insert"),"."),(0,a.kt)("p",null,"Example:",(0,a.kt)("br",{parentName:"p"}),"\n","Topics::insert: Set the API security to Dynamic Access Token.",(0,a.kt)("br",{parentName:"p"}),"\n","Api::request_api_post: Set the API security to Cookie."),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/d6c4a4738fc67c2c6b2a8d6cf825ee9c.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/d6c4a4738fc67c2c6b2a8d6cf825ee9c.png",alt:"Image from Gyazo"})),(0,a.kt)("p",null,"When you hit the request_api_post endpoint in Swagger UI, you can see that the content is being added."),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/620c676899fb91f5efb49fd2b5b59b47.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/620c676899fb91f5efb49fd2b5b59b47.png",alt:"Image from Gyazo"})),(0,a.kt)("h2",{id:"using-pre-processing"},"Using pre-processing"),(0,a.kt)("p",null,"Create a custom processing that logs in with a member ID that has the necessary permissions and retrieve the response by setting it as the pre-processing for the Topics::insert endpoint."),(0,a.kt)("h3",{id:"setting-up-custom-processing-1"},"Setting up custom processing"),(0,a.kt)("p",null,"First, set the following code in the ",(0,a.kt)("a",{parentName:"p",href:"/docs/management/function/"},"custom processing"),". Please specify the member ID that has the permission to view the content definition."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-smarty"},"{login member_id=1 overwrite=false} {* Log in as member_id:1 *}\n")),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/6e72e20a9f817abae3d37c072a71c416.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/6e72e20a9f817abae3d37c072a71c416.png",alt:"Image from Gyazo"})),(0,a.kt)("h3",{id:"setting-up-the-endpoint-1"},"Setting up the endpoint"),(0,a.kt)("p",null,"Next, set the added custom processing as the pre-processing for the Topics::insert endpoint."),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/a71557e0e08b10c52cd475fb02f046a2.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/a71557e0e08b10c52cd475fb02f046a2.png",alt:"Image from Gyazo"})),(0,a.kt)("p",null,"When you hit the endpoint in Swagger UI, you can see that the content is being added."),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/7d4605e5b8a802364452aa70e4207000.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/7d4605e5b8a802364452aa70e4207000.png",alt:"Image from Gyazo"})),(0,a.kt)("h2",{id:"related-documents"},"Related Documents"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/docs/faq/how-to-request-kuroco-api-from-smarty-function/"},"Can I call Kuroco's API from custom processing?")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/docs/tutorials/creating-a-custom-function-endpoint/"},"Creating a custom function endpoint")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/docs/reference/pre-processing/"},"Pre-processing")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/docs/reference/smarty-plugin/"},"Smarty Plugin"))))}m.isMDXComponent=!0}}]);