"use strict";(self.webpackChunkkurokuro=self.webpackChunkkurokuro||[]).push([[5520],{3905:(t,e,a)=>{a.d(e,{Zo:()=>p,kt:()=>f});var r=a(67294);function n(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function i(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,r)}return a}function o(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?i(Object(a),!0).forEach((function(e){n(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function m(t,e){if(null==t)return{};var a,r,n=function(t,e){if(null==t)return{};var a,r,n={},i=Object.keys(t);for(r=0;r<i.length;r++)a=i[r],e.indexOf(a)>=0||(n[a]=t[a]);return n}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)a=i[r],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(n[a]=t[a])}return n}var l=r.createContext({}),d=function(t){var e=r.useContext(l),a=e;return t&&(a="function"==typeof t?t(e):o(o({},e),t)),a},p=function(t){var e=d(t.components);return r.createElement(l.Provider,{value:e},t.children)},s="mdxType",c={inlineCode:"code",wrapper:function(t){var e=t.children;return r.createElement(r.Fragment,{},e)}},g=r.forwardRef((function(t,e){var a=t.components,n=t.mdxType,i=t.originalType,l=t.parentName,p=m(t,["components","mdxType","originalType","parentName"]),s=d(a),g=n,f=s["".concat(l,".").concat(g)]||s[g]||c[g]||i;return a?r.createElement(f,o(o({ref:e},p),{},{components:a})):r.createElement(f,o({ref:e},p))}));function f(t,e){var a=arguments,n=e&&e.mdxType;if("string"==typeof t||n){var i=a.length,o=new Array(i);o[0]=g;var m={};for(var l in e)hasOwnProperty.call(e,l)&&(m[l]=e[l]);m.originalType=t,m[s]="string"==typeof t?t:n,o[1]=m;for(var d=2;d<i;d++)o[d]=a[d];return r.createElement.apply(null,o)}return r.createElement.apply(null,a)}g.displayName="MDXCreateElement"},5086:(t,e,a)=>{a.r(e),a.d(e,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>i,metadata:()=>m,toc:()=>d});var r=a(87462),n=(a(67294),a(3905));const i={title:"Implementing Reminder and Automatic Withdrawal Features for Members with No Login for a Certain Period",description:'Implement reminder and automatic withdrawal features for members with no login for a certain period using batch processing. The feature to extend the expiration date when a member logs in will be implemented using custom processing triggered by "after login processing".'},o=void 0,m={unversionedId:"tutorials/implement-reminder-and-automatic-deletion-of-members",id:"tutorials/implement-reminder-and-automatic-deletion-of-members",title:"Implementing Reminder and Automatic Withdrawal Features for Members with No Login for a Certain Period",description:'Implement reminder and automatic withdrawal features for members with no login for a certain period using batch processing. The feature to extend the expiration date when a member logs in will be implemented using custom processing triggered by "after login processing".',source:"@site/docs/tutorials/implement-reminder-and-automatic-deletion-of-members.md",sourceDirName:"tutorials",slug:"/tutorials/implement-reminder-and-automatic-deletion-of-members",permalink:"/docs/tutorials/implement-reminder-and-automatic-deletion-of-members",draft:!1,editUrl:"https://github.com/diverta/kuroco-documents/tree/main/packages/create-docusaurus/templates/shared/docs/tutorials/implement-reminder-and-automatic-deletion-of-members.md",tags:[],version:"current",frontMatter:{title:"Implementing Reminder and Automatic Withdrawal Features for Members with No Login for a Certain Period",description:'Implement reminder and automatic withdrawal features for members with no login for a certain period using batch processing. The feature to extend the expiration date when a member logs in will be implemented using custom processing triggered by "after login processing".'},sidebar:"documentationSidebar",previous:{title:"Creating daily backup data in CSV using Batch Process",permalink:"/docs/tutorials/how-to-implement-batch-function-exports-csv"},next:{title:"Automatically Delete Files in File Manager",permalink:"/docs/tutorials/delete-filemanager-files-by-using-smarty-plugins"}},l={},d=[{value:"Overview",id:"overview",level:2},{value:"What you&#39;ll learn",id:"what-youll-learn",level:3},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Prerequisites",id:"prerequisites-1",level:2},{value:"Set the expiration date for member login permission",id:"set-the-expiration-date-for-member-login-permission",level:3},{value:"Creating an API for internal processing",id:"creating-an-api-for-internal-processing",level:3},{value:"Creating an API",id:"creating-an-api",level:4},{value:"Security settings",id:"security-settings",level:4},{value:"CORS settings",id:"cors-settings",level:4},{value:"Implementation of Reminder Feature",id:"implementation-of-reminder-feature",level:2},{value:"Creating a Custom Member Filter",id:"creating-a-custom-member-filter",level:3},{value:"Create notification",id:"create-notification",level:3},{value:"Create message template",id:"create-message-template",level:3},{value:"Create custom function",id:"create-custom-function",level:3},{value:"Create endpoint",id:"create-endpoint",level:3},{value:"Create batch process",id:"create-batch-process",level:3},{value:"Operation check",id:"operation-check",level:3},{value:"Implementation of Automatic Withdrawal Feature",id:"implementation-of-automatic-withdrawal-feature",level:2},{value:"Creating a Custom Member Filter",id:"creating-a-custom-member-filter-1",level:3},{value:"Create endpoints",id:"create-endpoints",level:3},{value:"<code>delete_member_list</code> endpoint",id:"delete_member_list-endpoint",level:4},{value:"<code>expired_member_delete</code> endpoint",id:"expired_member_delete-endpoint",level:4},{value:"Create batch process",id:"create-batch-process-1",level:3},{value:"Operation check",id:"operation-check-1",level:3},{value:"Implementation of the feature to extend the expiration date when a member logs in",id:"implementation-of-the-feature-to-extend-the-expiration-date-when-a-member-logs-in",level:2},{value:"Create endpoint",id:"create-endpoint-1",level:3},{value:"Create custom function",id:"create-custom-function-1",level:3},{value:"Operation check",id:"operation-check-2",level:3},{value:"Related documents",id:"related-documents",level:2}],p={toc:d},s="wrapper";function c(t){let{components:e,...a}=t;return(0,n.kt)(s,(0,r.Z)({},p,a,{components:e,mdxType:"MDXLayout"}),(0,n.kt)("h2",{id:"overview"},"Overview"),(0,n.kt)("p",null,"Using batch processing, we will implement reminder and automatic withdrawal features for members who have not logged in for a certain period.",(0,n.kt)("br",{parentName:"p"}),"\n",'Also, the feature to extend the expiration date when a member logs in will be implemented using custom processing triggered by "after login processing".'),(0,n.kt)("h3",{id:"what-youll-learn"},"What you'll learn"),(0,n.kt)("p",null,"We will implement reminder and automatic withdrawal features for members who have not logged in for a certain period using the following steps."),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"#prerequisites"},"Prerequisites")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"#implementation-of-reminder-feature"},"Implementation of Reminder Feature")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"#implementation-of-automatic-withdrawal-feature"},"Implementation of Automatic Withdrawal Feature")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"#implementation-of-the-feature-to-extend-the-expiration-date-when-a-member-logs-in"},"Implementation of the feature to extend the expiration date when a member logs in"))),(0,n.kt)("h3",{id:"prerequisites"},"Prerequisites"),(0,n.kt)("p",null,"Members and groups to be used for testing will be added as necessary."),(0,n.kt)("h2",{id:"prerequisites-1"},"Prerequisites"),(0,n.kt)("h3",{id:"set-the-expiration-date-for-member-login-permission"},"Set the expiration date for member login permission"),(0,n.kt)("p",null,"The expiration date for member login permission will be automatically added by the custom processing that we will set up later, but for the purpose of testing, let's set it manually first.",(0,n.kt)("br",{parentName:"p"}),"\n","Click ","[Member]"," -> ","[Member]","."),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/f7d9bb1ae015c27df925f9c82c42b6fe.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/f7d9bb1ae015c27df925f9c82c42b6fe.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,'On the member list page, click the gear icon in the top right corner of the table to open the "Display Settings" and add the "Login permission deadline" field.'),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/c85ce4f2669513cb69e9651f3f3537a5.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/c85ce4f2669513cb69e9651f3f3537a5.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"Click on the name of the member whose settings you want to change on the member list."),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/1c016e36d91ba656b7f951d3f66deff1.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/1c016e36d91ba656b7f951d3f66deff1.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"Set the login permission expiry date."),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/05b293b84a1a70ca9bf8ce99cc465b3e.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/05b293b84a1a70ca9bf8ce99cc465b3e.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,'Confirm that the "Don\'t subscribe to notifications" is unchecked.\n',(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/f8265de19ae3cf5b3ed839368163d783.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/f8265de19ae3cf5b3ed839368163d783.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"Similarly, set the login permission expiration date for the member used for testing as follows."),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/ef6aa86abfa6b5da1b2da92c62c5465f.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/ef6aa86abfa6b5da1b2da92c62c5465f.png",alt:"Image from Gyazo"})),(0,n.kt)("h3",{id:"creating-an-api-for-internal-processing"},"Creating an API for internal processing"),(0,n.kt)("p",null,"It is recommended to separate APIs that are only used internally within Kuroco. Therefore, first create a new API for internal use. If it has already been added, you can skip to the next step."),(0,n.kt)("h4",{id:"creating-an-api"},"Creating an API"),(0,n.kt)("p",null,"Click ","[Add]"," from the API section in the Kuroco admin panel."),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/9ecf385ebd0bbd4ed2fce44c5b03908a.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/9ecf385ebd0bbd4ed2fce44c5b03908a.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,'On the API editor, enter the following information and click "Add".\n',(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/4ad1441b5747037b667256ac969fa60a.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/4ad1441b5747037b667256ac969fa60a.png",alt:"Image from Gyazo"})),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Field"),(0,n.kt)("th",{parentName:"tr",align:null},"Settings"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Title"),(0,n.kt)("td",{parentName:"tr",align:null},"Internal")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Version"),(0,n.kt)("td",{parentName:"tr",align:null},"1.0")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Description"),(0,n.kt)("td",{parentName:"tr",align:null},"API for internal use")))),(0,n.kt)("p",null,"The API has been created."),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/42d21c717bec7d592b968486a036da90.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/42d21c717bec7d592b968486a036da90.png",alt:"Image from Gyazo"})),(0,n.kt)("h4",{id:"security-settings"},"Security settings"),(0,n.kt)("p",null,"Next, configure the security settings. Click on ","[Security]",".  "),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/02b9bb7afc1ef03a4f26f524267c76a8.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/02b9bb7afc1ef03a4f26f524267c76a8.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"Set the security to ","[Dynamic Access Token]",", then click ","[Save]",".  "),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/0a121f90acd9ef3c1494cd895d922dae.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/0a121f90acd9ef3c1494cd895d922dae.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"After setting the security to ","[Dynamic Access Token]",", it is recommended to use the ",(0,n.kt)("inlineCode",{parentName:"p"},"Login::token")," endpoint. However, if it is only used internally, you can ignore it."),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/8ab8a67d5768bf7d84e6e8dc79753de1.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/8ab8a67d5768bf7d84e6e8dc79753de1.png",alt:"Image from Gyazo"})),(0,n.kt)("h4",{id:"cors-settings"},"CORS settings"),(0,n.kt)("p",null,"Next, configure the CORS settings. Click on ","[Operation CORS]","."),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/706501419568a0dc13e7312f83da4fd4.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/706501419568a0dc13e7312f83da4fd4.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"Click ","[Add Origin]"," in CORS_ALLOW_ORIGINS, and add the following:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Admin panel URL")),(0,n.kt)("p",null,"Click ","[Add Method]"," in CORS_ALLOW_METHODS, and add the following:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"GET  "),(0,n.kt)("li",{parentName:"ul"},"POST"),(0,n.kt)("li",{parentName:"ul"},"OPTIONS")),(0,n.kt)("p",null,"Make sure that ","[Allow Credentials]"," is checked in CORS_ALLOW_CREDENTIALS.  "),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/edf857331a01a33515297413a4ac2314.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/edf857331a01a33515297413a4ac2314.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"If there are no issues, click ","[Save]",". "),(0,n.kt)("h2",{id:"implementation-of-reminder-feature"},"Implementation of Reminder Feature"),(0,n.kt)("p",null,"The reminder function works in the following way:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Send a request to the endpoint by batch processing every day at 06:00."),(0,n.kt)("li",{parentName:"ul"},"The endpoint sends information on the message template identifier and custom member filter ID to the configured delivery ID."),(0,n.kt)("li",{parentName:"ul"},"The delivery sends the contents of the message template to the custom member filter.")),(0,n.kt)("h3",{id:"creating-a-custom-member-filter"},"Creating a Custom Member Filter"),(0,n.kt)("p",null,"We set the recipients for the reminder email with a custom member filter.",(0,n.kt)("br",{parentName:"p"}),"\n","Click ","[Member]"," -> ","[Custom Member Filter]",".  "),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/b0087d194aab23c0b9a7be46e67580a2.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/b0087d194aab23c0b9a7be46e67580a2.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"Click ","[Add]",".  "),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/4c5a9046ce53aac37b281e07ba527f86.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/4c5a9046ce53aac37b281e07ba527f86.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"Create the following filter:",(0,n.kt)("br",{parentName:"p"}),"\n","The recipients of the reminder email are those whose expiration date is 30 days prior and less than 7 days."),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,n.kt)("th",{parentName:"tr",align:"left"},"Title"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Title"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Login permission expiry date reminding target members")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Filter"),(0,n.kt)("td",{parentName:"tr",align:"left"},"As below")))),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/af99650dc93055e6115b71fc7f9e8123.jpg?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/af99650dc93055e6115b71fc7f9e8123.jpg",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"Click ","[View result]"," to see if the members you expect will hit.\nIf you have multiple conditions, check the test member's login permit manually and check it. "),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/5a56aaefc823a2b4f35e80b90dfe933b.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/5a56aaefc823a2b4f35e80b90dfe933b.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"If there is no problem, click ","[Add]"," to add a custom member filter.",(0,n.kt)("br",{parentName:"p"}),"\n","The ID of the created custom menber filter will be used later, so make a note of it."),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/89e55969dc027aaa3c41dff40df10cb2.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/89e55969dc027aaa3c41dff40df10cb2.png",alt:"Image from Gyazo"})),(0,n.kt)("h3",{id:"create-notification"},"Create notification"),(0,n.kt)("p",null,"We use the notification function for sending reminder email.",(0,n.kt)("br",{parentName:"p"}),"\n","Click ","[Campaign]"," -> ","[Notification]",".  "),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/3d373c4c1c1d3f71f21c60f8fc7cfaf1.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/3d373c4c1c1d3f71f21c60f8fc7cfaf1.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"Click ","[Add]",".  "),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/5d8d37e7f82dff4fe1967a3c7e1c3724.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/5d8d37e7f82dff4fe1967a3c7e1c3724.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"Enter as follows:  "),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,n.kt)("th",{parentName:"tr",align:"left"},"Settings"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Title"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Reminder of login permission expiry")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Sender"),(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"noreply@kuroco-mail.app"))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Other settings"),(0,n.kt)("td",{parentName:"tr",align:"left"},"as default")))),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/284530af0d12e4ebac686794ba459201.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/284530af0d12e4ebac686794ba459201.png",alt:"Image from Gyazo"})),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Recipients will be set in the batch process later so you can leave it empty for now. "),(0,n.kt)("li",{parentName:"ul"},"If you want to change the sender's email address, link your Kuroco site with Sendgrid referring to ",(0,n.kt)("a",{parentName:"li",href:"/docs/tutorials/how-to-link-sendgrid/"},"How to link Sendgrid"),".")),(0,n.kt)("p",null,"After setting, click ","[Add]"," to add the notification and make a note for the notification ID.  "),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/87af67077d54b0e0043f632242fec362.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/87af67077d54b0e0043f632242fec362.png",alt:"Image from Gyazo"})),(0,n.kt)("h3",{id:"create-message-template"},"Create message template"),(0,n.kt)("p",null,"We use message template to create the text of reminder message.",(0,n.kt)("br",{parentName:"p"}),"\n","Click ","[Operation]"," > ","[Message template]",".  "),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/df2a6ba9aacf5414b6d8d6dce419c497.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/df2a6ba9aacf5414b6d8d6dce419c497.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"Click ","[Add]",".  "),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/1485d432be1acc1abdf4ee99b1f53307.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/1485d432be1acc1abdf4ee99b1f53307.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"Enter as follows:  "),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,n.kt)("th",{parentName:"tr",align:"left"},"Settings"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Template"),(0,n.kt)("td",{parentName:"tr",align:"left"},"login permission expiry remind template")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Identifier"),(0,n.kt)("td",{parentName:"tr",align:"left"},"expiration_remind_template")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Body"),(0,n.kt)("td",{parentName:"tr",align:"left"},"As below")))),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-html"},"Dear %name1% %name2% <br>\n<br>\nYour login permission will expire on %login_ok_ymd%.<br>\nPlease login before the expiry date.\n")),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/8409ccbf5873c96c1f089ceb6dd959a1.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/8409ccbf5873c96c1f089ceb6dd959a1.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"After setting, click ","[Add]"," to save the message template."),(0,n.kt)("h3",{id:"create-custom-function"},"Create custom function"),(0,n.kt)("p",null,"If you enter ",(0,n.kt)("inlineCode",{parentName:"p"},"%name1%")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"%name2%")," in the notification message, you can display the name of the member of the destination, but if you want to add items that are not available by default such as ",(0,n.kt)("inlineCode",{parentName:"p"},"%login_ok_ymd%")," or complicated processing, you need to use custom function."),(0,n.kt)("p",null,"Click ","[Operation]"," -> ","[Custom function]","."),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/25dc5649ab2fc103cdcf869df1733a62.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/25dc5649ab2fc103cdcf869df1733a62.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"Click ","[Add]",".  "),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/52169f762d9ea4abf1d05bb56d553906.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/52169f762d9ea4abf1d05bb56d553906.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"Enter as follows:"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,n.kt)("th",{parentName:"tr",align:"left"},"Settings"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Title"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Notification substitution")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Identifier"),(0,n.kt)("td",{parentName:"tr",align:"left"},"notification_substitution")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Used by component(s)"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Trigger\uff1aNotification substitution",(0,n.kt)("br",null),"value: ID of the notification(2)")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Process"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Enter the code below")))),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-smarty"},"{assign_array var=substitutions values=''}\n{assign var=substitutions.name1 value=$member_info.name1}\n{assign var=substitutions.name2 value=$member_info.name2}\n{assign var=substitutions.login_ok_ymd value=$member_info.login_ok_ymd|date_format:'Y-m-d'}\n")),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/237b6e347bd234813f1a2d6eeb6f7f4c.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/237b6e347bd234813f1a2d6eeb6f7f4c.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"After setting, click ","[Add]"," to save the custom function. "),(0,n.kt)("h3",{id:"create-endpoint"},"Create endpoint"),(0,n.kt)("p",null,"Next, we create the endpoint.",(0,n.kt)("br",{parentName:"p"}),"\n","Click ","[Add new endpoint]"," from the Internal API page.  "),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/1b1ecdd7d0d8b070db1c810258a8fdca.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/1b1ecdd7d0d8b070db1c810258a8fdca.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"Create the following endpoint:"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,n.kt)("th",{parentName:"tr",align:"left"},"settings"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Path"),(0,n.kt)("td",{parentName:"tr",align:"left"},"expiration_remind")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Category"),(0,n.kt)("td",{parentName:"tr",align:"left"},"notification")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Model"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Magazine")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Operation"),(0,n.kt)("td",{parentName:"tr",align:"left"},"send")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"destination_id"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Custom member filter ID(1)")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"mail_type"),(0,n.kt)("td",{parentName:"tr",align:"left"},"1")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"mail_template_name"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Identifier of the message template(expiration_remind_template)")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"subject"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Your login permission is expiring soon")))),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/851397d6c5a607eba9d13537f1aefe9b.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/851397d6c5a607eba9d13537f1aefe9b.png",alt:"Image from Gyazo"}),"\n",(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/3775d8d97f8aad9ed9dee509a7100b8d.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/3775d8d97f8aad9ed9dee509a7100b8d.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"After setting, click","[Add]"," to add the endpoint.  "),(0,n.kt)("h3",{id:"create-batch-process"},"Create batch process"),(0,n.kt)("p",null,"We create a reminding function using batch process and send the reminder message to target members daily.",(0,n.kt)("br",{parentName:"p"}),"\n","Click ","[Operation]"," -> ","[Batch process]",".  "),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/1ecfae69bcffdbcdacbab103904db3ad.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/1ecfae69bcffdbcdacbab103904db3ad.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"Click ","[Add]",".  "),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/8eb644facfb5c12cf04a8484ebbdccb5.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/8eb644facfb5c12cf04a8484ebbdccb5.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"Set as follows:  "),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,n.kt)("th",{parentName:"tr",align:"left"},"settings"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Title"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Send reminder of login permission expiry")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Identifier"),(0,n.kt)("td",{parentName:"tr",align:"left"},"send_remind_mail")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Batch"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Every day 06:00")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Process"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Below code")))),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-smarty"},"{api_internal\n    var='response'\n    status_var='status'\n    endpoint='/rcms-api/4/expiration_remind/2'\n    method='POST'\n    member_id='1'\n}\n")),(0,n.kt)("admonition",{type:"caution"},(0,n.kt)("p",{parentName:"admonition"},"Replace ",(0,n.kt)("inlineCode",{parentName:"p"},"/rcms-api/4/expiration_remind/2")," with your own endpoint.")),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/711ccbac44f2e0742f24184e1ec9dbe8.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/711ccbac44f2e0742f24184e1ec9dbe8.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"After setting, click ","[Add]"," to save the batch process."),(0,n.kt)("h3",{id:"operation-check"},"Operation check"),(0,n.kt)("p",null,"At last, click ","[Run now]"," to check the operation.  "),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/a14bce742588cd54b516322a008bd6e0.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/a14bce742588cd54b516322a008bd6e0.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"If the settings are correct, below e-mail will be sent. "),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/e93cd0d2656eb1d7f7dc98ee92421c0e.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/e93cd0d2656eb1d7f7dc98ee92421c0e.png",alt:"Image from Gyazo"})),(0,n.kt)("h2",{id:"implementation-of-automatic-withdrawal-feature"},"Implementation of Automatic Withdrawal Feature"),(0,n.kt)("p",null,"We create the automatic member delete function using batch process which checks for the existence of target members on a daily basis, and if the target members exist, deletes them using the ",(0,n.kt)("inlineCode",{parentName:"p"},"Member::delete")," endpoint."),(0,n.kt)("h3",{id:"creating-a-custom-member-filter-1"},"Creating a Custom Member Filter"),(0,n.kt)("p",null,"We use the custom member filter to identify the target members.",(0,n.kt)("br",{parentName:"p"}),"\n","Click ","[Member]"," -> ","[Custom Member Filter]",".  "),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/b0087d194aab23c0b9a7be46e67580a2.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/b0087d194aab23c0b9a7be46e67580a2.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"Click ","[Add]",".  "),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/4c5a9046ce53aac37b281e07ba527f86.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/4c5a9046ce53aac37b281e07ba527f86.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"Create the following filter:  "),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,n.kt)("th",{parentName:"tr",align:"left"},"Settings"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Title"),(0,n.kt)("td",{parentName:"tr",align:"left"},"target members of automatic deletion")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Filter"),(0,n.kt)("td",{parentName:"tr",align:"left"},"As below")))),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/b7dc6b6fa53e7d3d9908fac14ca5ad3f.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/b7dc6b6fa53e7d3d9908fac14ca5ad3f.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"Click ","[View result]"," to check the result and if there are no issues, click ","[Add]"," to save the custom member filter."),(0,n.kt)("p",null,"The ID of the created custom member filter  will be used later so make a note of it.  "),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/3825e3bd648e737f66bb76ea337329bf.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/3825e3bd648e737f66bb76ea337329bf.png",alt:"Image from Gyazo"})),(0,n.kt)("h3",{id:"create-endpoints"},"Create endpoints"),(0,n.kt)("p",null,"Create two endpoints, one to return the list of members to be deleted, and one to delete members.",(0,n.kt)("br",{parentName:"p"}),"\n","Click ","[Add new endpoint]"," from the Internal API page.  "),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/1b1ecdd7d0d8b070db1c810258a8fdca.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/1b1ecdd7d0d8b070db1c810258a8fdca.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"Create 2 endpoints as follows:"),(0,n.kt)("h4",{id:"delete_member_list-endpoint"},(0,n.kt)("inlineCode",{parentName:"h4"},"delete_member_list")," endpoint"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,n.kt)("th",{parentName:"tr",align:"left"},"settings"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Path"),(0,n.kt)("td",{parentName:"tr",align:"left"},"delete_member_list")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Category"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Member")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Model"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Member")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Operation"),(0,n.kt)("td",{parentName:"tr",align:"left"},"list")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"custom_search_id"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Custom member filter ID(3)")))),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/4cff07a3dd47f2e8f79f57e3d905f92e.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/4cff07a3dd47f2e8f79f57e3d905f92e.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"After setting, click ","[Add]"," to save the endpoint settings. "),(0,n.kt)("h4",{id:"expired_member_delete-endpoint"},(0,n.kt)("inlineCode",{parentName:"h4"},"expired_member_delete")," endpoint"),(0,n.kt)("p",null,"We create the endpoint to delete the target members."),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,n.kt)("th",{parentName:"tr",align:"left"},"settings"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Path"),(0,n.kt)("td",{parentName:"tr",align:"left"},"expired_member_delete")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Category"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Memmber")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Model"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Member")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Operation"),(0,n.kt)("td",{parentName:"tr",align:"left"},"delete")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"allowed_group_ids"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Group ID in which target members belong(104)")))),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/a170e4df1c21e0740c9a84998a92206a.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/a170e4df1c21e0740c9a84998a92206a.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"After setting, click ","[Add]"," to save the endpoint settings.  "),(0,n.kt)("h3",{id:"create-batch-process-1"},"Create batch process"),(0,n.kt)("p",null,"Next, we create a batch process.",(0,n.kt)("br",{parentName:"p"}),"\n","Click ","[Operation]"," -> ","[Batch process]",".  "),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/1ecfae69bcffdbcdacbab103904db3ad.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/1ecfae69bcffdbcdacbab103904db3ad.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"Click ","[Add]",".  "),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/8eb644facfb5c12cf04a8484ebbdccb5.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/8eb644facfb5c12cf04a8484ebbdccb5.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"Set as follows:  "),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,n.kt)("th",{parentName:"tr",align:"left"},"settings"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Title"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Delete members with expired login permission")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Identifier"),(0,n.kt)("td",{parentName:"tr",align:"left"},"delete_expired_member")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Batch"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Every day 05:00")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Process"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Below code")))),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-smarty"},"{*Get target members*}\n{api_internal\n    var='response'\n    status_var='status'\n    endpoint='/rcms-api/4/delete_member_list'\n    method='GET'\n    member_id='1'\n}\n\n{*Delete target members*}\n{foreach from=$response.list item=n}\n    {assign var='target' value=\"/rcms-api/4/expired_member_delete/`$n.member_id`\"}\n    {* member_id=1 -> admin user *}\n    {api_internal\n        var='response'\n        status_var='status'\n        endpoint=$target\n        method='POST'\n        member_id='1'\n    }\n    {logger msg1=\"Delete `$n.name1``$n.name2`(member_id=`$n.member_id`)\" msg2=$response}\n{/foreach}\n")),(0,n.kt)("admonition",{type:"caution"},(0,n.kt)("p",{parentName:"admonition"},"Replace ",(0,n.kt)("inlineCode",{parentName:"p"},"/rcms-api/4/delete_member_list")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"/rcms-api/4/expired_member_delete/")," with your own endpoints.")),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/05e2e44e245c4a0de80a6180fd4bcd7a.jpg?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/05e2e44e245c4a0de80a6180fd4bcd7a.jpg",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"After entering above, click ","[Add]"," to save the batch process. "),(0,n.kt)("h3",{id:"operation-check-1"},"Operation check"),(0,n.kt)("p",null,"At last, click ","[Run now]"," to check the operation.  "),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/95c956775728902a245a1acdc0f88811.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/95c956775728902a245a1acdc0f88811.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"If the setting is correct, the log will remain in the custom log as follows and the members will be deleted.  "),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/48bd94651d66a9303b6bfb453117b1ec.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/48bd94651d66a9303b6bfb453117b1ec.png",alt:"Image from Gyazo"})),(0,n.kt)("h2",{id:"implementation-of-the-feature-to-extend-the-expiration-date-when-a-member-logs-in"},"Implementation of the feature to extend the expiration date when a member logs in"),(0,n.kt)("p",null,"Finally, we implement a function that automatically extends the expiration date of the login permission after logging in.\nHere, the custom process is performed after the member logging in, and the ",(0,n.kt)("inlineCode",{parentName:"p"},"login_ok_ymd")," is updated at the ",(0,n.kt)("inlineCode",{parentName:"p"},"Member::Update")," endpoint."),(0,n.kt)("h3",{id:"create-endpoint-1"},"Create endpoint"),(0,n.kt)("p",null,"Click ","[Add new endpoint]"," from the Internal API page.  "),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/1b1ecdd7d0d8b070db1c810258a8fdca.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/1b1ecdd7d0d8b070db1c810258a8fdca.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"Create the following endpoint:"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,n.kt)("th",{parentName:"tr",align:"left"},"settings"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Path"),(0,n.kt)("td",{parentName:"tr",align:"left"},"member/update_login_ok_ymd")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Category"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Member")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Model"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Member")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Operation"),(0,n.kt)("td",{parentName:"tr",align:"left"},"update")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"self_only"),(0,n.kt)("td",{parentName:"tr",align:"left"},"check")))),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/a9d2ac3a45fb7e11c39e56921ff7cfc6.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/a9d2ac3a45fb7e11c39e56921ff7cfc6.png",alt:"Image from Gyazo"}),"  "),(0,n.kt)("h3",{id:"create-custom-function-1"},"Create custom function"),(0,n.kt)("p",null,"Click ","[Operation]"," -> ","[Custom function]","."),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/25dc5649ab2fc103cdcf869df1733a62.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/25dc5649ab2fc103cdcf869df1733a62.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"Click ","[Add]",".  "),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/52169f762d9ea4abf1d05bb56d553906.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/52169f762d9ea4abf1d05bb56d553906.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"Enter as follows:"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,n.kt)("th",{parentName:"tr",align:"left"},"Settings"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Title"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Extend login permission expiry once logging in")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Identifier"),(0,n.kt)("td",{parentName:"tr",align:"left"},"update_login_permission_date")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Used by component(s)"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Trigger: After logging in",(0,n.kt)("br",null),"Value: 0")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Process"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Below code")))),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-smarty"},'{assign_member_detail assign_group_flg=1 var=\'member_detail\' member_id=$member_id}\n\n{* add extending 1y *}\n{assign_array var="payload" keys="login_ok_ymd" values="1 year"|strtotime|date_format:"Y-m-d"}\n\n{if\n    "1"|rcms_in_array:$member_detail.arrGroup_id ||\n    "2"|rcms_in_array:$member_detail.arrGroup_id\n}\n  {* skip execution when the user supposed to be administrator *}\n{else}\n    {* member_id=1 -> admin user *}\n    {api_internal\n        var=\'response\'\n        status_var=\'status\'\n        endpoint=\'/rcms-api/4/member/update_login_ok_ymd\'\n        method=\'POST\'\n        queries=$payload\n        member_id=$member_id\n    }\n    {logger msg1="Update login_ok_ymd of `$member_detail.name1``$member_detail.name2`(member_id=`$member_id`)" msg2=$response}\n{/if}\n')),(0,n.kt)("admonition",{type:"caution"},(0,n.kt)("p",{parentName:"admonition"},"Replace ",(0,n.kt)("inlineCode",{parentName:"p"},"/rcms-api/4/member/update_login_ok_ymd")," with your own endpoint.")),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/aa2691679dbb0dc8e5df70e70437981e.jpg?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/aa2691679dbb0dc8e5df70e70437981e.jpg",alt:"Image from Gyazo"})),(0,n.kt)("h3",{id:"operation-check-2"},"Operation check"),(0,n.kt)("p",null,"Finally, login with the target member's account to check the operation.  "),(0,n.kt)("p",null,"If the setting is correct, the log will remain in the custom log as follows and the login permission expiry is updated.",(0,n.kt)("br",{parentName:"p"}),"\n",(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/5300e95dc355a565175a3d5368023d9c.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/5300e95dc355a565175a3d5368023d9c.png",alt:"Image from Gyazo"}),"\n",(0,n.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/4fe03c2f312405d910e4feb29b85f8aa.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/4fe03c2f312405d910e4feb29b85f8aa.png",alt:"Image from Gyazo"})),(0,n.kt)("p",null,"With the above, we have implemented a reminding and automatic withdrawal function to members without login for a certain period of time. "),(0,n.kt)("h2",{id:"related-documents"},"Related documents"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/tutorials/using-custom-member-filters/"},"Using custom member filters")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/reference/trigger-variables/"},"List of variables available for custom functions")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/faq/how-to-request-kuroco-api-from-smarty-function/"},"How to request kuroco API from smarty function")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/faq/can-the-original-process-output-logs-for-debugging-purposes/"},"Can custom function output logs for debugging purposes?")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/reference/smarty-plugin/"},"Smarty Plugin")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/tutorials/how-to-link-sendgrid/"},"How to link with SendGrid"))))}c.isMDXComponent=!0}}]);