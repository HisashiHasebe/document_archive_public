"use strict";(self.webpackChunkkurokuro=self.webpackChunkkurokuro||[]).push([[63958],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>m});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function c(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),l=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},d=function(e){var t=l(e.components);return n.createElement(s.Provider,{value:t},e.children)},p="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,d=c(e,["components","mdxType","originalType","parentName"]),p=l(a),u=r,m=p["".concat(s,".").concat(u)]||p[u]||h[u]||o;return a?n.createElement(m,i(i({ref:t},d),{},{components:a})):n.createElement(m,i({ref:t},d))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=u;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c[p]="string"==typeof e?e:r,i[1]=c;for(var l=2;l<o;l++)i[l]=a[l];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},39011:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>h,frontMatter:()=>o,metadata:()=>c,toc:()=>l});var n=a(87462),r=(a(67294),a(3905));const o={title:"API cache",category:"API",weight:90},i=void 0,c={unversionedId:"reference/api-cache",id:"reference/api-cache",title:"API cache",description:"Kuroco's API cache",source:"@site/docs/reference/api-cache.md",sourceDirName:"reference",slug:"/reference/api-cache",permalink:"/docs/reference/api-cache",draft:!1,editUrl:"https://github.com/diverta/kuroco-documents/tree/main/packages/create-docusaurus/templates/shared/docs/reference/api-cache.md",tags:[],version:"current",frontMatter:{title:"API cache",category:"API",weight:90},sidebar:"documentationSidebar",previous:{title:"Sorting by Location Information",permalink:"/docs/reference/order-by-location"},next:{title:"Timing and scope of API cache clearing",permalink:"/docs/reference/cache-clear-operation"}},s={},l=[{value:"Kuroco&#39;s API cache",id:"kurocos-api-cache",level:2},{value:"Cache setup considerations",id:"cache-setup-considerations",level:2},{value:"Verifying if an API response is cached",id:"verifying-if-an-api-response-is-cached",level:2},{value:"<code>x-cache</code>",id:"x-cache",level:3},{value:"<code>age</code>",id:"age",level:3},{value:"<code>x-cache-hits</code>",id:"x-cache-hits",level:3},{value:"Cache duration settings",id:"cache-duration-settings",level:2},{value:"Stale-While-Revalidate / Stale-If-Error",id:"stale-while-revalidate--stale-if-error",level:2},{value:"Cache clearing",id:"cache-clearing",level:2},{value:"By endpoint",id:"by-endpoint",level:3},{value:"By API",id:"by-api",level:3},{value:"Cache units",id:"cache-units",level:2},{value:"Token authentication",id:"token-authentication",level:3},{value:"Cookie authentication",id:"cookie-authentication",level:3},{value:"IP address restrictions on APIs",id:"ip-address-restrictions-on-apis",level:3},{value:"IP address restrictions to the admin panel",id:"ip-address-restrictions-to-the-admin-panel",level:3},{value:"More information",id:"more-information",level:2}],d={toc:l},p="wrapper";function h(e){let{components:t,...a}=e;return(0,r.kt)(p,(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"kurocos-api-cache"},"Kuroco's API cache"),(0,r.kt)("p",null,"Since Kuroco's billing system is usage-based, we recommend setting up a cache if you are using Kuroco for media sites or other applications where a large number of requests are expected. A properly configured cache can improve response performance and reduce costs at the same time."),(0,r.kt)("p",null,"With Kuroco, you can configure detailed cache settings for each API and endpoint."),(0,r.kt)("h2",{id:"cache-setup-considerations"},"Cache setup considerations"),(0,r.kt)("p",null,'Verify your cache usage for each endpoint with the "7-day usage" column on the endpoint list screen. '),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/59668380490efa332488e4d7aeddf519.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/59668380490efa332488e4d7aeddf519.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"The values are displayed in the following order:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"(API requests) / (Cached API requests) / (Average response size) / (Average execution time)\n")),(0,r.kt)("p",null,"If the number of cached API requests is much lower than the number of API requests, review your cache settings."),(0,r.kt)("p",null,"You can also view the number of API requests and cached API requests by month and day on the ","[Environment]"," -> ","[Usage]"," screen.",(0,r.kt)("br",{parentName:"p"}),"\n","For details, see ",(0,r.kt)("a",{parentName:"p",href:"/docs/management/usage/#cost-breakdown"},"User guide: Usage"),"."),(0,r.kt)("h2",{id:"verifying-if-an-api-response-is-cached"},"Verifying if an API response is cached"),(0,r.kt)("p",null,"To check if an API response has been cached, verify the following variables in the response header."),(0,r.kt)("h3",{id:"x-cache"},(0,r.kt)("inlineCode",{parentName:"h3"},"x-cache")),(0,r.kt)("p",null,"Indicates whether the object is a cache hit or a cache miss.\nIt returns ",(0,r.kt)("inlineCode",{parentName:"p"},"HIT")," in case of a hit, and ",(0,r.kt)("inlineCode",{parentName:"p"},"PASS")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"MISS")," in case of a miss."),(0,r.kt)("h3",{id:"age"},(0,r.kt)("inlineCode",{parentName:"h3"},"age")),(0,r.kt)("p",null,"Number of seconds since the response was cached."),(0,r.kt)("h3",{id:"x-cache-hits"},(0,r.kt)("inlineCode",{parentName:"h3"},"x-cache-hits")),(0,r.kt)("p",null,"Number of hits on the cached object."),(0,r.kt)("h2",{id:"cache-duration-settings"},"Cache duration settings"),(0,r.kt)("p",null,"To set the cache period for an endpoint, click the corresponding ","[Update]"," button in the endpoint list."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/4579e3fff20d0ba5f396dab17f7ef8f1.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/4579e3fff20d0ba5f396dab17f7ef8f1.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,'In the configuration dialog, enter the cache duration (in seconds) next to "Cache".'),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/5bc136ff52abeae428a427625b11255b.jpg?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/5bc136ff52abeae428a427625b11255b.jpg",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Click ","[Update]"," when you are done."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/52ca7cc88a1d53aee664aa5657060706.jpg?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/52ca7cc88a1d53aee664aa5657060706.jpg",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"We recommend a cache duration of one day or one week.",(0,r.kt)("br",{parentName:"p"}),"\n","Note that endpoints for adding, updating, or deleting data do not have cache settings in their configuration dialog."),(0,r.kt)("h2",{id:"stale-while-revalidate--stale-if-error"},"Stale-While-Revalidate / Stale-If-Error"),(0,r.kt)("p",null,"Kuroco can be configured to improve the efficiency of cache fetching and to reuse the cache in case of errors.",(0,r.kt)("br",{parentName:"p"}),"\n","With Stale-While-Revalidate, the cache is held for a set number of seconds after the cache becomes invalid, and the old cache continues to be returned until a new cache is set. This reduces load and unneeded accesses when clearing the cache.",(0,r.kt)("br",{parentName:"p"}),"\n","With Stale-If-Error, the cache is held for a set number of seconds after the cache becomes invalid, and the old cache is returned instead, if the origin returns an error. This allows you to construct API responses that are less prone to errors."),(0,r.kt)("h2",{id:"cache-clearing"},"Cache clearing"),(0,r.kt)("p",null,"A cache is automatically cleared upon updating the data to be retrieved (such as contents or members).",(0,r.kt)("br",{parentName:"p"}),"\n","However, you can also force a cache clearing using the method below."),(0,r.kt)("h3",{id:"by-endpoint"},"By endpoint"),(0,r.kt)("p",null,"Click ","[Clear cache]"," for the target endpoint in the endpoint list."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/bc25caea4866ce837f7f8a8dc92c7e11.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/bc25caea4866ce837f7f8a8dc92c7e11.png",alt:"Image from Gyazo"})),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Note that this button is only displayed if you have set a cache duration for the endpoint.")),(0,r.kt)("h3",{id:"by-api"},"By API"),(0,r.kt)("p",null,"To clear the cache of all the endpoints of an API, click ","[Clear cache]"," at the top of the endpoint list screen. "),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/2db3dbbd5d7f7c8303a3ef275fc3428f.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/2db3dbbd5d7f7c8303a3ef275fc3428f.png",alt:"Image from Gyazo"})),(0,r.kt)("h2",{id:"cache-units"},"Cache units"),(0,r.kt)("p",null,"Even for the same URL, the response object may differ according to the client's environment. In such cases, the server would maintain multiple caches.",(0,r.kt)("br",{parentName:"p"}),"\n","For example, a gzip-compressed response would be returned to a client that supports HTTP compression, while a client that does not support HTTP compression would received an uncompressed response. HTTP compression support on the client side is determined by the ",(0,r.kt)("inlineCode",{parentName:"p"},"Accept-Encoding")," header, and the server side maintains separate caches based on the ",(0,r.kt)("inlineCode",{parentName:"p"},"Accept-Encoding")," value. "),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"Vary")," response header indicates the request headers that Kuroco refers to for cache separation.",(0,r.kt)("br",{parentName:"p"}),"\n","For example, if ",(0,r.kt)("inlineCode",{parentName:"p"},"vary: Host, Accept-Encoding, Accept, Origin"),", Kuroco would maintain a cache for each of the following request headers:  "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Host")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Accept-Encoding")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Accept")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Origin"))),(0,r.kt)("p",null,"Kuroco also references the following request headers based on the API security settings. "),(0,r.kt)("h3",{id:"token-authentication"},"Token authentication"),(0,r.kt)("p",null,"When static or dynamic tokens are used for authentication, ",(0,r.kt)("inlineCode",{parentName:"p"},"X-RCMS-API-ACCESS-TOKEN")," will be added to the the ",(0,r.kt)("inlineCode",{parentName:"p"},"Vary")," response header.",(0,r.kt)("br",{parentName:"p"}),"\n","In other words, a common cache is generated for all clients in the same environment when using static tokens, whereas a separate cache is generated for each user when using dynamic tokens."),(0,r.kt)("h3",{id:"cookie-authentication"},"Cookie authentication"),(0,r.kt)("p",null,"When cookie authentication is selected, ",(0,r.kt)("inlineCode",{parentName:"p"},"User-Agent")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Cookie")," will be added to the ",(0,r.kt)("inlineCode",{parentName:"p"},"Vary")," response header.",(0,r.kt)("br",{parentName:"p"}),"\n","(Note: ",(0,r.kt)("inlineCode",{parentName:"p"},"Cookie")," will not be added to the header when the user agent is a bot.)"),(0,r.kt)("h3",{id:"ip-address-restrictions-on-apis"},"IP address restrictions on APIs"),(0,r.kt)("p",null,"Regardless of security settings, if you have set IP address restrictions for an API, a separate cache will be generated for each client IP address.  "),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/357735efa46afa1ea38c3e7f0b370191.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/357735efa46afa1ea38c3e7f0b370191.png",alt:"Image from Gyazo"})),(0,r.kt)("h3",{id:"ip-address-restrictions-to-the-admin-panel"},"IP address restrictions to the admin panel"),(0,r.kt)("p",null,"If you have set IP restrictions to the admin panel, a separate cache will be generated for each client IP address.  "),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/146f48a3e489bffb9ec63c41847b7923.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/146f48a3e489bffb9ec63c41847b7923.png",alt:"Image from Gyazo"})),(0,r.kt)("h2",{id:"more-information"},"More information"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/reference/endpoint-settings/#creating-an-endpoint"},"Reference: Endpoint settings - Creating an endpoint")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/faq/when-are-cached-kurocofiles-cleared/"},"FAQ: When are cached KurocoFiles cleared?"))))}h.isMDXComponent=!0}}]);