"use strict";(self.webpackChunkkurokuro=self.webpackChunkkurokuro||[]).push([[48789],{3905:(t,e,a)=>{a.d(e,{Zo:()=>c,kt:()=>u});var n=a(67294);function i(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function o(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function r(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?o(Object(a),!0).forEach((function(e){i(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function s(t,e){if(null==t)return{};var a,n,i=function(t,e){if(null==t)return{};var a,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)a=o[n],e.indexOf(a)>=0||(i[a]=t[a]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)a=o[n],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(i[a]=t[a])}return i}var l=n.createContext({}),p=function(t){var e=n.useContext(l),a=e;return t&&(a="function"==typeof t?t(e):r(r({},e),t)),a},c=function(t){var e=p(t.components);return n.createElement(l.Provider,{value:e},t.children)},m="mdxType",d={inlineCode:"code",wrapper:function(t){var e=t.children;return n.createElement(n.Fragment,{},e)}},g=n.forwardRef((function(t,e){var a=t.components,i=t.mdxType,o=t.originalType,l=t.parentName,c=s(t,["components","mdxType","originalType","parentName"]),m=p(a),g=i,u=m["".concat(l,".").concat(g)]||m[g]||d[g]||o;return a?n.createElement(u,r(r({ref:e},c),{},{components:a})):n.createElement(u,r({ref:e},c))}));function u(t,e){var a=arguments,i=e&&e.mdxType;if("string"==typeof t||i){var o=a.length,r=new Array(o);r[0]=g;var s={};for(var l in e)hasOwnProperty.call(e,l)&&(s[l]=e[l]);s.originalType=t,s[m]="string"==typeof t?t:i,r[1]=s;for(var p=2;p<o;p++)r[p]=a[p];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}g.displayName="MDXCreateElement"},35610:(t,e,a)=>{a.r(e),a.d(e,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var n=a(87462),i=(a(67294),a(3905));const o={title:"Implementing Two-Factor Authentication on the Login Screen with Kuroco and Nuxt.js",description:"Kuroco's login endpoint requires preparation of parameters to implement two-factor authentication, making it easy to implement two-factor authentication using Email, Authenticater, and SMS."},r=void 0,s={unversionedId:"tutorials/implementing-two-step-verification-on-login-form",id:"tutorials/implementing-two-step-verification-on-login-form",title:"Implementing Two-Factor Authentication on the Login Screen with Kuroco and Nuxt.js",description:"Kuroco's login endpoint requires preparation of parameters to implement two-factor authentication, making it easy to implement two-factor authentication using Email, Authenticater, and SMS.",source:"@site/docs/tutorials/implementing-two-step-verification-on-login-form.md",sourceDirName:"tutorials",slug:"/tutorials/implementing-two-step-verification-on-login-form",permalink:"/docs/tutorials/implementing-two-step-verification-on-login-form",draft:!1,editUrl:"https://github.com/diverta/kuroco-documents/tree/main/packages/create-docusaurus/templates/shared/docs/tutorials/implementing-two-step-verification-on-login-form.md",tags:[],version:"current",frontMatter:{title:"Implementing Two-Factor Authentication on the Login Screen with Kuroco and Nuxt.js",description:"Kuroco's login endpoint requires preparation of parameters to implement two-factor authentication, making it easy to implement two-factor authentication using Email, Authenticater, and SMS."},sidebar:"documentationSidebar",previous:{title:"Building a login page using Kuroco and Nuxt.js",permalink:"/docs/tutorials/integrate-login"},next:{title:"Setting up a new member registration form with Kuroco and Nuxt.js",permalink:"/docs/tutorials/setting-up-registration-form"}},l={},p=[{value:"Overview",id:"overview",level:2},{value:"What you will learn",id:"what-you-will-learn",level:3},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Verify the behavior of two-factor authentication",id:"verify-the-behavior-of-two-factor-authentication",level:2},{value:"Two-Factor Authentication via Email",id:"two-factor-authentication-via-email",level:3},{value:"Creating an Endpoint",id:"creating-an-endpoint",level:4},{value:"Verifying the Behavior with SwaggerUI",id:"verifying-the-behavior-with-swaggerui",level:4},{value:"Two-Factor Authentication via Authenticater",id:"two-factor-authentication-via-authenticater",level:3},{value:"Setting Up the Use of One-Time Passwords",id:"setting-up-the-use-of-one-time-passwords",level:4},{value:"Registering a one-time password",id:"registering-a-one-time-password",level:3},{value:"Creating an endpoint",id:"creating-an-endpoint-1",level:4},{value:"Confirming the operation with SwaggerUI",id:"confirming-the-operation-with-swaggerui",level:4},{value:"Two-factor authentication via SMS",id:"two-factor-authentication-via-sms",level:3},{value:"Creating an endpoint",id:"creating-an-endpoint-2",level:4},{value:"Verify operation with SwaggerUI",id:"verify-operation-with-swaggerui",level:4},{value:"Forcing Additional Authentication",id:"forcing-additional-authentication",level:3},{value:"Implementing the frontend",id:"implementing-the-frontend",level:2},{value:"Verification",id:"verification",level:4},{value:"Related Documentation",id:"related-documentation",level:2}],c={toc:p},m="wrapper";function d(t){let{components:e,...a}=t;return(0,i.kt)(m,(0,n.Z)({},c,a,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"overview"},"Overview"),(0,i.kt)("p",null,"Kuroco's login endpoint requires preparation of parameters to implement two-factor authentication, making it easy to implement two-factor authentication using Email, Authenticater, and SMS."),(0,i.kt)("p",null,"In this tutorial, we will verify the login behavior of two-factor authentication using three authentication methods and introduce the frontend code that utilizes it."),(0,i.kt)("h3",{id:"what-you-will-learn"},"What you will learn"),(0,i.kt)("p",null,"You will implement two-factor authentication on the login screen using the following steps:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#verify-the-behavior-of-two-factor-authentication"},"Verify the behavior of two-factor authentication"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#two-factor-authentication-via-email"},"Two-Factor Authentication via Email")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#two-factor-authentication-via-authenticater"},"Two-Factor Authentication via Authenticater")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#two-factor-authentication-via-sms"},"Two-Factor Authentication via SMS")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#forcing-additional-authentication"},"Forcing Additional Authentication")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#implement-the-frontend"},"Implement the Frontend"))),(0,i.kt)("h3",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("p",null,"This page assumes that you have already built a project with Kuroco and Nuxt.js.",(0,i.kt)("br",{parentName:"p"}),"\n","If you haven't built it yet, please refer to the following tutorial.  "),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("ul",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/tutorials/beginners-guide/"},"Kuroco Beginner's Guide"),"   "))),(0,i.kt)("h2",{id:"verify-the-behavior-of-two-factor-authentication"},"Verify the behavior of two-factor authentication"),(0,i.kt)("h3",{id:"two-factor-authentication-via-email"},"Two-Factor Authentication via Email"),(0,i.kt)("h4",{id:"creating-an-endpoint"},"Creating an Endpoint"),(0,i.kt)("p",null,'Click "Add New Endpoint" in any API.'),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/6180b91072835695331f82e5ed2f09f3.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/6180b91072835695331f82e5ed2f09f3.png",alt:"Image from Gyazo"})),(0,i.kt)("p",null,"Configure the following settings:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"left"},"Field"),(0,i.kt)("th",{parentName:"tr",align:"left"},"Setting"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"Path"),(0,i.kt)("td",{parentName:"tr",align:"left"},"2steplogin/email")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"Category"),(0,i.kt)("td",{parentName:"tr",align:"left"},"Authentication")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"Model"),(0,i.kt)("td",{parentName:"tr",align:"left"},"Login")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"Operation"),(0,i.kt)("td",{parentName:"tr",align:"left"},"login_challenge")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"twofactor_method"),(0,i.kt)("td",{parentName:"tr",align:"left"},"email")))),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/18af4c95cc1c64bcaa9d10954b324dc6.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/18af4c95cc1c64bcaa9d10954b324dc6.png",alt:"Image from Gyazo"})),(0,i.kt)("p",null,'Once the settings are done, click "Add" to add the endpoint.'),(0,i.kt)("h4",{id:"verifying-the-behavior-with-swaggerui"},"Verifying the Behavior with SwaggerUI"),(0,i.kt)("p",null,"Click ","[Swagger UI]"," on the target API."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/dd1df1b98fa068161d04404913561d62.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/dd1df1b98fa068161d04404913561d62.png",alt:"Image from Gyazo"})),(0,i.kt)("p",null,'Open the added endpoint and click "Try it out".'),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/ca5ef0830be1223d9a285a40bc52e94b.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/ca5ef0830be1223d9a285a40bc52e94b.png",alt:"Image from Gyazo"})),(0,i.kt)("p",null,'Enter the authentication information and click "Execute".'),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/c71335322e93cddb21ff6f320c6699c3.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/c71335322e93cddb21ff6f320c6699c3.png",alt:"Image from Gyazo"})),(0,i.kt)("p",null,'If the correct authentication information is entered, the response "Two-factor authentication required" will be returned.'),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/c3415be55b1e61fb1fed73ba3a231b82.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/c3415be55b1e61fb1fed73ba3a231b82.png",alt:"Image from Gyazo"})),(0,i.kt)("p",null,"An authentication code will be sent to the user's email address.  "),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/9e5ce41f6918cc5921a0fb90493b008a.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/9e5ce41f6918cc5921a0fb90493b008a.png",alt:"Image from Gyazo"})),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"The content of the notification can be edited using the ",(0,i.kt)("a",{parentName:"p",href:"/docs/management/email-template/"},"message template")," for ",(0,i.kt)("inlineCode",{parentName:"p"},"login/authentication_code"),".")),(0,i.kt)("p",null,"Remove ",(0,i.kt)("inlineCode",{parentName:"p"},"password")," from the request body, enter ",(0,i.kt)("inlineCode",{parentName:"p"},"onetime_password"),', and click "Execute" again.  '),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/c314191a75a617ec071a1084cffa12cb.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/c314191a75a617ec071a1084cffa12cb.png",alt:"Image from Gyazo"})),(0,i.kt)("p",null,"A grant_token is issued, confirming that the login was successful."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/dd1022c33fc898a8fb93a9f6f1b53355.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/dd1022c33fc898a8fb93a9f6f1b53355.png",alt:"Image from Gyazo"})),(0,i.kt)("h3",{id:"two-factor-authentication-via-authenticater"},"Two-Factor Authentication via Authenticater"),(0,i.kt)("p",null,"To use two-factor authentication via Authenticater, you first need to set up a one-time password in the Kuroco admin panel.  "),(0,i.kt)("h4",{id:"setting-up-the-use-of-one-time-passwords"},"Setting Up the Use of One-Time Passwords"),(0,i.kt)("p",null,"Click ","[Environment]"," -> ","[Site settings]",".",(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/002199025b3aab15d6efad0162dd13c9.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/002199025b3aab15d6efad0162dd13c9.png",alt:"Image from Gyazo"})),(0,i.kt)("p",null,"Set the Authentication code in the Login section to ","[Use]",".",(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/a049b781d10c46c7f1bdd49b5eb3e133.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/a049b781d10c46c7f1bdd49b5eb3e133.png",alt:"Image from Gyazo"})),(0,i.kt)("h3",{id:"registering-a-one-time-password"},"Registering a one-time password"),(0,i.kt)("p",null,"You can register a one-time password from the member settings in the admin page.\nGo to your member information by clicking ","[Member]"," -> ","[Member]"," or by clicking your icon in the upper right corner of the admin page.  "),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/4d16e8303a816afced9258dedfe55b10.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/4d16e8303a816afced9258dedfe55b10.png",alt:"Image from Gyazo"})),(0,i.kt)("p",null,"Click ","[Set up]"," for 2-Step Verification in the ID information tab.",(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/c90288ab5d7c07fc671e799e452e9adb.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/c90288ab5d7c07fc671e799e452e9adb.png",alt:"Image from Gyazo"})),(0,i.kt)("p",null,"The one-time password setup screen will open, so click ","[Register]",".",(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/47756c0f4f882cec9c1667ebd2bb37b0.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/47756c0f4f882cec9c1667ebd2bb37b0.png",alt:"Image from Gyazo"})),(0,i.kt)("p",null,"Open the Google Authenticator app, scan the QR code, and enter the 6-digit authentication code.",(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/b833b6b3c61e20b3a4e6b1b8dab88c2b.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/b833b6b3c61e20b3a4e6b1b8dab88c2b.png",alt:"Image from Gyazo"})),(0,i.kt)("p",null,'Once you see the message "Registered", the setup is complete.',(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/02fb149bfe105f84314cd366416ed91e.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/02fb149bfe105f84314cd366416ed91e.png",alt:"Image from Gyazo"})),(0,i.kt)("h4",{id:"creating-an-endpoint-1"},"Creating an endpoint"),(0,i.kt)("p",null,'Once you are ready to use the one-time password, click on "Add new endpoint" in any API.'),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/6180b91072835695331f82e5ed2f09f3.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/6180b91072835695331f82e5ed2f09f3.png",alt:"Image from Gyazo"})),(0,i.kt)("p",null,"Configure the following:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,i.kt)("th",{parentName:"tr",align:"left"},"Setting"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"Path"),(0,i.kt)("td",{parentName:"tr",align:"left"},"2steplogin/code")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"Category"),(0,i.kt)("td",{parentName:"tr",align:"left"},"Authentication")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"Model"),(0,i.kt)("td",{parentName:"tr",align:"left"},"Login")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"Operation"),(0,i.kt)("td",{parentName:"tr",align:"left"},"login_challenge")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"twofactor_method"),(0,i.kt)("td",{parentName:"tr",align:"left"},"code")))),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/c8d193af05a994220645404b563dc289.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/c8d193af05a994220645404b563dc289.png",alt:"Image from Gyazo"})),(0,i.kt)("p",null,"Once the configuration is complete, click on ","[Add]"," to add the endpoint."),(0,i.kt)("h4",{id:"confirming-the-operation-with-swaggerui"},"Confirming the operation with SwaggerUI"),(0,i.kt)("p",null,"Click on ","[Swagger UI]"," in the target API."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/dd1df1b98fa068161d04404913561d62.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/dd1df1b98fa068161d04404913561d62.png",alt:"Image from Gyazo"})),(0,i.kt)("p",null,"Open the added endpoint and click on ","[Try it out]","."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/7d730d8c789bde559491c22747e7ff2a.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/7d730d8c789bde559491c22747e7ff2a.png",alt:"Image from Gyazo"})),(0,i.kt)("p",null,"Enter the authentication information and click on ","[Execute]","."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/c71335322e93cddb21ff6f320c6699c3.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/c71335322e93cddb21ff6f320c6699c3.png",alt:"Image from Gyazo"})),(0,i.kt)("p",null,'If the correct authentication information is entered, the response "Two-factor authentication required" will be returned.'),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/c3415be55b1e61fb1fed73ba3a231b82.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/c3415be55b1e61fb1fed73ba3a231b82.png",alt:"Image from Gyazo"})),(0,i.kt)("p",null,"Open the Google Authenticator app on your device and check the authentication code."),(0,i.kt)("p",null,"Remove ",(0,i.kt)("inlineCode",{parentName:"p"},"password")," from the request body, enter ",(0,i.kt)("inlineCode",{parentName:"p"},"onetime_password"),", and click ","[Execute]"," again."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/839b935ef021e42c6e7941fe5c830dbe.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/839b935ef021e42c6e7941fe5c830dbe.png",alt:"Image from Gyazo"})),(0,i.kt)("p",null,"A grant_token is issued, confirming that login was successful."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/dd1022c33fc898a8fb93a9f6f1b53355.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/dd1022c33fc898a8fb93a9f6f1b53355.png",alt:"Image from Gyazo"})),(0,i.kt)("h3",{id:"two-factor-authentication-via-sms"},"Two-factor authentication via SMS"),(0,i.kt)("p",null,'To use two-factor authentication via SMS, integration with Twilio is required.\nAlso, the member\'s phone number must be a Japanese domestic phone number starting with "090", "080", "070", or "060".\nFirst, please refer to the following document for the settings.'),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("a",{parentName:"p",href:"/docs/tutorials/how-to-connect-to-twillio/"},"Sending SMS with Twilio integration"))),(0,i.kt)("h4",{id:"creating-an-endpoint-2"},"Creating an endpoint"),(0,i.kt)("p",null,'Once you are ready to use SMS, click on "Add new endpoint" in any API.'),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/6180b91072835695331f82e5ed2f09f3.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/6180b91072835695331f82e5ed2f09f3.png",alt:"Image from Gyazo"})),(0,i.kt)("p",null,"Configure the following:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,i.kt)("th",{parentName:"tr",align:"left"},"Setting"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"Path"),(0,i.kt)("td",{parentName:"tr",align:"left"},"2steplogin/sms")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"Category"),(0,i.kt)("td",{parentName:"tr",align:"left"},"Authentication")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"Model"),(0,i.kt)("td",{parentName:"tr",align:"left"},"Login")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"Operation"),(0,i.kt)("td",{parentName:"tr",align:"left"},"login_challenge")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"twofactor_method"),(0,i.kt)("td",{parentName:"tr",align:"left"},"sms")))),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/77685f00284f2e1db9c76c8166d5eb6d.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/77685f00284f2e1db9c76c8166d5eb6d.png",alt:"Image from Gyazo"})),(0,i.kt)("p",null,"After setting, click ","[Add]"," to add the endpoint."),(0,i.kt)("h4",{id:"verify-operation-with-swaggerui"},"Verify operation with SwaggerUI"),(0,i.kt)("p",null,"Click ","[Swagger UI]"," from the target API."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/dd1df1b98fa068161d04404913561d62.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/dd1df1b98fa068161d04404913561d62.png",alt:"Image from Gyazo"})),(0,i.kt)("p",null,"Open the added endpoint and click ","[Try it out]","."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/7a1385323d255fa212e5c0c9c5ff2de9.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/7a1385323d255fa212e5c0c9c5ff2de9.png",alt:"Image from Gyazo"})),(0,i.kt)("p",null,"Enter authentication information and click ","[Execute]","."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/c71335322e93cddb21ff6f320c6699c3.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/c71335322e93cddb21ff6f320c6699c3.png",alt:"Image from Gyazo"})),(0,i.kt)("p",null,'If the correct authentication information is entered, the response "Two-factor authentication required" will be returned.'),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/c3415be55b1e61fb1fed73ba3a231b82.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/c3415be55b1e61fb1fed73ba3a231b82.png",alt:"Image from Gyazo"})),(0,i.kt)("p",null,"You will receive an authentication code via SMS, so check the value.  "),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"The content of the notification can be edited in the ",(0,i.kt)("a",{parentName:"p",href:"/docs/management/email-template/"},"message template")," of ",(0,i.kt)("inlineCode",{parentName:"p"},"login/sms_authentication_code"),".")),(0,i.kt)("p",null,"Remove ",(0,i.kt)("inlineCode",{parentName:"p"},"password")," from the request body, enter ",(0,i.kt)("inlineCode",{parentName:"p"},"onetime_password"),", and click ","[Execute]"," again.  "),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/c314191a75a617ec071a1084cffa12cb.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/c314191a75a617ec071a1084cffa12cb.png",alt:"Image from Gyazo"})),(0,i.kt)("p",null,"A grant_token is issued and it is confirmed that login is successful.\n",(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/dd1022c33fc898a8fb93a9f6f1b53355.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/dd1022c33fc898a8fb93a9f6f1b53355.png",alt:"Image from Gyazo"})),(0,i.kt)("h3",{id:"forcing-additional-authentication"},"Forcing Additional Authentication"),(0,i.kt)("p",null,"Even if the ",(0,i.kt)("inlineCode",{parentName:"p"},"twofactor_method")," parameter is set, the login will be successful if no additional authentication information is registered.",(0,i.kt)("br",{parentName:"p"}),"\n","It is assumed that the user will be prompted to register a phone number, etc. after logging in, but if you want to display an error without logging in, create a custom process and set it as ",(0,i.kt)("a",{parentName:"p",href:"/docs/reference/post-processing/"},"post-processing"),"."),(0,i.kt)("p",null,"The following is an example of post-processing that logs out forcibly and displays an error response when logging in is completed without going through the additional authentication information step."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-smarty"},"{if isset($smarty.post.password) && $json.grant_token != null}\n    {append var=json.errors value='Additional authentication information is not registered.'}\n    {logout}\n{/if}\n{assign var=processed_json value=$json}\n")),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/2e1d6f26e190fdcda55a4497fe502626.jpg?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/2e1d6f26e190fdcda55a4497fe502626.jpg",alt:"Image from Gyazo"})),(0,i.kt)("h2",{id:"implementing-the-frontend"},"Implementing the frontend"),(0,i.kt)("p",null,"Finally, implement the behavior confirmed with SwaggerUI on the frontend."),(0,i.kt)("p",null,"Create a file named index.vue in the ",(0,i.kt)("inlineCode",{parentName:"p"},"/login/2step_login/")," directory.",(0,i.kt)("br",{parentName:"p"}),"\n","The following is an example of two-step authentication using email."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-markup",metastring:'title="/pages/login/2step_login/index.vue"',title:'"/pages/login/2step_login/index.vue"'},'<template>\n  <div>\n    <p v-if="Status !== null" :style="{ color: resultMessageColor }">\n      {{ resultMessage }}\n    </p>\n    <form v-if="preloginStatus === false" @submit.prevent="login">\n      <input v-model="email" name="email" type="email" placeholder="email" />\n      <input v-model="password" name="password" type="password" placeholder="password" />\n      <button type="submit">Login</button>\n    </form>\n    <form v-if="preloginStatus === true" @submit.prevent="second_authentication">\n      <input v-model="onetime_password" name="onetime_password" type="onetime_password" placeholder="onetime_password" />\n      <button type="submit">Submit</button>\n    </form>\n  </div>\n</template>\n  \n<script>\nexport default {\n  data() {\n    return {\n      email: \'\',\n      password: \'\',\n      onetime_password: \'\',\n      Status: null,\n      preloginStatus: false,\n      resultMessage: null,\n    };\n  },\n  computed: {\n    resultMessageColor() {\n      switch (this.Status) {\n        case \'success\':\n          return \'green\';\n        case \'failure\':\n          return \'red\';\n        default:\n          return \'\';\n      }\n    },\n  },\n  methods: {\n    async login() {\n      try {\n        const payload = {\n          email: this.email,\n          password: this.password\n        };\n        const response = await this.$axios.$post(\'/rcms-api/1/2steplogin/email\', payload);\n        this.Status = \'success\';\n        if (response.status === 3) {\n          this.preloginStatus = true;\n          this.resultMessage = response.messages;\n        }\n        if (response.status === 0) {\n          this.resultMessage = \'Login succeeded. Please register the second factor authentication information.\';\n        }\n      } catch (error) {\n        this.Status = \'failure\';\n        this.resultMessage = error.response.data.errors[0].message\n      }\n    },\n    async second_authentication() {\n      try {\n        const payload = {\n          email: this.email,\n          onetime_password: this.onetime_password\n        };\n        const response = await this.$axios.$post(\'/rcms-api/1/2steplogin/email\', payload);\n        this.Status = \'success\';\n        if (response.status === 3) {\n          this.preloginStatus = true;\n          this.resultMessage = response.messages;\n        }\n        if (response.status === 0) {\n          this.resultMessage = \'Login succeeded.\';\n        }\n      } catch (error) {\n        this.preloginStatus = false;\n        this.Status = \'failure\';\n        this.resultMessage = error.response.data.errors[0].message;\n      }\n    },\n  },\n};\n<\/script>\n')),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"The above sample code is minimal for reference purposes.",(0,i.kt)("br",{parentName:"p"}),"\n","When using it in practice, please also use form validation processing and libraries such as ",(0,i.kt)("inlineCode",{parentName:"p"},"@nuxt/auth"),".")),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"Please change the part ",(0,i.kt)("inlineCode",{parentName:"p"},"/rcms-api/1/2steplogin/email")," to the URL of your own endpoint.")),(0,i.kt)("h4",{id:"verification"},"Verification"),(0,i.kt)("p",null,"Once you have executed and confirmed the operation, the implementation of two-step authentication on the login screen is complete."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/1a3b4174c993bd34c2579cdbfa162dcd.gif?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/1a3b4174c993bd34c2579cdbfa162dcd.gif",alt:"Image from Gyazo"})),(0,i.kt)("h2",{id:"related-documentation"},"Related Documentation"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/tutorials/beginners-guide/"},"Beginner's guide to Kuroco")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/tutorials/integrate-login/"},"Building a login page using Kuroco and Nuxt.js")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/reference/post-processing/"},"Post-processing")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/tutorials/implementing-two-step-verification-on-registration-form/"},"Implementing Two-Factor Authentication on the Member Registration Screen with Kuroco and Nuxt.js"))))}d.isMDXComponent=!0}}]);