"use strict";(self.webpackChunkkurokuro=self.webpackChunkkurokuro||[]).push([[60730],{3905:(t,e,a)=>{a.d(e,{Zo:()=>d,kt:()=>u});var n=a(67294);function r(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function i(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function o(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?i(Object(a),!0).forEach((function(e){r(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function l(t,e){if(null==t)return{};var a,n,r=function(t,e){if(null==t)return{};var a,n,r={},i=Object.keys(t);for(n=0;n<i.length;n++)a=i[n],e.indexOf(a)>=0||(r[a]=t[a]);return r}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(n=0;n<i.length;n++)a=i[n],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(r[a]=t[a])}return r}var m=n.createContext({}),p=function(t){var e=n.useContext(m),a=e;return t&&(a="function"==typeof t?t(e):o(o({},e),t)),a},d=function(t){var e=p(t.components);return n.createElement(m.Provider,{value:e},t.children)},s="mdxType",c={inlineCode:"code",wrapper:function(t){var e=t.children;return n.createElement(n.Fragment,{},e)}},g=n.forwardRef((function(t,e){var a=t.components,r=t.mdxType,i=t.originalType,m=t.parentName,d=l(t,["components","mdxType","originalType","parentName"]),s=p(a),g=r,u=s["".concat(m,".").concat(g)]||s[g]||c[g]||i;return a?n.createElement(u,o(o({ref:e},d),{},{components:a})):n.createElement(u,o({ref:e},d))}));function u(t,e){var a=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var i=a.length,o=new Array(i);o[0]=g;var l={};for(var m in e)hasOwnProperty.call(e,m)&&(l[m]=e[m]);l.originalType=t,l[s]="string"==typeof t?t:r,o[1]=l;for(var p=2;p<i;p++)o[p]=a[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}g.displayName="MDXCreateElement"},62185:(t,e,a)=>{a.r(e),a.d(e,{assets:()=>m,contentTitle:()=>o,default:()=>c,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var n=a(87462),r=(a(67294),a(3905));const i={title:"Implementing Two-Factor Authentication on the Member Registration Screen with Kuroco and Nuxt.js",description:"This tutorial explains how to implement two-factor authentication on the member registration screen by issuing a random 6-digit authentication code during new member registration."},o=void 0,l={unversionedId:"tutorials/implementing-two-step-verification-on-registration-form",id:"tutorials/implementing-two-step-verification-on-registration-form",title:"Implementing Two-Factor Authentication on the Member Registration Screen with Kuroco and Nuxt.js",description:"This tutorial explains how to implement two-factor authentication on the member registration screen by issuing a random 6-digit authentication code during new member registration.",source:"@site/docs/tutorials/implementing-two-step-verification-on-registration-form.md",sourceDirName:"tutorials",slug:"/tutorials/implementing-two-step-verification-on-registration-form",permalink:"/docs/tutorials/implementing-two-step-verification-on-registration-form",draft:!1,editUrl:"https://github.com/diverta/kuroco-documents/tree/main/packages/create-docusaurus/templates/shared/docs/tutorials/implementing-two-step-verification-on-registration-form.md",tags:[],version:"current",frontMatter:{title:"Implementing Two-Factor Authentication on the Member Registration Screen with Kuroco and Nuxt.js",description:"This tutorial explains how to implement two-factor authentication on the member registration screen by issuing a random 6-digit authentication code during new member registration."},sidebar:"documentationSidebar",previous:{title:"How to implement member registration with authentication function using Kuroco and Nuxt.js",permalink:"/docs/tutorials/setting-up-pre-member-registration-form"},next:{title:"Building the Account Information Display, Update, and Delete Screens",permalink:"/docs/tutorials/setting-up-the-display-update-delete-screen-for-account-information"}},m={},p=[{value:"Overview",id:"overview",level:2},{value:"What you will learn",id:"what-you-will-learn",level:3},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Preparations",id:"preparations",level:2},{value:"Creating APIs",id:"creating-apis",level:3},{value:"Creating the Internal API",id:"creating-the-internal-api",level:4},{value:"Creating an API",id:"creating-an-api",level:4},{value:"Security configuration",id:"security-configuration",level:4},{value:"Setting CORS",id:"setting-cors",level:4},{value:"Two-Factor Authentication for Member Registration",id:"two-factor-authentication-for-member-registration",level:2},{value:"Creating Endpoints",id:"creating-endpoints",level:3},{value:"Endpoint for creating provisional members",id:"endpoint-for-creating-provisional-members",level:4},{value:"Endpoint to call custom function to create and send OTP",id:"endpoint-to-call-custom-function-to-create-and-send-otp",level:4},{value:"Endpoint to check OTP and complete registration",id:"endpoint-to-check-otp-and-complete-registration",level:4},{value:"Creating Internal Endpoints",id:"creating-internal-endpoints",level:3},{value:"Endpoint for updating provisional members",id:"endpoint-for-updating-provisional-members",level:4},{value:"Endpoint for member registration",id:"endpoint-for-member-registration",level:4},{value:"Creating Custom Function",id:"creating-custom-function",level:3},{value:"Custom Function for Issuing and Sending OTP",id:"custom-function-for-issuing-and-sending-otp",level:4},{value:"Custom Function for Matching Authentication Codes",id:"custom-function-for-matching-authentication-codes",level:4},{value:"Verifying the Operation with SwaggerUI",id:"verifying-the-operation-with-swaggerui",level:3},{value:"Send a Member Registration Request",id:"send-a-member-registration-request",level:4},{value:"Send a Request to Send the One-Time Password",id:"send-a-request-to-send-the-one-time-password",level:4},{value:"Sending the One-Time Password",id:"sending-the-one-time-password",level:4},{value:"Implementing the Frontend",id:"implementing-the-frontend",level:3},{value:"Creating a Page for Pre-registration",id:"creating-a-page-for-pre-registration",level:4},{value:"Creating a Page for Registration",id:"creating-a-page-for-registration",level:4},{value:"Testing",id:"testing",level:4},{value:"Pre-registration",id:"pre-registration",level:5},{value:"Additional Authentication Code Registration",id:"additional-authentication-code-registration",level:5},{value:"Related Documents",id:"related-documents",level:2}],d={toc:p},s="wrapper";function c(t){let{components:e,...a}=t;return(0,r.kt)(s,(0,n.Z)({},d,a,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"overview"},"Overview"),(0,r.kt)("p",null,"This tutorial explains how to implement two-factor authentication on the member registration screen by issuing a random 6-digit authentication code during new member registration."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"In this tutorial, we will introduce two-factor authentication using email, but you can also implement two-factor authentication using SMS by integrating with Twilio using the same steps.")),(0,r.kt)("h3",{id:"what-you-will-learn"},"What you will learn"),(0,r.kt)("p",null,"To implement two-factor authentication during new member registration, you will need to follow the following steps:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#two-factor-authentication-for-member-registration"},"Two-Factor Authentication for Member Registration"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#creating-endpoints"},"Creating Endpoints")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#creating-internal-endpoints"},"Creating Internal Endpoints")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#creating-custom-function"},"Creating Custom Function")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#verifying-the-operation-with-swaggerui"},"Verifying the Operation with SwaggerUI")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#implementing-the-frontend"},"Implementing the Frontend"))))),(0,r.kt)("h3",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("p",null,"This page assumes that you have already built a project with Kuroco and Nuxt.js.",(0,r.kt)("br",{parentName:"p"}),"\n","If you haven't done so yet, please refer to the following tutorials.  "),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/tutorials/beginners-guide/"},"Kuroco Beginner's Guide"),"  "),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/tutorials/setting-up-registration-form/"},"Setting Up the Member Registration Screen with Kuroco and Nuxt.js"),"  "),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/tutorials/setting-up-pre-member-registration-form/"},"Implementing Pre-Member Registration Functionality on the Member Registration Screen with Kuroco and Nuxt.js")))),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"If you want to implement two-factor authentication using SMS, you will also need to follow the tutorial below.  "),(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/tutorials/how-to-connect-to-twillio/"},"Sending SMS with Twilio")))),(0,r.kt)("h2",{id:"preparations"},"Preparations"),(0,r.kt)("h3",{id:"creating-apis"},"Creating APIs"),(0,r.kt)("p",null,"We will use the Default API and the Internal API for internal processing.",(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/d30570acc7773b84b9d3962c2b6a1cb8.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/d30570acc7773b84b9d3962c2b6a1cb8.png",alt:"Image from Gyazo"})),(0,r.kt)("h4",{id:"creating-the-internal-api"},"Creating the Internal API"),(0,r.kt)("p",null,"It is recommended to create separate APIs for endpoints that are only used internally in Kuroco.",(0,r.kt)("br",{parentName:"p"}),"\n","Therefore, first, create a new API for internal use.\nIf you have already added it, you can proceed to the next step.  "),(0,r.kt)("h4",{id:"creating-an-api"},"Creating an API"),(0,r.kt)("p",null,"Click ","[Add]"," from the API in the Kuroco Admin panel.  "),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/9ecf385ebd0bbd4ed2fce44c5b03908a.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/9ecf385ebd0bbd4ed2fce44c5b03908a.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,'On the API creation screen, enter the following and click "Add".  '),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/4ad1441b5747037b667256ac969fa60a.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/4ad1441b5747037b667256ac969fa60a.png",alt:"Image from Gyazo"})),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Setting"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Title"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Internal")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Version"),(0,r.kt)("td",{parentName:"tr",align:"left"},"1.0")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Description"),(0,r.kt)("td",{parentName:"tr",align:"left"},"API for internal use")))),(0,r.kt)("p",null,"The API has been created."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/42d21c717bec7d592b968486a036da90.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/42d21c717bec7d592b968486a036da90.png",alt:"Image from Gyazo"})),(0,r.kt)("h4",{id:"security-configuration"},"Security configuration"),(0,r.kt)("p",null,"Next, configure security. Click ","[Security]",".  "),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/02b9bb7afc1ef03a4f26f524267c76a8.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/02b9bb7afc1ef03a4f26f524267c76a8.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Set the security to ","[Dynamic Access Token]",", and click ","[Save]",".   "),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/0a121f90acd9ef3c1494cd895d922dae.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/0a121f90acd9ef3c1494cd895d922dae.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"After setting security to a dynamic access token, it is recommended to use the Login::token endpoint, but it can be ignored if it is for internal use only."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/8ab8a67d5768bf7d84e6e8dc79753de1.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/8ab8a67d5768bf7d84e6e8dc79753de1.png",alt:"Image from Gyazo"})),(0,r.kt)("h4",{id:"setting-cors"},"Setting CORS"),(0,r.kt)("p",null,"Next, we will configure CORS. Click ","[Operation CORS]","."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/706501419568a0dc13e7312f83da4fd4.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/706501419568a0dc13e7312f83da4fd4.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Click ","[Add Origin]"," for CORS_ALLOW_ORIGINS and add the following:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Admin panel URL")),(0,r.kt)("p",null,"Click ","[Add Method]"," for CORS_ALLOW_METHODS and add the following:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"GET"),(0,r.kt)("li",{parentName:"ul"},"POST"),(0,r.kt)("li",{parentName:"ul"},"OPTIONS")),(0,r.kt)("p",null,"Check that ","[Allow Credentials]"," is selected for CORS_ALLOW_CREDENTIALS."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/cc94eb7d3a09a673440a54c17e69242e.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/cc94eb7d3a09a673440a54c17e69242e.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Click ","[Save]"," if there are no problems."),(0,r.kt)("h2",{id:"two-factor-authentication-for-member-registration"},"Two-Factor Authentication for Member Registration"),(0,r.kt)("p",null,"Now, let's implement two-factor authentication for member registration.\nThe following 3 steps are assumed for user operations from the frontend:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Step"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Frontend (User) Operation"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Kuroco Process"),(0,r.kt)("th",{parentName:"tr",align:"left"},"API Used"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"1"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Send basic information for member registration"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Create a provisional member"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Member::invite")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"2"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Access the invitation email URL and click the button to send the authentication code"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Access the provisional member information using email_hash, add a one-time password, and send an email"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Api::request_api",(0,r.kt)("br",null),"Member::invite",(0,r.kt)("br",null),"MemberProvisional::update")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"3"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Enter the one-time password and send it"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Access the provisional member information using email_hash, and if the one-time password matches, register the member"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Api::request_api",(0,r.kt)("br",null),"Member::invite",(0,r.kt)("br",null),"Member::insert")))),(0,r.kt)("h3",{id:"creating-endpoints"},"Creating Endpoints"),(0,r.kt)("p",null,"Click ","[Add New Endpoint]"," from the Default API to add endpoints."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/6180b91072835695331f82e5ed2f09f3.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/6180b91072835695331f82e5ed2f09f3.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"This time, we will create the following endpoints:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Endpoint for creating provisional members"),(0,r.kt)("li",{parentName:"ul"},"Endpoint to call custom function to create and send OTP"),(0,r.kt)("li",{parentName:"ul"},"Endpoint to check OTP and complete registration")),(0,r.kt)("h4",{id:"endpoint-for-creating-provisional-members"},"Endpoint for creating provisional members"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Setting"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Path"),(0,r.kt)("td",{parentName:"tr",align:"left"},"2step_member_invite")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Category"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Member")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Model"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Member")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Operation"),(0,r.kt)("td",{parentName:"tr",align:"left"},"invite")))),(0,r.kt)("h4",{id:"endpoint-to-call-custom-function-to-create-and-send-otp"},"Endpoint to call custom function to create and send OTP"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Setting"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Path"),(0,r.kt)("td",{parentName:"tr",align:"left"},"set_and_send_otp")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Category"),(0,r.kt)("td",{parentName:"tr",align:"left"},"API")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Model"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Api")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Operation"),(0,r.kt)("td",{parentName:"tr",align:"left"},"request_api_post")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"name"),(0,r.kt)("td",{parentName:"tr",align:"left"},"set_and_send_otp")))),(0,r.kt)("h4",{id:"endpoint-to-check-otp-and-complete-registration"},"Endpoint to check OTP and complete registration"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Setting"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Path"),(0,r.kt)("td",{parentName:"tr",align:"left"},"check_otp_and_regist")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Category"),(0,r.kt)("td",{parentName:"tr",align:"left"},"API")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Model"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Api")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Operation"),(0,r.kt)("td",{parentName:"tr",align:"left"},"request_api_post")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"name"),(0,r.kt)("td",{parentName:"tr",align:"left"},"check_otp_and_regist")))),(0,r.kt)("h3",{id:"creating-internal-endpoints"},"Creating Internal Endpoints"),(0,r.kt)("p",null,"Click ","[Add New Endpoint]"," from the Internal API to add endpoints."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/d13dbe050d52ad41b2c82fef6c71d867.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/d13dbe050d52ad41b2c82fef6c71d867.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"This time, we will create the following endpoints:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Endpoint for updating provisional members"),(0,r.kt)("li",{parentName:"ul"},"Endpoint for member registration")),(0,r.kt)("h4",{id:"endpoint-for-updating-provisional-members"},"Endpoint for updating provisional members"),(0,r.kt)("p",null,"Create an endpoint for updating provisional members with the following settings:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Setting"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Path"),(0,r.kt)("td",{parentName:"tr",align:"left"},"pre_member_update")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Category"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Member")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Model"),(0,r.kt)("td",{parentName:"tr",align:"left"},"MemberProvisional")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Operation"),(0,r.kt)("td",{parentName:"tr",align:"left"},"update")))),(0,r.kt)("h4",{id:"endpoint-for-member-registration"},"Endpoint for member registration"),(0,r.kt)("p",null,"Create an endpoint for member registration with the following settings:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Setting"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Path"),(0,r.kt)("td",{parentName:"tr",align:"left"},"2step_member_regist")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Category"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Member")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Model"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Member")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Operation"),(0,r.kt)("td",{parentName:"tr",align:"left"},"insert")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"default_group_id"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Enter the ID of the member group to apply.",(0,r.kt)("br",null),"You can confirm the group ID from ",(0,r.kt)("a",{parentName:"td",href:"/docs/management/group/"},"Groups"),".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"login_ok_flg"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Check the box")))),(0,r.kt)("h3",{id:"creating-custom-function"},"Creating Custom Function"),(0,r.kt)("h4",{id:"custom-function-for-issuing-and-sending-otp"},"Custom Function for Issuing and Sending OTP"),(0,r.kt)("p",null,"Create a custom function that generates a one-time password and its expiration date, updates temporary member information, and sends the one-time password to the user."),(0,r.kt)("p",null,"Click ","[Operations]"," -> ","[Custom function]","."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/9a9b5f1fa42555de0222180269ef487b.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/9a9b5f1fa42555de0222180269ef487b.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Click ","[Add]","."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/52169f762d9ea4abf1d05bb56d553906.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/52169f762d9ea4abf1d05bb56d553906.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Enter the following:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Setting"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Title"),(0,r.kt)("td",{parentName:"tr",align:"left"},"set_and_send_otp")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Identifier"),(0,r.kt)("td",{parentName:"tr",align:"left"},"set_and_send_otp")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Processing"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Code below")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-smarty",metastring:'reference title="set_and_send_otp"',reference:!0,title:'"set_and_send_otp"'},"https://github.com/diverta/kuroco-documents/blob/main/sample_code/custom_function/request_api_post/set_and_send_otp.txt\n")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"If you want to send the one-time password via SMS, modify the ",(0,r.kt)("inlineCode",{parentName:"p"},"to=$pre_member_info.data.email")," part of ",(0,r.kt)("inlineCode",{parentName:"p"},"sendmail")," to"),(0,r.kt)("code",null,'to="`$pre_member_info.data.ext_info.tel`@twilio.r-cms.jp"'),"."),(0,r.kt)("h4",{id:"custom-function-for-matching-authentication-codes"},"Custom Function for Matching Authentication Codes"),(0,r.kt)("p",null,"Create a custom function that registers a member using Member::insert when the one-time password matches."),(0,r.kt)("p",null,"Click ","[Operations]"," -> ","[Custom function]","."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/9a9b5f1fa42555de0222180269ef487b.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/9a9b5f1fa42555de0222180269ef487b.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Click ","[Add]","."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/52169f762d9ea4abf1d05bb56d553906.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/52169f762d9ea4abf1d05bb56d553906.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Enter the following:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Setting"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Title"),(0,r.kt)("td",{parentName:"tr",align:"left"},"check_otp_and_regist")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Identifier"),(0,r.kt)("td",{parentName:"tr",align:"left"},"check_otp_and_regist")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Processing"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Code below")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-smarty",metastring:'reference title="check_otp_and_regist"',reference:!0,title:'"check_otp_and_regist"'},"https://github.com/diverta/kuroco-documents/blob/main/sample_code/custom_function/request_api_post/check_otp_and_regist.txt\n")),(0,r.kt)("h3",{id:"verifying-the-operation-with-swaggerui"},"Verifying the Operation with SwaggerUI"),(0,r.kt)("p",null,"Once you have prepared the Kuroco API and custom function, use SwaggerUI to verify the operation."),(0,r.kt)("h4",{id:"send-a-member-registration-request"},"Send a Member Registration Request"),(0,r.kt)("p",null,"Click ",(0,r.kt)("inlineCode",{parentName:"p"},"/rcms-api/1/2step_member_invite")," in the SwaggerUI of the Default endpoint."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/263844309fc922b18be00c09bf024614.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/263844309fc922b18be00c09bf024614.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Click ","[try it out]","."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/b06805884f011a1f37faea518c4d059c.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/b06805884f011a1f37faea518c4d059c.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Enter the following in the Request body and click ","[Execute]",":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "email": "example@dexample.com",\n  "ext_info": {\n    "name": "MyName",\n    "login_pwd": "********",\n    "tel": "00011112222"\n  }\n}\n')),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/35f5d17cd9cdc4599af995358508f699.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/35f5d17cd9cdc4599af995358508f699.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Check the 200 response."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/4381e8e59bca5ada9a7333feaa7a267f.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/4381e8e59bca5ada9a7333feaa7a267f.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Copy the key from the invitation email."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/3e057d131849b6412aa205f165ce09d2.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/3e057d131849b6412aa205f165ce09d2.png",alt:"Image from Gyazo"})),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"You can edit the content of the invitation email using the template for ",(0,r.kt)("a",{parentName:"p",href:"/docs/management/email-template/#editing-message-templates"},"Message Templates"),".\nModify the link part to ",(0,r.kt)("inlineCode",{parentName:"p"},"{$smarty.const.ROOT_URL}/login/2step_regist?key={$preregist_key}")," so that you can directly transition from the email.")),(0,r.kt)("h4",{id:"send-a-request-to-send-the-one-time-password"},"Send a Request to Send the One-Time Password"),(0,r.kt)("p",null,"Click ",(0,r.kt)("inlineCode",{parentName:"p"},"/rcms-api/1/set_and_send_otp"),"."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/f45816cf91de6e172206a98f84d40d84.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/f45816cf91de6e172206a98f84d40d84.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Click ","[try it out]","."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/e450330f9b8640e815b81abf1f26f77d.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/e450330f9b8640e815b81abf1f26f77d.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Enter the following in the Request body and click ","[Execute]",":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "email_hash": "KEY"\n}\n')),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/c6d724bf1a076a471d64d1aa86bb457d.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/c6d724bf1a076a471d64d1aa86bb457d.png",alt:"Image from Gyazo"})),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Replace ",(0,r.kt)("inlineCode",{parentName:"p"},'"KEY"')," with the key copied from the invitation email.")),(0,r.kt)("p",null,"Check the 200 response."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/59c4d9a2b9961556371c83399e982f35.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/59c4d9a2b9961556371c83399e982f35.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Confirm the one-time password that will be sent to your email."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/5fc0a8868d86e272d8eef20cb385a311.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/5fc0a8868d86e272d8eef20cb385a311.png",alt:"Image from Gyazo"})),(0,r.kt)("h4",{id:"sending-the-one-time-password"},"Sending the One-Time Password"),(0,r.kt)("p",null,"Click on ",(0,r.kt)("inlineCode",{parentName:"p"},"/rcms-api/1/check_otp_and_regist"),"."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/aeb64b1626789bb76a2765dacf1531c6.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/aeb64b1626789bb76a2765dacf1531c6.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Click on ","[try it out]","."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/07027b8c6952ea046d198cb5c896d981.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/07027b8c6952ea046d198cb5c896d981.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Enter the following in the Request body and click ","[Execute]","."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "email_hash": "KEY",\n  "otp":"OTP"\n}\n')),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Replace ",(0,r.kt)("inlineCode",{parentName:"p"},'"OTP"')," and ",(0,r.kt)("inlineCode",{parentName:"p"},'"KEY"')," with the key from the invitation email that you copied earlier.")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/bb8f2bf6e1f183d7233decdcac068f8f.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/bb8f2bf6e1f183d7233decdcac068f8f.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Check the response with status code 200."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/98a63e0188f01445a320616e961efbce.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/98a63e0188f01445a320616e961efbce.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"When you navigate to the member information list, you can confirm that the user has been registered."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/89702ef983241a9d87d654b7b71ea2d4.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/89702ef983241a9d87d654b7b71ea2d4.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"This completes the configuration on the Kuroco side. Please implement the functionality in the frontend based on the behavior confirmed in SwaggerUI."),(0,r.kt)("h3",{id:"implementing-the-frontend"},"Implementing the Frontend"),(0,r.kt)("h4",{id:"creating-a-page-for-pre-registration"},"Creating a Page for Pre-registration"),(0,r.kt)("p",null,"Create a file named ",(0,r.kt)("inlineCode",{parentName:"p"},"index.vue")," in the ",(0,r.kt)("inlineCode",{parentName:"p"},"/login/2step_pre_regist/")," directory."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-markup",metastring:'reference title="/pages/login/2step_pre_regist/index.vue"',reference:!0,title:'"/pages/login/2step_pre_regist/index.vue"'},"https://github.com/diverta/kuroco-documents/blob/main/sample_code/front-end/nuxtjs/2step_pre_regist.vue\n")),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"The provided sample code is minimal and for reference purposes only. Please add form validation logic as needed.")),(0,r.kt)("h4",{id:"creating-a-page-for-registration"},"Creating a Page for Registration"),(0,r.kt)("p",null,"Create a file named ",(0,r.kt)("inlineCode",{parentName:"p"},"index.vue")," in the ",(0,r.kt)("inlineCode",{parentName:"p"},"/login/2step_regist/")," directory."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-markup",metastring:'reference title="/pages/login/2step_regist/index.vue"',reference:!0,title:'"/pages/login/2step_regist/index.vue"'},"https://github.com/diverta/kuroco-documents/blob/main/sample_code/front-end/nuxtjs/2step_regist.vue\n")),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"The ",(0,r.kt)("inlineCode",{parentName:"p"},"email_hash")," is received as a query parameter.")),(0,r.kt)("h4",{id:"testing"},"Testing"),(0,r.kt)("p",null,"Adjust the code according to your environment and perform testing. Once you have confirmed that it works, the implementation of two-step authentication for new member registration is complete."),(0,r.kt)("h5",{id:"pre-registration"},"Pre-registration"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/78e46e933ea3717e8669146b1b50ad84.gif?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/78e46e933ea3717e8669146b1b50ad84.gif",alt:"Image from Gyazo"})),(0,r.kt)("h5",{id:"additional-authentication-code-registration"},"Additional Authentication Code Registration"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/de3034fa8e973e7cbac0479bfccf8595.gif?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/de3034fa8e973e7cbac0479bfccf8595.gif",alt:"Image from Gyazo"})),(0,r.kt)("h2",{id:"related-documents"},"Related Documents"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/tutorials/beginners-guide/"},"Beginner's guide to Kuroco")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/tutorials/setting-up-registration-form/"},"Setting up a new member registration form with Kuroco and Nuxt.js")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/tutorials/setting-up-pre-member-registration-form/"},"How to implement member registration with authentication function using Kuroco and Nuxt.js")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/management/email-template/"},"Message Template")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/reference/smarty-plugin/"},"Smarty Plugin")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/tutorials/creating-a-custom-function-endpoint/"},"Creating a custom function endpoint")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/tutorials/how-to-implement-original-validation-in-api-by-using-function/"},"How to implement original validation in API by using custom function")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/tutorials/implementing-two-step-verification-on-login-form/"},"Implementing Two-Factor Authentication on the Login Screen with Kuroco and Nuxt.js"))))}c.isMDXComponent=!0}}]);