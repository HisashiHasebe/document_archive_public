"use strict";(self.webpackChunkkurokuro=self.webpackChunkkurokuro||[]).push([[97930],{3905:(t,e,a)=>{a.d(e,{Zo:()=>d,kt:()=>u});var n=a(67294);function r(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function o(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function i(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?o(Object(a),!0).forEach((function(e){r(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function s(t,e){if(null==t)return{};var a,n,r=function(t,e){if(null==t)return{};var a,n,r={},o=Object.keys(t);for(n=0;n<o.length;n++)a=o[n],e.indexOf(a)>=0||(r[a]=t[a]);return r}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)a=o[n],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(r[a]=t[a])}return r}var l=n.createContext({}),p=function(t){var e=n.useContext(l),a=e;return t&&(a="function"==typeof t?t(e):i(i({},e),t)),a},d=function(t){var e=p(t.components);return n.createElement(l.Provider,{value:e},t.children)},m="mdxType",c={inlineCode:"code",wrapper:function(t){var e=t.children;return n.createElement(n.Fragment,{},e)}},g=n.forwardRef((function(t,e){var a=t.components,r=t.mdxType,o=t.originalType,l=t.parentName,d=s(t,["components","mdxType","originalType","parentName"]),m=p(a),g=r,u=m["".concat(l,".").concat(g)]||m[g]||c[g]||o;return a?n.createElement(u,i(i({ref:e},d),{},{components:a})):n.createElement(u,i({ref:e},d))}));function u(t,e){var a=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var o=a.length,i=new Array(o);i[0]=g;var s={};for(var l in e)hasOwnProperty.call(e,l)&&(s[l]=e[l]);s.originalType=t,s[m]="string"==typeof t?t:r,i[1]=s;for(var p=2;p<o;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}g.displayName="MDXCreateElement"},84867:(t,e,a)=>{a.r(e),a.d(e,{assets:()=>l,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var n=a(87462),r=(a(67294),a(3905));const o={title:"Displaying Instagram feed using Instagram basic display API in Kuroco",description:"Kuroco allows you to create your own custom APIs and also provides plug-ins that send requests to external APIs which allows you to use services that are not listed in the external system integration, this can be done using the custom function or batch process feature in Kuroco. We will be using the Instagram basic display API as an example in this tutorial."},i=void 0,s={unversionedId:"tutorials/call-the-instagram-basic-display-api-from-kuroco",id:"tutorials/call-the-instagram-basic-display-api-from-kuroco",title:"Displaying Instagram feed using Instagram basic display API in Kuroco",description:"Kuroco allows you to create your own custom APIs and also provides plug-ins that send requests to external APIs which allows you to use services that are not listed in the external system integration, this can be done using the custom function or batch process feature in Kuroco. We will be using the Instagram basic display API as an example in this tutorial.",source:"@site/docs/tutorials/call-the-instagram-basic-display-api-from-kuroco.md",sourceDirName:"tutorials",slug:"/tutorials/call-the-instagram-basic-display-api-from-kuroco",permalink:"/docs/tutorials/call-the-instagram-basic-display-api-from-kuroco",draft:!1,editUrl:"https://github.com/diverta/kuroco-documents/tree/main/packages/create-docusaurus/templates/shared/docs/tutorials/call-the-instagram-basic-display-api-from-kuroco.md",tags:[],version:"current",frontMatter:{title:"Displaying Instagram feed using Instagram basic display API in Kuroco",description:"Kuroco allows you to create your own custom APIs and also provides plug-ins that send requests to external APIs which allows you to use services that are not listed in the external system integration, this can be done using the custom function or batch process feature in Kuroco. We will be using the Instagram basic display API as an example in this tutorial."},sidebar:"documentationSidebar",previous:{title:"Specify the membership group based on the domain at the time of member registration",permalink:"/docs/tutorials/change-the-default-group-for-member-registration-depending-on-the-domain"},next:{title:"DeepL API auto tranlation",permalink:"/docs/tutorials/deepl-api-auto-translation"}},l={},p=[{value:"Overview",id:"overview",level:2},{value:"What you will learn",id:"what-you-will-learn",level:3},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Instagram settings",id:"instagram-settings",level:2},{value:"Create Facebook app",id:"create-facebook-app",level:3},{value:"Create Instagram app",id:"create-instagram-app",level:3},{value:"Add Instagram test user",id:"add-instagram-test-user",level:3},{value:"Authentication process verification",id:"authentication-process-verification",level:3},{value:"Kuroco settings (setup)",id:"kuroco-settings-setup",level:2},{value:"Create content structure",id:"create-content-structure",level:3},{value:"Create content",id:"create-content",level:3},{value:"Create constants and secret",id:"create-constants-and-secret",level:3},{value:"Create API",id:"create-api",level:3},{value:"Create API for internal use",id:"create-api-for-internal-use",level:4},{value:"Creating APIs",id:"creating-apis",level:4},{value:"Security settings",id:"security-settings",level:4},{value:"CORS settings",id:"cors-settings",level:4},{value:"Implement authorization feature using Kuroco and Nuxt.js",id:"implement-authorization-feature-using-kuroco-and-nuxtjs",level:2},{value:"Create the required endpoints",id:"create-the-required-endpoints",level:3},{value:"instagram_auth endpoint",id:"instagram_auth-endpoint",level:4},{value:"instagram/update endpoint",id:"instagramupdate-endpoint",level:4},{value:"Create custom function",id:"create-custom-function",level:3},{value:"Frontend implementation",id:"frontend-implementation",level:3},{value:"Testing",id:"testing",level:3},{value:"Periodically get the Instagram feed via Kuroco",id:"periodically-get-the-instagram-feed-via-kuroco",level:2},{value:"Create batch process",id:"create-batch-process",level:3},{value:"Confirmation of Operation",id:"confirmation-of-operation",level:3},{value:"Periodically refresh long-term access tokens in Kuroco",id:"periodically-refresh-long-term-access-tokens-in-kuroco",level:2},{value:"Creating batch process",id:"creating-batch-process",level:3},{value:"Testing",id:"testing-1",level:3},{value:"Display Instagram feed using Kuroco and Nuxt.js",id:"display-instagram-feed-using-kuroco-and-nuxtjs",level:2},{value:"Creating an endpoint",id:"creating-an-endpoint",level:3},{value:"Front-end implementation",id:"front-end-implementation",level:3},{value:"Testing",id:"testing-2",level:3},{value:"Points to check when it doesn&#39;t work as expected",id:"points-to-check-when-it-doesnt-work-as-expected",level:2},{value:"Related documents",id:"related-documents",level:2}],d={toc:p},m="wrapper";function c(t){let{components:e,...a}=t;return(0,r.kt)(m,(0,n.Z)({},d,a,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"overview"},"Overview"),(0,r.kt)("p",null,"Kuroco allows you to create your own custom APIs and also provides plug-ins that send requests to external APIs which allows you to use services that are not listed in the external system integration, this can be done using the custom function or batch process feature in Kuroco. We will be using the Instagram basic display API as an example in this tutorial."),(0,r.kt)("p",null,"Kuroco has no built-in integration with Instagram in the external system integration menu but you can display the Instagram feed by sending a request to the Instagram basic display API with the ",(0,r.kt)("inlineCode",{parentName:"p"},"{api}")," plugin.  "),(0,r.kt)("h3",{id:"what-you-will-learn"},"What you will learn"),(0,r.kt)("p",null,"We will display the Instagram feed with the following steps: "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#instagram-settings"},"Instagram settings")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#kuroco-settings-setup"},"Kuroco settings (setup)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#implement-authorization-feature-using-kuroco-and-nuxtjs"},"Implement authorization feature using Kuroco and Nuxt.js")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#periodically-get-the-instagram-feed-via-kuroco"},"Periodically get the Instagram feed via Kuroco")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#periodically-refresh-long-term-access-tokens-in-kuroco"},"Periodically refresh long-term access tokens in Kuroco")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#display-instagram-feed-using-kuroco-and-nuxtjs"},"Display Instagram feed using Kuroco and Nuxt.js"))),(0,r.kt)("h3",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("p",null,"The following accounts are required before starting this tutorial:  "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Facebook developer account"),(0,r.kt)("li",{parentName:"ul"},"Instagram account")),(0,r.kt)("p",null,"In addition, this tutorial assumes that you have already built a Nuxt.js project with Kuroco.\nIf you haven't built one yet, see the tutorial below."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/tutorials/beginners-guide/"},"Beginner's guide to Kuroco"))),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"The Instagram basic display API is implemented with reference to the ",(0,r.kt)("a",{parentName:"p",href:"https://developers.facebook.com/docs/instagram-basic-display-api"},"official document"),".\nIf there are any discrepancies, refer to the lastest information in the official document instead.")),(0,r.kt)("h2",{id:"instagram-settings"},"Instagram settings"),(0,r.kt)("h3",{id:"create-facebook-app"},"Create Facebook app"),(0,r.kt)("p",null,"Access ",(0,r.kt)("a",{parentName:"p",href:"https://developers.facebook.com/apps/"},"developers.facebook.com/apps")," and click ","[Create App]",".",(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/1427cfbe1d2065ae32a973a05a860a14.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/1427cfbe1d2065ae32a973a05a860a14.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Select ","[None]"," for the type.  "),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/9a1bca189a6f250f1bac06c6e8034ec6.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/9a1bca189a6f250f1bac06c6e8034ec6.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Enter the app name and click ","[Create app]",".",(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/49a8e43b66b6910c289373786db9b90f.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/49a8e43b66b6910c289373786db9b90f.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Go to the app dashboard once the app is created, then go to ","[Settings]"," > ","[Basic]",", scroll to the bottom of the page and click ","[Add platform]",".\n",(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/59bc7dd66391ac234da515b2a4c7c21b.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/59bc7dd66391ac234da515b2a4c7c21b.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,'Select "Website" and click',"[Next]",".",(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/35b03f1bfcb627d93d203abfbf6fe70f.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/35b03f1bfcb627d93d203abfbf6fe70f.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"A field for entering the site URL will be displayed.",(0,r.kt)("br",{parentName:"p"}),"\n","Enter Kuroco's front-end URL and click ","[Save changes]",".",(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/4684e1efc13e6471a11dd3de35c881cf.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/4684e1efc13e6471a11dd3de35c881cf.png",alt:"Image from Gyazo"})),(0,r.kt)("h3",{id:"create-instagram-app"},"Create Instagram app"),(0,r.kt)("p",null,'Go back to your dashboard, find "Instagram Basic Display" under "Add Products" and click ',"[Set up]",".\n",(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/843a7a58946eadd5f25f22340c60eb3b.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/843a7a58946eadd5f25f22340c60eb3b.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Scroll to the bottom of the page and click ","[Create New App]",".  "),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/b9fbed6234558fc48fc78490e4e7fb3d.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/b9fbed6234558fc48fc78490e4e7fb3d.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"The app name of the Facebook app that was created in the previous step will be displayed. Click ","[Create app]"," without changing anything.",(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/5b4db56b9b59d03da0e25a7c80cd762f.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/5b4db56b9b59d03da0e25a7c80cd762f.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Once the Instagram app has been created, enter the URL ",(0,r.kt)("inlineCode",{parentName:"p"},"https://frontendURL/auth/"),' into the fields "Valid OAuth Redirect URIs", "Deauthorize Callback URL", and "Data Deletion Request URL", then click "Save Changes".'),(0,r.kt)("p",null,'While "Deauthorize Callback URL" and "Data Deletion Request URL" should ultimately be changed to the appropriate URLs capable of handling those processes, they can initially be set to the same value as the OAuth Redirect URI.\n',(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/be885b57f8457974ec529580d5f1adf4.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/be885b57f8457974ec529580d5f1adf4.png",alt:"Image from Gyazo"})),(0,r.kt)("h3",{id:"add-instagram-test-user"},"Add Instagram test user"),(0,r.kt)("p",null,"Navigate to ","[App Roles]"," -> Roles, scroll down to the Instagram Testers section and click ","[Add Instagram Tester]",".",(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/3a96c03d164839ca84f4ed5b7d6196e9.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/3a96c03d164839ca84f4ed5b7d6196e9.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Enter Instagram account username and click ","[Submit]",".",(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/8ee4989b076243ca57dd970bf01a0942.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/8ee4989b076243ca57dd970bf01a0942.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Access ",(0,r.kt)("a",{parentName:"p",href:"https://www.instagram.com/"},"Instagram")," and login with the account you have just invited above. Click ","[Profile icon]"," > ","[Edit profile]"," > ","[Apps and websites]"," > ","[Tester Invites]"," and click ","[Accept]",".",(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/f42a49885ea9ba8c5b041cd7b05c4d75.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/f42a49885ea9ba8c5b041cd7b05c4d75.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Your Instagram account is now accessible from the Facebook app, even when it's in development mode."),(0,r.kt)("h3",{id:"authentication-process-verification"},"Authentication process verification"),(0,r.kt)("p",null,"We will verify the process of authenticating users and obtaining long-term Instagram user access tokens.  "),(0,r.kt)("p",null,"User authentication starts at the following URL:  "),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"https://api.instagram.com/oauth/authorize?client_id={app-id}&redirect_uri={redirect-uri}&scope=user_profile,user_media&response_type=code")),(0,r.kt)("p",null,"Replace ",(0,r.kt)("inlineCode",{parentName:"p"},"{app-id}")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"{redirect-uri}"),' with "Instagram App ID" and "Valid OAuth Redirect URIs" respectively from ',"[Instagram Basic Display]","->","[Basic Display]",".",(0,r.kt)("br",{parentName:"p"}),"\n","Please note that the Instagram App ID is different from the Facebook App ID.  "),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/5abbe674e0ee17631593d7537b3521ef.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/5abbe674e0ee17631593d7537b3521ef.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"For example, the full URL can be as below:",(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("inlineCode",{parentName:"p"},"https://api.instagram.com/oauth/authorize?client_id=684477648739411&redirect_uri=https://socialsizzle.herokuapp.com/auth/&scope=user_profile,user_media&response_type=code")),(0,r.kt)("p",null,"If you access the URL for your own Instagram App, the screen below will be displayed.",(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/8ea6184f730e9cbc49ba3becf8c8c53e.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/8ea6184f730e9cbc49ba3becf8c8c53e.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Click ","[Allow]",", then you will be redirected to the specified redirect URI and will see the authentication code in the URL.",(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/ae5239e588bc7a39564d9444d637b96d.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/ae5239e588bc7a39564d9444d637b96d.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"This authentication code is exchanged for an access token by requesting the Instagram API along with the Instagram App ID and Instagram App Secret.\nIn addition, we can get the Instagram feed by requesting the obtained access token and user ID to the Instagram API.  "),(0,r.kt)("h2",{id:"kuroco-settings-setup"},"Kuroco settings (setup)"),(0,r.kt)("p",null,"Now we set up the Kuroco settings. "),(0,r.kt)("h3",{id:"create-content-structure"},"Create content structure"),(0,r.kt)("p",null,"First, create an Instagram long-term access token and a content structure that stores your Instagram feed.  "),(0,r.kt)("p",null,"Click ","[Add]"," button on ",(0,r.kt)("a",{parentName:"p",href:"/docs/management/content-structure-topics-group/"},"Content structure")," page.",(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/8b7deb18b73d830e7a1aee113da244a1.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/8b7deb18b73d830e7a1aee113da244a1.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Enter as follows:  "),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Settings"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Name"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Instagram")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"ID=1"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Field settings\uff1aSingle-line text",(0,r.kt)("br",null),"Field name\uff1aAccess token",(0,r.kt)("br",null),"Identifier\uff1atoken",(0,r.kt)("br",null),"Repetition\uff1a1")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"ID=2"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Field settings\uff1aSingle-line text",(0,r.kt)("br",null),"Field name\uff1aMedia URL",(0,r.kt)("br",null),"Identifier\uff1amedia_url",(0,r.kt)("br",null),"Repetition\uff1a6")))),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/0a5b4eb45ad6cbe61e984b42e6def53e.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/0a5b4eb45ad6cbe61e984b42e6def53e.png",alt:"Image from Gyazo"}),"\n",(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/d72b58b8965d060bee3810b6c10d0c8d.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/d72b58b8965d060bee3810b6c10d0c8d.png",alt:"Image from Gyazo"}),"\n",(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/661650a667fb858a46e489238a4935a1.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/661650a667fb858a46e489238a4935a1.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Click ","[Add]"," after completing above settings.  "),(0,r.kt)("h3",{id:"create-content"},"Create content"),(0,r.kt)("p",null,"We will create an empty content to be updated by the custom function that will be implemented later.  "),(0,r.kt)("p",null,"Click the ","[Add]"," button on the ",(0,r.kt)("a",{parentName:"p",href:"/docs/management/content-structure-topics/"},"content")," page.",(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/679c9d6ce011a8612494251f38300daf.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/679c9d6ce011a8612494251f38300daf.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Enter the following and click ","[Add]",". "),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,r.kt)("th",{parentName:"tr",align:"left"},"value"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Slug"),(0,r.kt)("td",{parentName:"tr",align:"left"},"instagram")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Title"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Instagram feed")))),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/84c71893a3ad6633f22368f01720c136.jpg?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/84c71893a3ad6633f22368f01720c136.jpg",alt:"Image from Gyazo"})),(0,r.kt)("h3",{id:"create-constants-and-secret"},"Create constants and secret"),(0,r.kt)("p",null,"Since the Instagram App ID and Instagram App Secret will be used several times in Kuroco's custom processing, we will register them as constants and secrets.",(0,r.kt)("br",{parentName:"p"}),"\n","It is recommended that highly confidential items be registered as secrets.  "),(0,r.kt)("p",null,'Copy the "Instagram App ID" and "Instagram App Secret" from the "Basic" page of the Instagram app.',(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/a0257d4d34ea01f548e064813936fea7.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/a0257d4d34ea01f548e064813936fea7.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Go back to your Kuroco admin panel, click ","[Environment]"," > ","[Constant]"," on the side menu and click ","[Add]",".",(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/876e2462fba8c41704b5cb06145bca1f.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/876e2462fba8c41704b5cb06145bca1f.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Enter the followings and click ","[Add]",".  "),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Settings"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Name"),(0,r.kt)("td",{parentName:"tr",align:"left"},"INSTAGRAM_APP_ID")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Value"),(0,r.kt)("td",{parentName:"tr",align:"left"},'Paste the "Instagram App ID" that you copied earlier')))),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/34afb853362feac60a88829b0a882085.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/34afb853362feac60a88829b0a882085.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Once added, the Smarty variable syntax will be shown.",(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/ad84e36f3d5166f996474a4b6eef430e.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/ad84e36f3d5166f996474a4b6eef430e.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Next, click ","[Environment]"," > ","[Secret]"," and click ","[Add]",".",(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/37aacf078ecbf7c865737523ef87a589.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/37aacf078ecbf7c865737523ef87a589.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Enter as followings and click ","[Add]","."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Settings"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Name"),(0,r.kt)("td",{parentName:"tr",align:"left"},"INSTAGRAM_APP_SECRET")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Value"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Instagram App Secret")))),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/e72234d4220aa136dfe0ac33248ad3d1.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/e72234d4220aa136dfe0ac33248ad3d1.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Once added, the Smarty variable syntax will be shown.",(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/b0e95a767f08db64c5a30c27645332c0.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/b0e95a767f08db64c5a30c27645332c0.png",alt:"Image from Gyazo"})),(0,r.kt)("h3",{id:"create-api"},"Create API"),(0,r.kt)("h4",{id:"create-api-for-internal-use"},"Create API for internal use"),(0,r.kt)("p",null,"It is recommended to separate APIs for endpoints that are only used internally within Kuroco.",(0,r.kt)("br",{parentName:"p"}),"\n","First, create a new API for internal use.",(0,r.kt)("br",{parentName:"p"}),"\n","If it has already been added, you can proceed to the next step."),(0,r.kt)("h4",{id:"creating-apis"},"Creating APIs"),(0,r.kt)("p",null,"Click ","[Add]"," on the API page of the Kuroco admin panel."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/6544c8a29317e971d2d1adb8c28a4ae7.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/6544c8a29317e971d2d1adb8c28a4ae7.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Enter the following in the editor and click ","[Add]",".  "),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/58f7cfe849df22e41227016b2b26122b.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/58f7cfe849df22e41227016b2b26122b.png",alt:"Image from Gyazo"})),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Settings"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Title"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Internal")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Version"),(0,r.kt)("td",{parentName:"tr",align:"left"},"1.0")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Description"),(0,r.kt)("td",{parentName:"tr",align:"left"},"API for internal use")))),(0,r.kt)("p",null,"The new API is now created."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/c815f59956db28699d24750b743859ac.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/c815f59956db28699d24750b743859ac.png",alt:"Image from Gyazo"})),(0,r.kt)("h4",{id:"security-settings"},"Security settings"),(0,r.kt)("p",null,"Next, we will need to configure the security settings. Click ","[Security]",".  "),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/1aee6261457116b90de2c2b1596a72a0.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/1aee6261457116b90de2c2b1596a72a0.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Select ","[Dynamic access token]"," and click ","[Save]",".  "),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/41d4d26aa6a3e4dc20da998189594565.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/41d4d26aa6a3e4dc20da998189594565.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"After setting the security to ","[Dynamic access token]",', the message "Since this API is configured to use token, it is recommended to add an endpoint that implements Authentication::Login::token." will be shown. We can ignore it for now since this API is only for internal use.  '),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/0f60253c9152f4e03e6e2774d837f83e.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/0f60253c9152f4e03e6e2774d837f83e.png",alt:"Image from Gyazo"})),(0,r.kt)("h4",{id:"cors-settings"},"CORS settings"),(0,r.kt)("p",null,"Next, we will configure CORS settings. Click ","[Operation CORS]","."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/d17f7a7eecff5887b74df23df8c481d5.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/d17f7a7eecff5887b74df23df8c481d5.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Click ","[Add origin]"," of CORS_ALLOW_ORIGINS and enter the following:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Admin panel URL")),(0,r.kt)("p",null,"Click ","[Add Method]"," of CORS_ALLOW_METHODS and enter the followings:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"GET  "),(0,r.kt)("li",{parentName:"ul"},"POST"),(0,r.kt)("li",{parentName:"ul"},"OPTIONS")),(0,r.kt)("p",null,"Confirm that ","[Allow Credentials]"," of CORS_ALLOW_CREDENTIALS is checked.  "),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/e4cedebc531320b8fc564c0b6529d01c.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/e4cedebc531320b8fc564c0b6529d01c.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Click ","[Save]"," after finishing the above configuration.  "),(0,r.kt)("h2",{id:"implement-authorization-feature-using-kuroco-and-nuxtjs"},"Implement authorization feature using Kuroco and Nuxt.js"),(0,r.kt)("h3",{id:"create-the-required-endpoints"},"Create the required endpoints"),(0,r.kt)("p",null,"We will need to create two endpoints"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"instagram_auth endpoint: To receive the authentication code from the frontend"),(0,r.kt)("li",{parentName:"ul"},"instagram/update endpoint: To store the obtained long-term access token in Kuroco.")),(0,r.kt)("h4",{id:"instagram_auth-endpoint"},"instagram_auth endpoint"),(0,r.kt)("p",null,"Since the instagram_auth endpoint sends requests from the frontend, click ","[Add new endpoint]",' from the "Default" API.'),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/6180b91072835695331f82e5ed2f09f3.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/6180b91072835695331f82e5ed2f09f3.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Create an endpoint below:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Settings"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Name"),(0,r.kt)("td",{parentName:"tr",align:"left"},"instagram_auth")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Category"),(0,r.kt)("td",{parentName:"tr",align:"left"},"API")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Model"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Api")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Operation"),(0,r.kt)("td",{parentName:"tr",align:"left"},"request_api_post")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"name"),(0,r.kt)("td",{parentName:"tr",align:"left"},"instagram_auth",(0,r.kt)("br",null),"(This will be the identifier of the custom function we will create later.)")))),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/f8526208712f1e7434e70d6abad196d0.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/f8526208712f1e7434e70d6abad196d0.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"After finishing the above configuraion, click ","[Add]"," to add the endpoint."),(0,r.kt)("h4",{id:"instagramupdate-endpoint"},"instagram/update endpoint"),(0,r.kt)("p",null,"Since the instagram/update endpoint is an internal endpoint to be called from custom function, click ","[Add new endpoint]",' from the "Internal" API.'),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/4084099d555d1761bfbc02351a7c3719.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/4084099d555d1761bfbc02351a7c3719.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Add the following endpoint:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Settings"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Name"),(0,r.kt)("td",{parentName:"tr",align:"left"},"instagram/update")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Category"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Content")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Model"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Topics")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Operation"),(0,r.kt)("td",{parentName:"tr",align:"left"},"update")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"topics_group_id"),(0,r.kt)("td",{parentName:"tr",align:"left"},"ID of the content structure created earlier(8)")))),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/b7f1b0e5889c1ede29cfc52490fb678a.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/b7f1b0e5889c1ede29cfc52490fb678a.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"After settings, click ","[Add]"," to add the endpoint."),(0,r.kt)("h3",{id:"create-custom-function"},"Create custom function"),(0,r.kt)("p",null,"Click ","[Operation]"," -> ","[Custom function]",".\n",(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/9a9b5f1fa42555de0222180269ef487b.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/9a9b5f1fa42555de0222180269ef487b.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Click ","[Add]",".  "),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/ac3cbd1c4912fdb85574ccd0ecce3ac3.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/ac3cbd1c4912fdb85574ccd0ecce3ac3.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Enter the following:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Settings"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Title"),(0,r.kt)("td",{parentName:"tr",align:"left"},"instagram_auth")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Identifier"),(0,r.kt)("td",{parentName:"tr",align:"left"},"instagram_auth",(0,r.kt)("br",null),"(This has to be the same name set in the ",(0,r.kt)("inlineCode",{parentName:"td"},"Api::request_api")," endpoint.)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Process"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Refer to the code below")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-smarty"},"{* get short-term token *}\n{append var=headers value=\"Content-Type': 'application/x-www-form-urlencoded\"}\n{assign_array var='body'            values=''}\n{assign       var='body.client_id'    value=$smarty.const.INSTAGRAM_APP_ID}\n{secret       var='body.client_secret' key='INSTAGRAM_APP_SECRET'}\n{assign       var='body.grant_type' value='authorization_code'}\n{assign       var='body.redirect_uri' value=\"`$smarty.const.ROOT_URL`/auth/\"}\n{assign       var='body.code' value=$smarty.request.code}\n\n{api\n    endpoint='https://api.instagram.com/oauth/access_token'\n    method='POST'\n    headers=$headers\n    body=$body\n    var=response1\n    status_var=status1\n}\n\n{* convert api plugin response to json format *}\n{assign var=response1 value=$response1|@json_decode}\n{logger msg1=\"get short-term token\" msg2=$body msg3=$response1 msg4=$status1}\n\n{* get long-term token *}\n{assign_array var='body2'            values=''}\n{secret       var='body2.client_secret' key='INSTAGRAM_APP_SECRET'}\n{assign       var='body2.grant_type' value='ig_exchange_token'}\n{assign       var='body2.access_token' value=$response1.access_token}\n\n{api\n    endpoint='https://graph.instagram.com/access_token'\n    method='GET'\n    queries=$body2\n    var=response2\n    status_var=status2\n}\n\n{* convert api plugin response to json format *}\n{assign var=response2 value=$response2|@json_decode}\n{logger msg1=\"get long-term token\" msg2=$body2 msg3=$response2 msg4=$status2}\n\n{* Add long-term token to content *}\n{assign_array var='body3'            values=''}\n{assign       var='body3.token'    value=$response2.access_token}\n\n{if $response2.access_token != null}\n    {api_internal\n        var='response'\n        status_var='status'\n        endpoint='/rcms-api/4/instagram/update/instagram'\n        method='POST'\n        queries=$body3\n        member_id='1'}\n{/if}\n")),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Replace ",(0,r.kt)("inlineCode",{parentName:"p"},"/rcms-api/4/")," with your own enpoint.")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/7bae859ed94169e1feba1a110197d8ea.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/7bae859ed94169e1feba1a110197d8ea.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"After completing the above configuration, click ","[Add]"," to save the custom function.  "),(0,r.kt)("h3",{id:"frontend-implementation"},"Frontend implementation"),(0,r.kt)("p",null,"Next, we will implement the authenticaiton process on the frontend which send the authentication code to the Kuroco endpoint and activate the custom function.  "),(0,r.kt)("p",null,"Create ",(0,r.kt)("inlineCode",{parentName:"p"},"index.vue")," file under ",(0,r.kt)("inlineCode",{parentName:"p"},"/pages/auth/")," directory.  "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-markup",metastring:"[/auth/index.vue]","[/auth/index.vue]":!0},"<template>\n  <div>\n    <p>Authenticated</p>\n  </div>\n</template>\n\n<script>\nexport default {\n  validate({ query }) {\n        return query.code != null\n    },\n  methods: {\n    async makeAccessToken() {\n      const payload = {\n        code: this.$route.query.code\n      }\n      await this.$axios.post('/rcms-api/1/instagram_auth', payload);\n    }\n  },\n  mounted($route) {\n    this.makeAccessToken();\n  }\n}\n<\/script>\n")),(0,r.kt)("h3",{id:"testing"},"Testing"),(0,r.kt)("p",null,"Access the URL below and click ","[Allow]",".  "),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"https://api.instagram.com/oauth/authorize?client_id={app-id}&redirect_uri={redirect-uri}&scope=user_profile,user_media&response_type=code")),(0,r.kt)("p",null,"Replace ",(0,r.kt)("inlineCode",{parentName:"p"},"{app-id}")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"{redirect-uri}"),' to "Instagram App ID" and "Valid OAuth Redirect URIs" respectively from ',"[Instagram Basic Display]",">","[Basic Display]",".  "),(0,r.kt)("p",null,"Confirm that it is redirected to the redirect URI and the access token is saved in the content.",(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/3501be3bd80159a562f397334105fa55.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/3501be3bd80159a562f397334105fa55.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/9ca1a69a067cf39a05575be84611bc34.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/9ca1a69a067cf39a05575be84611bc34.png",alt:"Image from Gyazo"})),(0,r.kt)("h2",{id:"periodically-get-the-instagram-feed-via-kuroco"},"Periodically get the Instagram feed via Kuroco"),(0,r.kt)("p",null,"We will add a Kuroco batch process to retrieve the Instagram feed periodically and update the content with the data retrieved.  "),(0,r.kt)("h3",{id:"create-batch-process"},"Create batch process"),(0,r.kt)("p",null,"Click ","[Operation]"," > ","[Batch process]",".  "),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/1ecfae69bcffdbcdacbab103904db3ad.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/1ecfae69bcffdbcdacbab103904db3ad.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Click ","[Add]",".  "),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/8eb644facfb5c12cf04a8484ebbdccb5.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/8eb644facfb5c12cf04a8484ebbdccb5.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Configure as follows:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Settings"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Title"),(0,r.kt)("td",{parentName:"tr",align:"left"},"instagram_get_media\u3000")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Identifier"),(0,r.kt)("td",{parentName:"tr",align:"left"},"instagram_get_media")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Batch"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Every day 00:00")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Process"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Following code")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-smarty"},"{*Get current long-term access token*}\n{assign_array var='method_params' values=''}\n{assign var='method_params.topics_id' value=\"instagram\"}\n{api_method\n    var='response'\n    model='Topics'\n    method='details'\n    version='1'\n    method_params=$method_params}\n\n{*Get the latest media data*}\n{assign_array var='body' values=''}\n{assign var='body.fields' value='media_url'}\n{assign var='body.access_token' value=$response.details.token}\n{assign var='body.limit' value=6}\n\n{api\n    endpoint='https://graph.instagram.com/me/media'\n    method='GET'\n    queries=$body\n    var='media'\n    status_var=status\n}\n\n{* Convert the api plugin response to json format *}\n{assign var=media value=$media|@json_decode}\n\n{* Convert the api plugin response to an array for updating *}\n{assign_array var='data.media_url' values=''}\n{foreach from=$media.data item=foo}\n    {append var='data.media_url' value=$foo.media_url}\n{/foreach}\n\n{* Update the content *}\n{api_internal\n        var='response2'\n        status_var='status'\n        endpoint='/rcms-api/4/instagram/update/instagram'\n        method='POST'\n        queries=$data\n        member_id='1'}\n\n{logger msg1=\"Get Instagram Media\" msg2=$response2}\n")),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Replace ",(0,r.kt)("inlineCode",{parentName:"p"},"/rcms-api/4/")," with your own enpoint.")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/1a7784d0bd7e7fc3119fe1c955b975e5.jpg?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/1a7784d0bd7e7fc3119fe1c955b975e5.jpg",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Once the configuration is complete, click ","[Add]"," to create the batch process. "),(0,r.kt)("h3",{id:"confirmation-of-operation"},"Confirmation of Operation"),(0,r.kt)("p",null,"Finally, click ","[Run now]"," to confirm the operation.  "),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/a92a5776dd0d2d3f80ed235fb8d5eff4.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/a92a5776dd0d2d3f80ed235fb8d5eff4.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"If the settings have been properly configured, the Instagram media URL will be saved in the content as shown below. "),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/9c12776b01aacdcf98fb458d5b7b0fd2.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/9c12776b01aacdcf98fb458d5b7b0fd2.png",alt:"Image from Gyazo"})),(0,r.kt)("h2",{id:"periodically-refresh-long-term-access-tokens-in-kuroco"},"Periodically refresh long-term access tokens in Kuroco"),(0,r.kt)("p",null,"The long-term access token for the Instagram Basic Display API has an expiration period of 60 days. An endpoint is provided by Instagram to update the long-term access token, so let's create a batch processing to send a request regularly.  "),(0,r.kt)("h3",{id:"creating-batch-process"},"Creating batch process"),(0,r.kt)("p",null,"Click ","[Operation]"," > ","[Batch process]",".  "),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/1ecfae69bcffdbcdacbab103904db3ad.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/1ecfae69bcffdbcdacbab103904db3ad.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Click ","[Add]",".  "),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/8eb644facfb5c12cf04a8484ebbdccb5.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/8eb644facfb5c12cf04a8484ebbdccb5.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Configure as follows:  "),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Settings"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Title"),(0,r.kt)("td",{parentName:"tr",align:"left"},"update_token")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Identifier"),(0,r.kt)("td",{parentName:"tr",align:"left"},"update_token")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Schedule"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Every day 01:00")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Process"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Code below")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-smarty"},"{*Get the current long-term access token*}\n{assign_array var='method_params'           values=''}\n{assign       var='method_params.topics_id' value=\"instagram\"}\n{api_method\n    var='topics'\n    model='Topics'\n    method='details'\n    version='1'\n    method_params=$method_params}\n\n{* Update the long-term token *}\n{assign_array var='body'            values=''}\n{assign       var='body.grant_type' value='ig_refresh_token'}\n{assign       var='body.access_token' value=$topics.details.token}\n\n{api\n    endpoint='https://graph.instagram.com/refresh_access_token'\n    method='GET'\n    queries=$body\n    var=response\n    status_var=status\n}\n\n{* Convert the response of the api plugin to json format*}\n{assign var=response value=$response|@json_decode}\n{logger msg1=\"Update long-term access token\" msg2=$body msg3=$response msg4=$status}\n\n{* Add the long-term token to the content *}\n{assign_array var='body2'            values=''}\n{assign       var='body2.token'    value=$response.access_token}\n\n{if $response.access_token != null}\n    {api_internal\n        var='response'\n        status_var='status'\n        endpoint='/rcms-api/4/instagram/update/instagram'\n        method='POST'\n        queries=$body2\n        member_id='1'}\n{/if}\n")),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Replace ",(0,r.kt)("inlineCode",{parentName:"p"},"/rcms-api/4/")," with your own enpoint.")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/3d1888388023f76380bd463ba298fc6e.jpg?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/3d1888388023f76380bd463ba298fc6e.jpg",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Once you have entered the settings, click ","[Add]"," to add the batch process.  "),(0,r.kt)("h3",{id:"testing-1"},"Testing"),(0,r.kt)("p",null,"Finally, click ","[Run now]"," to confirm the access token is being retrieved.  "),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/c57daa60b28a655dd546adb71b449bb7.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/c57daa60b28a655dd546adb71b449bb7.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"If the settings are correct, the access token in the content will be updated.  "),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/162ef757e4f2359e451f0571d45a188b.jpg?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/162ef757e4f2359e451f0571d45a188b.jpg",alt:"Image from Gyazo"})),(0,r.kt)("h2",{id:"display-instagram-feed-using-kuroco-and-nuxtjs"},"Display Instagram feed using Kuroco and Nuxt.js"),(0,r.kt)("p",null,"Everything has been configured, all that is left is to display the Instagram media URLs you have added to your Kuroco content on the front page.  "),(0,r.kt)("h3",{id:"creating-an-endpoint"},"Creating an endpoint"),(0,r.kt)("p",null,"Click ","[Add new endpoint]"," from the Default API."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/7ecfb510825392558e0e90f827c5c06a.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/7ecfb510825392558e0e90f827c5c06a.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Create the following endpoint:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Item"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Settings"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Name"),(0,r.kt)("td",{parentName:"tr",align:"left"},"instagram")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Category"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Content")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Model"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Topics")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Operation"),(0,r.kt)("td",{parentName:"tr",align:"left"},"details")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"topics_group_id"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Content structure ID(8)")))),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/2ed0f4ee6f5019c9421877e899fce0fb.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/2ed0f4ee6f5019c9421877e899fce0fb.png",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"Click ","[Add]"," after configuring the endpoint."),(0,r.kt)("h3",{id:"front-end-implementation"},"Front-end implementation"),(0,r.kt)("p",null,"Create an ",(0,r.kt)("inlineCode",{parentName:"p"},"index.vue")," file in the ",(0,r.kt)("inlineCode",{parentName:"p"},"/pages/instagram/")," directory for the front-end as follows: "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-markup",metastring:"[/pages/instagram/index.vue]","[/pages/instagram/index.vue]":!0},'<template>\n  <div>\n    <h2>Instagram</h2>\n    <div class="square_contents">\n      <a v-for="(n,i) in response.details.media_url" :key=i href="https://www.instagram.com/" target="_blank">\n        <img :src=n>\n      </a>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  async asyncData({ $axios }) {\n    return {\n      response: await $axios.$get(\'/rcms-api/1/instagram/instagram\'),\n    };\n  },\n};\n<\/script>\n\n<style>\n.square_contents {\n  display: flex;\n  flex-wrap: wrap;\n  width:720px;\n}\n.square_contents a {\n  display: block;\n  position: relative;\n  width: 31%;\n  margin: 1%;\n}\n.square_contents a::before {\n  content: "";\n  display: block;\n  padding-top: 100%;\n}\n.square_contents img {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  top: 0;\n  object-fit: cover;\n}\n</style>\n')),(0,r.kt)("h3",{id:"testing-2"},"Testing"),(0,r.kt)("p",null,"Confirm that the Instagram feed is being displayed on the frontend.  "),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://t.gyazo.com/teams/diverta/ae470166ecc592ca12dbdb67b29e7b9d.jpg?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/ae470166ecc592ca12dbdb67b29e7b9d.jpg",alt:"Image from Gyazo"})),(0,r.kt)("p",null,"With the above setup and implementation, the Instagram feed is displayed, and in the event of an update, Kucoro's content will be automatically updated as well.  "),(0,r.kt)("p",null,"In this tutorial, we used the Instagram basic display API to display the Instagram feed.",(0,r.kt)("br",{parentName:"p"}),"\n","You can also use the Instagram graph API for the following cases:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Identify media with specific @mentions or hashtags."),(0,r.kt)("li",{parentName:"ul"},"Retrieve data about other Instagram users."),(0,r.kt)("li",{parentName:"ul"},"Get Instagram stories.  ")),(0,r.kt)("h2",{id:"points-to-check-when-it-doesnt-work-as-expected"},"Points to check when it doesn't work as expected"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Is frontend repository deployed successfully? (Is the ",(0,r.kt)("inlineCode",{parentName:"li"},"auth/?code=1234")," page shown properly?)"),(0,r.kt)("li",{parentName:"ul"},"Check that the Kuroco constant ",(0,r.kt)("inlineCode",{parentName:"li"},"INSTAGRAM_APP_ID")," is set to ",(0,r.kt)("inlineCode",{parentName:"li"},"Instagram App ID")," instead of ",(0,r.kt)("inlineCode",{parentName:"li"},"App ID")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"INSTAGRAM_APP_ID"),".",(0,r.kt)("br",{parentName:"li"}),(0,r.kt)("strong",{parentName:"li"},"CORRECT(",(0,r.kt)("inlineCode",{parentName:"strong"},"Instagram App ID"),"):"),(0,r.kt)("br",{parentName:"li"}),(0,r.kt)("img",{parentName:"li",src:"https://t.gyazo.com/teams/diverta/bbf31b9f6502fd88a20c3c2030244e69.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/bbf31b9f6502fd88a20c3c2030244e69.png",alt:"Image from Gyazo"}),(0,r.kt)("br",{parentName:"li"}),(0,r.kt)("strong",{parentName:"li"},"WRONG(",(0,r.kt)("inlineCode",{parentName:"strong"},"App ID"),"):"),(0,r.kt)("br",{parentName:"li"}),(0,r.kt)("img",{parentName:"li",src:"https://t.gyazo.com/teams/diverta/8226455560caa73e5f28637269b59b91.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/8226455560caa73e5f28637269b59b91.png",alt:"Image from Gyazo"}),"  "),(0,r.kt)("li",{parentName:"ul"},"Check that the Kuroco secret ",(0,r.kt)("inlineCode",{parentName:"li"},"INSTAGRAM_APP_SECRET")," is set to ",(0,r.kt)("inlineCode",{parentName:"li"},"Insagram App Secret")," instead of ",(0,r.kt)("inlineCode",{parentName:"li"},"App Secret"),".",(0,r.kt)("br",{parentName:"li"}),(0,r.kt)("strong",{parentName:"li"},"CORRECT(",(0,r.kt)("inlineCode",{parentName:"strong"},"Instagram App Secret"),"):"),(0,r.kt)("br",{parentName:"li"}),(0,r.kt)("img",{parentName:"li",src:"https://t.gyazo.com/teams/diverta/1e9a07a79b5352da3081f472e8aa608a.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/1e9a07a79b5352da3081f472e8aa608a.png",alt:"Image from Gyazo"}),(0,r.kt)("br",{parentName:"li"}),(0,r.kt)("strong",{parentName:"li"},"WRONG(",(0,r.kt)("inlineCode",{parentName:"strong"},"App secret"),"):"),(0,r.kt)("br",{parentName:"li"}),(0,r.kt)("img",{parentName:"li",src:"https://t.gyazo.com/teams/diverta/fedff8bd817012d4da4ae64f925b4588.png?width=600","data-zoom-src":"https://t.gyazo.com/teams/diverta/fedff8bd817012d4da4ae64f925b4588.png",alt:"Image from Gyazo"}),"  ")),(0,r.kt)("h2",{id:"related-documents"},"Related documents"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/faq/how-to-request-kuroco-api-from-smarty-function/"},"Can I call Kuroco's API from custom function?")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/reference/smarty-plugin/"},"Smarty Plugin"))))}c.isMDXComponent=!0}}]);